

Prodycts add blueprint

ğŸš€ Advanced E-commerce Inventory Management System - Complete Blueprint
ğŸ“‘ Table of Contents
System Architecture
Enhanced Database Design
Advanced Features
Complete Workflows
Business Rules & Validations
Reports & Analytics
UI/UX Design
Edge Cases & Solutions
ğŸ—ï¸ System Architecture
Multi-Tenant Architecture
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Platform Level (Admin)            â”‚
â”‚  - Manage all dealers                       â”‚
â”‚  - System settings                          â”‚
â”‚  - Master data (categories, brands)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Dealer Level (Tenant)             â”‚
â”‚  - Own products                             â”‚
â”‚  - Own inventory                            â”‚
â”‚  - Own sales                                â”‚
â”‚  - Own customers                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Customer Level                    â”‚
â”‚  - Browse products                          â”‚
â”‚  - Place orders                             â”‚
â”‚  - Track orders                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ—„ï¸ Enhanced Database Design
NEW TABLES TO CREATE
1. VENDORS Table (Supplier Management)
SQL

CREATE TABLE vendors (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  dealer_id uuid REFERENCES dealers(id),
  name varchar NOT NULL,
  code varchar UNIQUE, -- VEN-001
  contact_person varchar,
  phone varchar,
  email varchar,
  address text,
  
  -- Financial
  credit_limit numeric DEFAULT 0,
  current_balance numeric DEFAULT 0, -- outstanding amount
  payment_terms varchar, -- 'cash', '7_days', '15_days', '30_days'
  
  -- Performance
  total_purchases numeric DEFAULT 0,
  total_transactions integer DEFAULT 0,
  average_rating numeric DEFAULT 0,
  
  -- Status
  status varchar DEFAULT 'active' 
    CHECK (status IN ('active', 'inactive', 'blocked')),
  is_preferred boolean DEFAULT false,
  
  -- Metadata
  notes text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX idx_vendors_dealer ON vendors(dealer_id);
CREATE INDEX idx_vendors_code ON vendors(code);
2. BRANDS Table (Master Data)
SQL

CREATE TABLE brands (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name varchar NOT NULL UNIQUE,
  slug varchar UNIQUE,
  logo_url text,
  country varchar,
  description text,
  website varchar,
  is_active boolean DEFAULT true,
  display_order integer DEFAULT 0,
  created_at timestamptz DEFAULT now()
);

-- Pre-populate with common brands
INSERT INTO brands (name, slug, country) VALUES
('Castrol', 'castrol', 'UK'),
('Mobil', 'mobil', 'USA'),
('Shell', 'shell', 'Netherlands'),
('Motul', 'motul', 'France'),
('Total', 'total', 'France');
3. PRODUCT_ATTRIBUTES Table (Enhanced)
SQL

-- Already exists, but modify usage
CREATE TABLE product_attribute_sets (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name varchar NOT NULL, -- 'Engine Oil Attributes'
  category_id uuid REFERENCES categories(id),
  created_at timestamptz DEFAULT now()
);

CREATE TABLE product_attribute_definitions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  attribute_set_id uuid REFERENCES product_attribute_sets(id),
  name varchar NOT NULL, -- 'Viscosity', 'Type', 'Size'
  type varchar NOT NULL 
    CHECK (type IN ('text', 'number', 'select', 'multi_select')),
  options jsonb, -- For select types: ["10W-30", "10W-40", "20W-50"]
  is_required boolean DEFAULT false,
  is_variant_attribute boolean DEFAULT false, -- Size, Color = true
  display_order integer DEFAULT 0,
  created_at timestamptz DEFAULT now()
);

-- Example for Engine Oil:
-- Attribute Set: "Engine Oil"
-- Attributes:
--   - Viscosity (select): 10W-30, 10W-40, 20W-50
--   - Type (select): Mineral, Semi-Synthetic, Fully Synthetic
--   - Size (select, variant): 800ml, 1L, 2L, 4L [VARIANT CREATOR]
--   - Bike Type (multi_select): 2-Stroke, 4-Stroke
4. PURCHASE_ORDERS Table (Enhanced)
SQL

CREATE TABLE purchase_orders (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  po_number varchar UNIQUE NOT NULL, -- PO-2024-001
  dealer_id uuid REFERENCES dealers(id) NOT NULL,
  vendor_id uuid REFERENCES vendors(id) NOT NULL,
  
  -- Dates
  order_date date NOT NULL DEFAULT CURRENT_DATE,
  expected_delivery_date date,
  received_date date,
  
  -- Financial
  subtotal numeric NOT NULL DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  shipping_cost numeric DEFAULT 0,
  other_charges numeric DEFAULT 0,
  grand_total numeric NOT NULL,
  paid_amount numeric DEFAULT 0,
  due_amount numeric DEFAULT 0,
  
  -- Status
  status varchar DEFAULT 'draft' CHECK (status IN (
    'draft',        -- Being created
    'pending',      -- Sent to vendor
    'confirmed',    -- Vendor confirmed
    'partial',      -- Partially received
    'received',     -- Fully received
    'cancelled'
  )),
  
  payment_status varchar DEFAULT 'unpaid' CHECK (payment_status IN (
    'unpaid', 'partial', 'paid'
  )),
  
  -- Documents
  invoice_number varchar,
  invoice_file_url text,
  
  -- References
  warehouse_location varchar,
  received_by uuid REFERENCES profiles(id),
  created_by uuid REFERENCES profiles(id),
  
  -- Metadata
  notes text,
  internal_notes text, -- Not visible in print
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX idx_po_dealer ON purchase_orders(dealer_id);
CREATE INDEX idx_po_vendor ON purchase_orders(vendor_id);
CREATE INDEX idx_po_number ON purchase_orders(po_number);
CREATE INDEX idx_po_date ON purchase_orders(order_date);
5. PURCHASE_ORDER_ITEMS Table (Enhanced)
SQL

CREATE TABLE purchase_order_items (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  purchase_order_id uuid REFERENCES purchase_orders(id) ON DELETE CASCADE,
  
  -- Product Reference
  product_id uuid REFERENCES products(id) NOT NULL,
  variant_id uuid REFERENCES product_variants(id),
  
  -- Identification
  barcode varchar,
  batch_number varchar, -- LOT-2024-JAN-001
  
  -- Quantity
  ordered_quantity integer NOT NULL,
  received_quantity integer DEFAULT 0,
  damaged_quantity integer DEFAULT 0,
  accepted_quantity integer DEFAULT 0, -- received - damaged
  
  -- Pricing
  unit_cost_price numeric NOT NULL,
  total_cost numeric GENERATED ALWAYS AS (ordered_quantity * unit_cost_price) STORED,
  
  -- Discount
  discount_type varchar CHECK (discount_type IN ('percentage', 'fixed', 'none')),
  discount_value numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  net_amount numeric, -- total_cost - discount_amount
  
  -- Quality Check
  quality_status varchar DEFAULT 'pending' CHECK (quality_status IN (
    'pending', 'passed', 'failed', 'partial'
  )),
  quality_notes text,
  
  -- Expiry (for products like oil, batteries)
  manufacturing_date date,
  expiry_date date,
  
  -- Metadata
  notes text,
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_po_items_po ON purchase_order_items(purchase_order_id);
CREATE INDEX idx_po_items_product ON purchase_order_items(product_id);
CREATE INDEX idx_po_items_variant ON purchase_order_items(variant_id);
CREATE INDEX idx_po_items_batch ON purchase_order_items(batch_number);
6. INVENTORY_BATCHES Table (Batch/Lot Tracking)
SQL

CREATE TABLE inventory_batches (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  dealer_id uuid REFERENCES dealers(id),
  product_id uuid REFERENCES products(id),
  variant_id uuid REFERENCES product_variants(id),
  
  -- Batch Info
  batch_number varchar UNIQUE NOT NULL,
  barcode varchar UNIQUE,
  
  -- Purchase Reference
  purchase_order_id uuid REFERENCES purchase_orders(id),
  purchase_order_item_id uuid REFERENCES purchase_order_items(id),
  vendor_id uuid REFERENCES vendors(id),
  
  -- Quantity Tracking
  initial_quantity integer NOT NULL,
  current_quantity integer NOT NULL,
  sold_quantity integer DEFAULT 0,
  damaged_quantity integer DEFAULT 0,
  returned_quantity integer DEFAULT 0,
  
  -- Pricing (FIFO/LIFO/Average Cost)
  unit_cost_price numeric NOT NULL,
  
  -- Dates
  manufacturing_date date,
  expiry_date date,
  received_date date NOT NULL,
  
  -- Location
  warehouse_location varchar,
  rack_number varchar,
  bin_number varchar,
  
  -- Status
  status varchar DEFAULT 'active' CHECK (status IN (
    'active',      -- Available for sale
    'low_stock',   -- Below threshold
    'expired',     -- Past expiry date
    'damaged',     -- Damaged goods
    'depleted'     -- Fully sold
  )),
  
  -- Alerts
  low_stock_threshold integer DEFAULT 5,
  expires_in_days integer GENERATED ALWAYS AS (
    CASE 
      WHEN expiry_date IS NOT NULL 
      THEN expiry_date - CURRENT_DATE 
      ELSE NULL 
    END
  ) STORED,
  
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX idx_batches_dealer ON inventory_batches(dealer_id);
CREATE INDEX idx_batches_product ON inventory_batches(product_id);
CREATE INDEX idx_batches_variant ON inventory_batches(variant_id);
CREATE INDEX idx_batches_number ON inventory_batches(batch_number);
CREATE INDEX idx_batches_status ON inventory_batches(status);
CREATE INDEX idx_batches_expiry ON inventory_batches(expiry_date);
7. SALES Table (Enhanced - Daily Sales Register)
SQL

CREATE TABLE sales (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  sale_number varchar UNIQUE NOT NULL, -- SALE-2024-0001
  dealer_id uuid REFERENCES dealers(id) NOT NULL,
  
  -- Customer Info
  customer_id uuid REFERENCES profiles(id), -- Registered customer
  customer_name varchar, -- Walk-in customer
  customer_phone varchar,
  customer_address text,
  
  -- Sale Type
  sale_type varchar DEFAULT 'retail' CHECK (sale_type IN (
    'retail',      -- Direct customer
    'wholesale',   -- Bulk sale
    'online',      -- From e-commerce order
    'return'       -- Return entry (negative sale)
  )),
  
  -- Reference
  order_id uuid REFERENCES orders(id), -- If from online order
  
  -- Financial
  subtotal numeric NOT NULL,
  discount_type varchar CHECK (discount_type IN ('percentage', 'fixed', 'none')),
  discount_value numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  other_charges numeric DEFAULT 0,
  grand_total numeric NOT NULL,
  
  total_cost numeric, -- Sum of cost prices
  total_profit numeric, -- grand_total - total_cost
  profit_margin numeric, -- (profit/grand_total) * 100
  
  -- Payment
  payment_method varchar CHECK (payment_method IN (
    'cash', 'card', 'mobile_banking', 'bank_transfer', 'credit', 'multiple'
  )),
  payment_status varchar DEFAULT 'paid' CHECK (payment_status IN (
    'paid', 'partial', 'unpaid', 'credit'
  )),
  paid_amount numeric DEFAULT 0,
  due_amount numeric DEFAULT 0,
  
  -- Sale Info
  sale_date date NOT NULL DEFAULT CURRENT_DATE,
  sale_time time NOT NULL DEFAULT CURRENT_TIME,
  
  -- Staff
  sold_by uuid REFERENCES profiles(id), -- Salesperson
  
  -- Status
  status varchar DEFAULT 'completed' CHECK (status IN (
    'draft',       -- Being created
    'completed',   -- Sale completed
    'returned',    -- Fully returned
    'partial_return', -- Partially returned
    'cancelled'
  )),
  
  -- Metadata
  notes text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX idx_sales_dealer ON sales(dealer_id);
CREATE INDEX idx_sales_customer ON sales(customer_id);
CREATE INDEX idx_sales_date ON sales(sale_date);
CREATE INDEX idx_sales_number ON sales(sale_number);
CREATE INDEX idx_sales_order ON sales(order_id);
8. SALE_ITEMS Table (Enhanced)
SQL

CREATE TABLE sale_items (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  sale_id uuid REFERENCES sales(id) ON DELETE CASCADE,
  
  -- Product Reference
  product_id uuid REFERENCES products(id) NOT NULL,
  variant_id uuid REFERENCES product_variants(id),
  
  -- Batch Tracking (FIFO - First In First Out)
  batch_id uuid REFERENCES inventory_batches(id),
  batch_number varchar,
  
  -- Product Info (Snapshot at time of sale)
  product_name varchar NOT NULL,
  variant_name varchar,
  sku varchar,
  barcode varchar,
  
  -- Quantity
  quantity integer NOT NULL,
  returned_quantity integer DEFAULT 0,
  net_quantity integer GENERATED ALWAYS AS (quantity - returned_quantity) STORED,
  
  -- Pricing
  unit_cost_price numeric NOT NULL, -- From batch
  unit_selling_price numeric NOT NULL,
  mrp numeric, -- Maximum Retail Price
  
  -- Calculations
  subtotal numeric GENERATED ALWAYS AS (quantity * unit_selling_price) STORED,
  discount_amount numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  total_amount numeric, -- subtotal - discount + tax
  
  -- Profit
  unit_profit numeric GENERATED ALWAYS AS (unit_selling_price - unit_cost_price) STORED,
  total_profit numeric GENERATED ALWAYS AS (
    (unit_selling_price - unit_cost_price) * (quantity - returned_quantity)
  ) STORED,
  
  -- Warranty
  warranty_period_days integer,
  warranty_expires_at date,
  
  -- Status
  status varchar DEFAULT 'sold' CHECK (status IN (
    'sold', 'returned', 'exchanged', 'warranty_claim'
  )),
  
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_sale_items_sale ON sale_items(sale_id);
CREATE INDEX idx_sale_items_product ON sale_items(product_id);
CREATE INDEX idx_sale_items_variant ON sale_items(variant_id);
CREATE INDEX idx_sale_items_batch ON sale_items(batch_id);
9. INVENTORY_MOVEMENTS Table (Enhanced - Replaces INVENTORY)
SQL

CREATE TABLE inventory_movements (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  dealer_id uuid REFERENCES dealers(id),
  
  -- Product Reference
  product_id uuid REFERENCES products(id) NOT NULL,
  variant_id uuid REFERENCES product_variants(id),
  batch_id uuid REFERENCES inventory_batches(id),
  
  -- Movement Details
  movement_type varchar NOT NULL CHECK (movement_type IN (
    'purchase',           -- Stock in from purchase
    'sale',              -- Stock out from sale
    'return_to_vendor',  -- Returned to supplier
    'return_from_customer', -- Customer returned
    'adjustment_increase', -- Manual stock increase
    'adjustment_decrease', -- Manual stock decrease
    'damage',            -- Damaged goods
    'expired',           -- Expired products
    'transfer_in',       -- From another location
    'transfer_out',      -- To another location
    'opening_stock'      -- Initial stock entry
  )),
  
  -- Quantity
  quantity_before integer NOT NULL,
  quantity_change integer NOT NULL, -- +ve for in, -ve for out
  quantity_after integer NOT NULL,
  
  -- Reference
  reference_type varchar, -- 'purchase_order', 'sale', 'adjustment'
  reference_id uuid, -- ID of the reference document
  reference_number varchar, -- PO-001, SALE-001
  
  -- Additional Info
  unit_cost numeric, -- Cost at time of movement
  total_value numeric, -- quantity_change * unit_cost
  
  -- User & Date
  performed_by uuid REFERENCES profiles(id),
  movement_date date NOT NULL DEFAULT CURRENT_DATE,
  movement_time time NOT NULL DEFAULT CURRENT_TIME,
  
  -- Notes
  reason text,
  notes text,
  
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_movements_dealer ON inventory_movements(dealer_id);
CREATE INDEX idx_movements_product ON inventory_movements(product_id);
CREATE INDEX idx_movements_variant ON inventory_movements(variant_id);
CREATE INDEX idx_movements_batch ON inventory_movements(batch_id);
CREATE INDEX idx_movements_type ON inventory_movements(movement_type);
CREATE INDEX idx_movements_date ON inventory_movements(movement_date);
CREATE INDEX idx_movements_reference ON inventory_movements(reference_type, reference_id);
10. STOCK_ADJUSTMENTS Table
SQL

CREATE TABLE stock_adjustments (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  adjustment_number varchar UNIQUE NOT NULL, -- ADJ-2024-001
  dealer_id uuid REFERENCES dealers(id),
  
  -- Type
  adjustment_type varchar CHECK (adjustment_type IN (
    'physical_count',  -- After physical counting
    'damage',         -- Damaged goods
    'expired',        -- Expired products
    'theft',          -- Stolen items
    'correction'      -- Data entry correction
  )),
  
  -- Status
  status varchar DEFAULT 'draft' CHECK (status IN (
    'draft', 'pending_approval', 'approved', 'rejected'
  )),
  
  -- Approval
  approved_by uuid REFERENCES profiles(id),
  approved_at timestamptz,
  rejection_reason text,
  
  -- Summary
  total_items integer DEFAULT 0,
  total_value_impact numeric DEFAULT 0, -- +ve or -ve
  
  -- Meta
  reason text NOT NULL,
  notes text,
  performed_by uuid REFERENCES profiles(id),
  adjustment_date date NOT NULL,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE stock_adjustment_items (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  adjustment_id uuid REFERENCES stock_adjustments(id) ON DELETE CASCADE,
  
  product_id uuid REFERENCES products(id),
  variant_id uuid REFERENCES product_variants(id),
  batch_id uuid REFERENCES inventory_batches(id),
  
  -- Quantities
  system_quantity integer NOT NULL, -- What system shows
  actual_quantity integer NOT NULL, -- What was counted
  difference integer GENERATED ALWAYS AS (actual_quantity - system_quantity) STORED,
  
  -- Value Impact
  unit_cost numeric,
  value_impact numeric GENERATED ALWAYS AS (
    (actual_quantity - system_quantity) * unit_cost
  ) STORED,
  
  reason text,
  created_at timestamptz DEFAULT now()
);
11. PAYMENT_TRANSACTIONS Table
SQL

CREATE TABLE payment_transactions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  transaction_number varchar UNIQUE NOT NULL, -- TXN-2024-0001
  dealer_id uuid REFERENCES dealers(id),
  
  -- Transaction Type
  transaction_type varchar CHECK (transaction_type IN (
    'sale_payment',        -- Customer payment for sale
    'purchase_payment',    -- Payment to vendor
    'expense',            -- Business expense
    'vendor_refund',      -- Refund from vendor
    'customer_refund'     -- Refund to customer
  )),
  
  -- References
  reference_type varchar, -- 'sale', 'purchase_order', 'expense'
  reference_id uuid,
  reference_number varchar,
  
  -- Parties
  vendor_id uuid REFERENCES vendors(id),
  customer_id uuid REFERENCES profiles(id),
  
  -- Payment Details
  payment_method varchar CHECK (payment_method IN (
    'cash', 'card', 'mobile_banking', 'bank_transfer', 'cheque'
  )),
  amount numeric NOT NULL,
  
  -- Bank Details (if applicable)
  bank_name varchar,
  account_number varchar,
  transaction_id varchar, -- bKash/Nagad transaction ID
  cheque_number varchar,
  cheque_date date,
  
  -- Status
  status varchar DEFAULT 'completed' CHECK (status IN (
    'pending', 'completed', 'failed', 'cancelled'
  )),
  
  -- Metadata
  notes text,
  received_by uuid REFERENCES profiles(id),
  payment_date date NOT NULL,
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_payment_txn_dealer ON payment_transactions(dealer_id);
CREATE INDEX idx_payment_txn_type ON payment_transactions(transaction_type);
CREATE INDEX idx_payment_txn_date ON payment_transactions(payment_date);
12. EXPENSES Table
SQL

CREATE TABLE expense_categories (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name varchar NOT NULL,
  description text,
  parent_id uuid REFERENCES expense_categories(id),
  is_active boolean DEFAULT true,
  created_at timestamptz DEFAULT now()
);

-- Seed data
INSERT INTO expense_categories (name) VALUES
('Rent'),
('Utilities'),
('Salaries'),
('Transportation'),
('Marketing'),
('Maintenance'),
('Office Supplies');

CREATE TABLE expenses (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  expense_number varchar UNIQUE NOT NULL, -- EXP-2024-001
  dealer_id uuid REFERENCES dealers(id),
  
  category_id uuid REFERENCES expense_categories(id),
  
  -- Details
  title varchar NOT NULL,
  description text,
  amount numeric NOT NULL,
  
  -- Payment
  payment_method varchar,
  payment_transaction_id uuid REFERENCES payment_transactions(id),
  
  -- Vendor (if applicable)
  vendor_id uuid REFERENCES vendors(id),
  
  -- Documents
  receipt_url text,
  
  -- Date
  expense_date date NOT NULL,
  
  -- Status
  status varchar DEFAULT 'paid' CHECK (status IN (
    'pending', 'paid', 'cancelled'
  )),
  
  -- Approval
  approved_by uuid REFERENCES profiles(id),
  
  created_by uuid REFERENCES profiles(id),
  created_at timestamptz DEFAULT now()
);
13. CUSTOMER_LEDGER Table (For Credit Sales)
SQL

CREATE TABLE customer_ledger (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  dealer_id uuid REFERENCES dealers(id),
  customer_id uuid REFERENCES profiles(id),
  
  -- Transaction
  transaction_type varchar CHECK (transaction_type IN (
    'sale',           -- Credit sale
    'payment',        -- Payment received
    'refund',         -- Refund given
    'adjustment'      -- Manual adjustment
  )),
  
  -- Reference
  reference_type varchar,
  reference_id uuid,
  reference_number varchar,
  
  -- Amount
  debit numeric DEFAULT 0,   -- What customer owes
  credit numeric DEFAULT 0,  -- What customer paid
  balance numeric,           -- Running balance
  
  -- Details
  description text,
  transaction_date date NOT NULL,
  
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_customer_ledger_customer ON customer_ledger(customer_id);
CREATE INDEX idx_customer_ledger_date ON customer_ledger(transaction_date);
14. VENDOR_LEDGER Table
SQL

CREATE TABLE vendor_ledger (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  dealer_id uuid REFERENCES dealers(id),
  vendor_id uuid REFERENCES vendors(id),
  
  -- Transaction
  transaction_type varchar CHECK (transaction_type IN (
    'purchase',       -- Purchase made (we owe)
    'payment',        -- Payment made (we paid)
    'return',         -- Goods returned (reduce debt)
    'adjustment'
  )),
  
  -- Reference
  reference_type varchar,
  reference_id uuid,
  reference_number varchar,
  
  -- Amount
  debit numeric DEFAULT 0,   -- What we paid/returned
  credit numeric DEFAULT 0,  -- What we owe
  balance numeric,           -- Running balance (what we owe)
  
  -- Details
  description text,
  transaction_date date NOT NULL,
  
  created_at timestamptz DEFAULT now()
);

CREATE INDEX idx_vendor_ledger_vendor ON vendor_ledger(vendor_id);
CREATE INDEX idx_vendor_ledger_date ON vendor_ledger(transaction_date);
ğŸ”„ Complete Workflows (Step-by-Step)
WORKFLOW 1: Initial System Setup
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Master Data Setup (One-time, Admin)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1.1 Create Categories Hierarchy:
    â””â”€â”€ Lubricants
        â”œâ”€â”€ Engine Oil
        â”‚   â”œâ”€â”€ 2-Stroke
        â”‚   â””â”€â”€ 4-Stroke
        â”œâ”€â”€ Gear Oil
        â””â”€â”€ Brake Oil
    â””â”€â”€ Filters
        â”œâ”€â”€ Oil Filter
        â”œâ”€â”€ Air Filter
        â””â”€â”€ Fuel Filter
    â””â”€â”€ Batteries
    â””â”€â”€ Spark Plugs

1.2 Create Brands:
    - Castrol (Logo, Country, Description)
    - Mobil
    - Shell
    - Motul
    - Total

1.3 Create Attribute Sets per Category:

    For "Engine Oil":
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Attribute Name  â”‚ Type     â”‚ Variantâ”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Viscosity       â”‚ Select   â”‚ No     â”‚
    â”‚   - 10W-30                           â”‚
    â”‚   - 10W-40                           â”‚
    â”‚   - 20W-50                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Type            â”‚ Select   â”‚ No     â”‚
    â”‚   - Mineral                          â”‚
    â”‚   - Semi-Synthetic                   â”‚
    â”‚   - Fully Synthetic                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Size/Volume     â”‚ Select   â”‚ YES âœ“  â”‚
    â”‚   - 800ml                            â”‚
    â”‚   - 1L                               â”‚
    â”‚   - 2L                               â”‚
    â”‚   - 4L                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Bike Type       â”‚ Multi    â”‚ No     â”‚
    â”‚   - 2-Stroke                         â”‚
    â”‚   - 4-Stroke                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Dealer Setup                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2.1 Create Vendor:
    Name: ABC Distributors Ltd.
    Code: VEN-001
    Contact Person: Mr. Karim
    Phone: 01711-XXXXXX
    Email: abc@example.com
    Payment Terms: 30 Days Credit
    Credit Limit: 500,000 BDT

2.2 Add Multiple Vendors:
    - VEN-002: XYZ Trading
    - VEN-003: Local Supplier
    - VEN-004: Import House

2.3 Setup Warehouse Locations:
    - Main Store
    - Rack-A (Shelf 1-10)
    - Rack-B (Shelf 1-10)
WORKFLOW 2: Product Creation (First Time)
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Creating: Castrol POWER1 4T Engine Oil                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: Basic Product Information
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Category: Lubricants > Engine Oil > 4-Stroke
Brand: Castrol
Product Name: POWER1 4T
SKU Prefix: CAST-P1

STEP 2: Product Attributes (Non-Variant)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Viscosity: 10W-40
Type: Semi-Synthetic
Bike Type: 4-Stroke
Description: Premium engine oil for 4-stroke motorcycles

STEP 3: Variant Attributes (Size-based)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
System auto-generates variants based on "Size" attribute:

Variant 1:
  - Size: 800ml
  - Auto-generated SKU: CAST-P1-800ML
  - Barcode: [Can be auto-generated or manual]
  - Base Selling Price: 680 BDT
  - MRP: 720 BDT
  - Initial Stock: 0 (will be added via purchase)

Variant 2:
  - Size: 1L
  - SKU: CAST-P1-1L
  - Barcode: 8901030896453 (EAN-13)
  - Base Selling Price: 850 BDT
  - MRP: 900 BDT
  - Initial Stock: 0

Variant 3:
  - Size: 4L
  - SKU: CAST-P1-4L
  - Barcode: 8901030896460
  - Base Selling Price: 3200 BDT
  - MRP: 3400 BDT
  - Initial Stock: 0

STEP 4: Additional Product Info
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Images: Upload 4 images
  - Primary image
  - Back label
  - Cap/seal
  - Product in use

Weight: 1kg (per liter)
Dimensions: 10cm Ã— 8cm Ã— 25cm

Low Stock Alert: 10 units
Reorder Level: 15 units

STEP 5: Save Product
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Status: Draft â†’ Submit for Approval â†’ Active

Database Entries Created:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ products table:                     â”‚
â”‚   - 1 row (main product)            â”‚
â”‚                                     â”‚
â”‚ product_variants table:             â”‚
â”‚   - 3 rows (800ml, 1L, 4L)         â”‚
â”‚                                     â”‚
â”‚ product_images table:               â”‚
â”‚   - 4 rows (images)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Current Stock: ALL VARIANTS = 0
WORKFLOW 3: Purchase Order (Stock In)
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PURCHASE ORDER CREATION - Complete Flow                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: Create Purchase Order Header
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PO Number: PO-2024-001 (Auto-generated)
Vendor: ABC Distributors (VEN-001)
Order Date: 15-Jan-2024
Expected Delivery: 20-Jan-2024
Warehouse: Main Store

STEP 2: Add Items to PO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Item 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product Search: "Castrol POWER1"            â”‚
â”‚   â†’ Shows: Castrol POWER1 4T                â”‚
â”‚                                             â”‚
â”‚ Select Variant: 1L (CAST-P1-1L)            â”‚
â”‚                                             â”‚
â”‚ Ordered Quantity: 100 pcs                   â”‚
â”‚ Unit Cost Price: 720 BDT                    â”‚
â”‚ Subtotal: 72,000 BDT                       â”‚
â”‚                                             â”‚
â”‚ Discount: 5% = 3,600 BDT                   â”‚
â”‚ Net Amount: 68,400 BDT                     â”‚
â”‚                                             â”‚
â”‚ Batch Number: LOT-CAST-JAN24-001           â”‚
â”‚ Manufacturing Date: Dec-2023                â”‚
â”‚ Expiry Date: Dec-2026 (3 years)            â”‚
â”‚                                             â”‚
â”‚ Barcode: Generate unique batch barcode      â”‚
â”‚         BCH-2024-00001                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Item 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product: Castrol POWER1 4T                  â”‚
â”‚ Variant: 800ml (CAST-P1-800ML)             â”‚
â”‚                                             â”‚
â”‚ Ordered Quantity: 50 pcs                    â”‚
â”‚ Unit Cost Price: 580 BDT                    â”‚
â”‚ Subtotal: 29,000 BDT                       â”‚
â”‚ Discount: 5% = 1,450 BDT                   â”‚
â”‚ Net Amount: 27,550 BDT                     â”‚
â”‚                                             â”‚
â”‚ Batch: LOT-CAST-JAN24-002                  â”‚
â”‚ Mfg: Dec-2023, Exp: Dec-2026               â”‚
â”‚ Barcode: BCH-2024-00002                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Item 3:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product: Mobil Super Moto 4T                â”‚
â”‚ Variant: 1L                                 â”‚
â”‚ Quantity: 80 pcs                            â”‚
â”‚ Unit Cost: 650 BDT                          â”‚
â”‚ Subtotal: 52,000 BDT                       â”‚
â”‚ Discount: 10% = 5,200 BDT                  â”‚
â”‚ Net: 46,800 BDT                            â”‚
â”‚ Batch: LOT-MOB-JAN24-001                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: Financial Summary
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Items Subtotal:     153,000 BDT
Total Discount:      10,250 BDT
After Discount:     142,750 BDT
Shipping Cost:        2,000 BDT
Other Charges:          500 BDT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Grand Total:        145,250 BDT

Payment Terms: 30 Days Credit
Due Date: 15-Feb-2024

STEP 4: Save as Draft
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Status: Draft
(Can edit, add more items)

STEP 5: Submit/Confirm PO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Status: Draft â†’ Pending
(PO sent to vendor, waiting confirmation)

STEP 6: Vendor Confirms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Status: Pending â†’ Confirmed
Confirmed Date: 16-Jan-2024

STEP 7: Receive Goods (GRN - Goods Receipt Note)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Received Date: 20-Jan-2024
Received By: Staff User (Salesman-001)

Quality Check:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Item 1: Castrol 1L
  - Ordered: 100 pcs
  - Received: 100 pcs âœ“
  - Damaged: 2 pcs (seal broken)
  - Accepted: 98 pcs
  - Quality Status: Partial (due to damage)
  - Notes: "2 bottles seal damaged"

Item 2: Castrol 800ml
  - Ordered: 50 pcs
  - Received: 50 pcs âœ“
  - Damaged: 0 pcs
  - Accepted: 50 pcs
  - Quality Status: Passed âœ“

Item 3: Mobil 1L
  - Ordered: 80 pcs
  - Received: 80 pcs âœ“
  - Damaged: 0 pcs
  - Accepted: 80 pcs
  - Quality Status: Passed âœ“

STEP 8: Backend Processing (Automatic)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

8.1 Update Purchase Order Items:
    - received_quantity updated
    - damaged_quantity updated
    - accepted_quantity calculated
    - quality_status updated

8.2 Create Inventory Batches:
    
    Batch 1: LOT-CAST-JAN24-001
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product: Castrol POWER1 4T           â”‚
    â”‚ Variant: 1L                          â”‚
    â”‚ Batch Number: LOT-CAST-JAN24-001     â”‚
    â”‚ Barcode: BCH-2024-00001              â”‚
    â”‚ Initial Quantity: 98                 â”‚
    â”‚ Current Quantity: 98                 â”‚
    â”‚ Unit Cost: 720 BDT                   â”‚
    â”‚ Manufacturing: Dec-2023              â”‚
    â”‚ Expiry: Dec-2026                     â”‚
    â”‚ Location: Main Store > Rack-A > S1   â”‚
    â”‚ Status: Active                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Batch 2: LOT-CAST-JAN24-002
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product: Castrol POWER1 4T           â”‚
    â”‚ Variant: 800ml                       â”‚
    â”‚ Quantity: 50                         â”‚
    â”‚ Cost: 580 BDT                        â”‚
    â”‚ Location: Rack-A > S2                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Batch 3: LOT-MOB-JAN24-001
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product: Mobil Super Moto 4T         â”‚
    â”‚ Variant: 1L                          â”‚
    â”‚ Quantity: 80                         â”‚
    â”‚ Cost: 650 BDT                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8.3 Update Product Variants Stock:
    
    UPDATE product_variants
    SET stock_quantity = stock_quantity + accepted_quantity
    
    - CAST-P1-1L: 0 + 98 = 98 units
    - CAST-P1-800ML: 0 + 50 = 50 units
    - MOB-SUP-1L: 0 + 80 = 80 units

8.4 Create Inventory Movements:
    
    Movement 1:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product: Castrol POWER1 4T 1L        â”‚
    â”‚ Batch: LOT-CAST-JAN24-001            â”‚
    â”‚ Type: purchase                       â”‚
    â”‚ Quantity Before: 0                   â”‚
    â”‚ Quantity Change: +98                 â”‚
    â”‚ Quantity After: 98                   â”‚
    â”‚ Unit Cost: 720 BDT                   â”‚
    â”‚ Total Value: 70,560 BDT              â”‚
    â”‚ Reference: PO-2024-001               â”‚
    â”‚ Date: 20-Jan-2024                    â”‚
    â”‚ Performed By: Staff-001              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    (Similar entries for other 2 items)

8.5 Update Vendor Ledger:
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Vendor: ABC Distributors             â”‚
    â”‚ Type: purchase                       â”‚
    â”‚ Debit: 0                             â”‚
    â”‚ Credit: 145,250 BDT (we owe)        â”‚
    â”‚ Balance: 145,250 BDT                â”‚
    â”‚ Reference: PO-2024-001               â”‚
    â”‚ Description: Purchase as per PO-001  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8.6 Update Purchase Order Status:
    Status: Confirmed â†’ Received

8.7 Handle Damaged Goods:
    
    Create Stock Adjustment:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Adjustment: ADJ-2024-001             â”‚
    â”‚ Type: damage                         â”‚
    â”‚ Product: Castrol 1L                  â”‚
    â”‚ Batch: LOT-CAST-JAN24-001            â”‚
    â”‚ System Qty: 100 (ordered)            â”‚
    â”‚ Actual Qty: 98 (accepted)            â”‚
    â”‚ Difference: -2                       â”‚
    â”‚ Value Impact: -1,440 BDT             â”‚
    â”‚ Reason: Seal broken during transit   â”‚
    â”‚ Status: Auto-approved                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 9: Payment Entry (Later - when paying vendor)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Payment Date: 10-Feb-2024 (before due date)
Amount: 145,250 BDT
Method: Bank Transfer
Bank: DBBL, Account: 123456789
Transaction ID: TXN-2024-DBBL-001

Backend:
â”€â”€â”€â”€â”€â”€â”€â”€
1. Create Payment Transaction:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Type: purchase_payment               â”‚
   â”‚ Amount: 145,250 BDT                  â”‚
   â”‚ Reference: PO-2024-001               â”‚
   â”‚ Vendor: ABC Distributors             â”‚
   â”‚ Method: bank_transfer                â”‚
   â”‚ Status: completed                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Update Vendor Ledger:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Type: payment                        â”‚
   â”‚ Debit: 145,250 BDT (we paid)        â”‚
   â”‚ Credit: 0                            â”‚
   â”‚ Balance: 0 (fully paid)              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Update Purchase Order:
   Payment Status: unpaid â†’ paid
   Paid Amount: 145,250 BDT
   Due Amount: 0 BDT

FINAL STATE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Purchase Order Completed & Paid
âœ“ Stock Received & Updated
âœ“ Batches Created
âœ“ Movements Logged
âœ“ Vendor Ledger Updated
âœ“ Ready for Sale
WORKFLOW 4: Sales Entry (Stock Out)
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RETAIL SALE - Complete Flow                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario: Customer walks in to buy engine oil

STEP 1: Create New Sale
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sale Number: SALE-2024-0001 (Auto)
Sale Date: 22-Jan-2024
Sale Time: 2:30 PM
Sale Type: Retail
Salesperson: Staff-001

Customer Info (Optional for walk-in):
  Name: Rahim Mia
  Phone: 01711-XXXXXX

STEP 2: Add Items (Method 1: Barcode Scan)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Scan Barcode: CAST-P1-1L (or BCH-2024-00001)
  â†“
System Auto-fills:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product: Castrol POWER1 4T                  â”‚
â”‚ Variant: 1L                                 â”‚
â”‚ Available Stock: 98 units                   â”‚
â”‚                                             â”‚
â”‚ Batch Selection (FIFO - First In First Out):â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Batch: LOT-CAST-JAN24-001               â”‚ â”‚
â”‚ â”‚ Available: 98 units                     â”‚ â”‚
â”‚ â”‚ Cost Price: 720 BDT                     â”‚ â”‚
â”‚ â”‚ Expiry: Dec-2026                        â”‚ â”‚
â”‚ â”‚ [Auto-selected - oldest batch first]    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ MRP: 900 BDT                               â”‚
â”‚ Selling Price: [850] BDT (editable)        â”‚
â”‚                                             â”‚
â”‚ Quantity: [5] pcs                          â”‚
â”‚                                             â”‚
â”‚ Line Total: 4,250 BDT                      â”‚
â”‚ Profit/Unit: 130 BDT                       â”‚
â”‚ Line Profit: 650 BDT                       â”‚
â”‚                                             â”‚
â”‚ [Add to Cart]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: Add More Items (Method 2: Manual Select)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Select Category: Engine Oil
Select Product: Castrol POWER1 4T
Select Variant: 800ml

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Available Stock: 50 units                   â”‚
â”‚ Batch: LOT-CAST-JAN24-002                  â”‚
â”‚ Cost: 580 BDT                               â”‚
â”‚ Selling Price: 680 BDT                      â”‚
â”‚ Quantity: 3 pcs                             â”‚
â”‚ Total: 2,040 BDT                           â”‚
â”‚ Profit: 300 BDT                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: Cart Summary
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SHOPPING CART                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  Product            Qty   Price    Total    Profit    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  Castrol POWER1 1L   5    850    4,250      650      â”‚
â”‚ 2  Castrol POWER1 800ml 3    680    2,040      300      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Subtotal:       6,290               â”‚
â”‚                                                         â”‚
â”‚ Discount Type: [Percentage â–¼]                          â”‚
â”‚ Discount Value: [5]%                                    â”‚
â”‚ Discount Amount:           -315 BDT                     â”‚
â”‚                                                         â”‚
â”‚ Tax (if any):                 0 BDT                     â”‚
â”‚                     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                  Grand Total: 5,975 BDT                 â”‚
â”‚                                                         â”‚
â”‚ Cost Price Total:            4,640 BDT                  â”‚
â”‚ Total Profit:                1,335 BDT                  â”‚
â”‚ Profit Margin:               22.3%                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 5: Payment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Payment Method: [Cash â–¼]
  Options: Cash, Card, bKash, Nagad, Bank, Credit

Amount Received: [6,000] BDT
Change to Return: 25 BDT

[Complete Sale]

STEP 6: Backend Processing (Automatic)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 Create Sale Record:
    
    INSERT INTO sales:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sale_number: SALE-2024-0001          â”‚
    â”‚ dealer_id: (current dealer)          â”‚
    â”‚ customer_name: Rahim Mia             â”‚
    â”‚ customer_phone: 01711-XXXXXX         â”‚
    â”‚ sale_type: retail                    â”‚
    â”‚ subtotal: 6,290                      â”‚
    â”‚ discount_amount: 315                 â”‚
    â”‚ grand_total: 5,975                   â”‚
    â”‚ total_cost: 4,640                    â”‚
    â”‚ total_profit: 1,335                  â”‚
    â”‚ profit_margin: 22.3                  â”‚
    â”‚ payment_method: cash                 â”‚
    â”‚ payment_status: paid                 â”‚
    â”‚ paid_amount: 6,000                   â”‚
    â”‚ sale_date: 22-Jan-2024               â”‚
    â”‚ sale_time: 14:30                     â”‚
    â”‚ sold_by: Staff-001                   â”‚
    â”‚ status: completed                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.2 Create Sale Items:
    
    Item 1:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sale_id: (sale record ID)            â”‚
    â”‚ product_id: Castrol POWER1 4T        â”‚
    â”‚ variant_id: 1L variant               â”‚
    â”‚ batch_id: LOT-CAST-JAN24-001         â”‚
    â”‚ batch_number: LOT-CAST-JAN24-001     â”‚
    â”‚ product_name: Castrol POWER1 4T      â”‚
    â”‚ variant_name: 1L                     â”‚
    â”‚ sku: CAST-P1-1L                      â”‚
    â”‚ barcode: BCH-2024-00001              â”‚
    â”‚ quantity: 5                          â”‚
    â”‚ unit_cost_price: 720                 â”‚
    â”‚ unit_selling_price: 850              â”‚
    â”‚ mrp: 900                             â”‚
    â”‚ subtotal: 4,250                      â”‚
    â”‚ discount_amount: 212.5 (pro-rata)    â”‚
    â”‚ total_amount: 4,037.5                â”‚
    â”‚ unit_profit: 130                     â”‚
    â”‚ total_profit: 650                    â”‚
    â”‚ status: sold                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Item 2: (Similar structure for 800ml)

6.3 Update Batch Quantities:
    
    Batch LOT-CAST-JAN24-001:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ current_quantity: 98 - 5 = 93        â”‚
    â”‚ sold_quantity: 0 + 5 = 5             â”‚
    â”‚ status: active                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Batch LOT-CAST-JAN24-002:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ current_quantity: 50 - 3 = 47        â”‚
    â”‚ sold_quantity: 0 + 3 = 3             â”‚
    â”‚ status: active                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.4 Update Product Variant Stock:
    
    UPDATE product_variants:
    - CAST-P1-1L: 98 - 5 = 93 units
    - CAST-P1-800ML: 50 - 3 = 47 units

6.5 Create Inventory Movements:
    
    Movement 1:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ product_id: Castrol POWER1 4T        â”‚
    â”‚ variant_id: 1L                       â”‚
    â”‚ batch_id: LOT-CAST-JAN24-001         â”‚
    â”‚ movement_type: sale                  â”‚
    â”‚ quantity_before: 98                  â”‚
    â”‚ quantity_change: -5                  â”‚
    â”‚ quantity_after: 93                   â”‚
    â”‚ unit_cost: 720                       â”‚
    â”‚ total_value: -3,600                  â”‚
    â”‚ reference_type: sale                 â”‚
    â”‚ reference_id: (sale ID)              â”‚
    â”‚ reference_number: SALE-2024-0001     â”‚
    â”‚ performed_by: Staff-001              â”‚
    â”‚ movement_date: 22-Jan-2024           â”‚
    â”‚ movement_time: 14:30                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Movement 2: (Similar for 800ml)

6.6 Create Payment Transaction:
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ transaction_type: sale_payment       â”‚
    â”‚ amount: 6,000                        â”‚
    â”‚ reference_type: sale                 â”‚
    â”‚ reference_id: (sale ID)              â”‚
    â”‚ reference_number: SALE-2024-0001     â”‚
    â”‚ payment_method: cash                 â”‚
    â”‚ status: completed                    â”‚
    â”‚ received_by: Staff-001               â”‚
    â”‚ payment_date: 22-Jan-2024            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.7 Update Product Statistics:
    
    UPDATE products:
    - total_sold: +8 (5+3)
    - total_revenue: +5,975
    - Update average_rating (if applicable)

STEP 7: Generate Receipt/Invoice
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MOTORBIKE PARTS STORE             â”‚
â”‚           123 Main Road, Dhaka              â”‚
â”‚           Phone: 01XXX-XXXXXX               â”‚
â”‚                                             â”‚
â”‚ Invoice: SALE-2024-0001                     â”‚
â”‚ Date: 22-Jan-2024  Time: 02:30 PM          â”‚
â”‚ Customer: Rahim Mia                         â”‚
â”‚ Phone: 01711-XXXXXX                         â”‚
â”‚ Served by: Salesman Ali                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Item             Qty  Price   Total         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Castrol POWER1    5   850    4,250         â”‚
â”‚   1L                                        â”‚
â”‚                                             â”‚
â”‚ Castrol POWER1    3   680    2,040         â”‚
â”‚   800ml                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        Subtotal: 6,290      â”‚
â”‚                    Discount(5%): -315       â”‚
â”‚                           Total: 5,975      â”‚
â”‚                                             â”‚
â”‚ Payment Method: Cash                        â”‚
â”‚ Amount Paid: 6,000                          â”‚
â”‚ Change: 25                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ You Saved: 315 BDT                          â”‚
â”‚                                             â”‚
â”‚ Thank you for your purchase!                â”‚
â”‚ Visit again!                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 8: Stock Alerts (Auto-check)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

After sale, system checks:

Product: Castrol POWER1 1L
  Current Stock: 93
  Low Stock Threshold: 10
  Status: OK âœ“

Product: Castrol POWER1 800ml
  Current Stock: 47
  Low Stock Threshold: 10
  Status: OK âœ“

(If stock < threshold, create alert/notification)

FINAL STATE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Sale Completed
âœ“ Stock Deducted
âœ“ Profit Calculated
âœ“ Movement Logged
âœ“ Payment Recorded
âœ“ Invoice Generated
âœ“ Ready for next sale
WORKFLOW 5: Daily Sales Report
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DAILY SALES REPORT - 22-Jan-2024                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SQL Query:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT 
  s.sale_number,
  s.sale_time,
  s.customer_name,
  p.name as product,
  pv.attributes->>'size' as size,
  si.quantity,
  si.unit_cost_price as cost,
  si.unit_selling_price as price,
  si.total_amount,
  si.total_profit,
  s.payment_method,
  u.full_name as sold_by
FROM sales s
JOIN sale_items si ON s.id = si.sale_id
JOIN products p ON si.product_id = p.id
JOIN product_variants pv ON si.variant_id = pv.id
LEFT JOIN profiles u ON s.sold_by = u.id
WHERE s.sale_date = '2024-01-22'
  AND s.dealer_id = :dealer_id
  AND s.status = 'completed'
ORDER BY s.sale_time;

Output:
â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Time  â”‚ Invoice       â”‚ Customer  â”‚ Product          â”‚ Qty â”‚ Price â”‚ Total â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10:15 â”‚ SALE-2024-001 â”‚ Rahim     â”‚ Castrol 1L       â”‚  5  â”‚  850  â”‚ 4,250 â”‚
â”‚       â”‚               â”‚           â”‚ Castrol 800ml    â”‚  3  â”‚  680  â”‚ 2,040 â”‚
â”‚       â”‚               â”‚           â”‚                  â”‚     â”‚       â”‚ 5,975 â”‚ (after discount)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 11:30 â”‚ SALE-2024-002 â”‚ Karim     â”‚ Mobil 1L         â”‚  2  â”‚  780  â”‚ 1,560 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 14:20 â”‚ SALE-2024-003 â”‚ Walk-in   â”‚ Castrol 1L       â”‚  1  â”‚  850  â”‚   850 â”‚
â”‚       â”‚               â”‚           â”‚ Shell 1L         â”‚  2  â”‚  820  â”‚ 1,640 â”‚
â”‚       â”‚               â”‚           â”‚                  â”‚     â”‚       â”‚ 2,490 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 16:45 â”‚ SALE-2024-004 â”‚ Sumon     â”‚ Castrol 4L       â”‚  1  â”‚ 3,200 â”‚ 3,200 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Daily Summary:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Invoices: 4
Total Items Sold: 14
Total Sales Amount: 13,225 BDT
Total Cost: 10,120 BDT
Total Profit: 3,105 BDT
Average Profit Margin: 23.5%

Payment Method Breakdown:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cash:     10,975 BDT (3 invoices)
bKash:     2,250 BDT (1 invoice)

Salesperson Performance:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ali:      8,465 BDT (2 sales)
Hasan:    4,760 BDT (2 sales)

Top Selling Products:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Castrol POWER1 1L    - 6 units
2. Castrol POWER1 800ml - 3 units
3. Mobil Super 1L       - 2 units
ğŸ“Š Advanced Reports & Analytics
1. Stock Valuation Report
SQL

-- Current Stock Value (FIFO Method)
SELECT 
  p.name as product,
  pv.attributes->>'size' as variant,
  pv.sku,
  pv.stock_quantity as current_stock,
  ib.batch_number,
  ib.current_quantity as batch_stock,
  ib.unit_cost_price,
  (ib.current_quantity * ib.unit_cost_price) as batch_value,
  ib.expiry_date,
  CASE 
    WHEN ib.expiry_date < CURRENT_DATE THEN 'Expired'
    WHEN ib.expiry_date < CURRENT_DATE + INTERVAL '90 days' THEN 'Expiring Soon'
    ELSE 'Good'
  END as status
FROM products p
JOIN product_variants pv ON p.id = pv.product_id
LEFT JOIN inventory_batches ib ON pv.id = ib.variant_id 
  AND ib.current_quantity > 0
WHERE p.dealer_id = :dealer_id
ORDER BY p.name, pv.sku, ib.received_date;

Output:
â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product          â”‚ Size  â”‚ Stock â”‚ Batch       â”‚ Cost â”‚ Value      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Castrol POWER1   â”‚ 1L    â”‚ 93    â”‚ LOT-JAN24-1 â”‚ 720  â”‚ 66,960     â”‚
â”‚ Castrol POWER1   â”‚ 800ml â”‚ 47    â”‚ LOT-JAN24-2 â”‚ 580  â”‚ 27,260     â”‚
â”‚ Mobil Super      â”‚ 1L    â”‚ 78    â”‚ LOT-JAN24-3 â”‚ 650  â”‚ 50,700     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      Total Inventory Value: 144,920  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
2. Profit & Loss Statement
SQL

-- Monthly P&L
WITH sales_summary AS (
  SELECT 
    SUM(grand_total) as total_revenue,
    SUM(total_cost) as cost_of_goods_sold,
    SUM(total_profit) as gross_profit
  FROM sales
  WHERE dealer_id = :dealer_id
    AND sale_date BETWEEN :start_date AND :end_date
    AND status = 'completed'
),
expense_summary AS (
  SELECT SUM(amount) as total_expenses
  FROM expenses
  WHERE dealer_id = :dealer_id
    AND expense_date BETWEEN :start_date AND :end_date
    AND status = 'paid'
)
SELECT 
  ss.total_revenue as "Revenue",
  ss.cost_of_goods_sold as "Cost of Goods Sold",
  ss.gross_profit as "Gross Profit",
  ROUND((ss.gross_profit / NULLIF(ss.total_revenue, 0)) * 100, 2) as "Gross Margin %",
  es.total_expenses as "Operating Expenses",
  (ss.gross_profit - es.total_expenses) as "Net Profit",
  ROUND(((ss.gross_profit - es.total_expenses) / NULLIF(ss.total_revenue, 0)) * 100, 2) as "Net Margin %"
FROM sales_summary ss, expense_summary es;

Output:
â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROFIT & LOSS STATEMENT                      â”‚
â”‚ Month: January 2024                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Revenue:                    450,000 BDT      â”‚
â”‚ Cost of Goods Sold:        -320,000 BDT      â”‚
â”‚                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Gross Profit:               130,000 BDT      â”‚
â”‚ Gross Margin:                  28.9%         â”‚
â”‚                                              â”‚
â”‚ Operating Expenses:                          â”‚
â”‚   Rent:                     -15,000 BDT      â”‚
â”‚   Salaries:                 -25,000 BDT      â”‚
â”‚   Utilities:                 -3,000 BDT      â”‚
â”‚   Others:                    -7,000 BDT      â”‚
â”‚                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Total Expenses:             -50,000 BDT      â”‚
â”‚                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Net Profit:                  80,000 BDT      â”‚
â”‚ Net Margin:                    17.8%         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
3. Product Performance Report
SQL

SELECT 
  p.name as product,
  pv.attributes->>'size' as variant,
  COUNT(DISTINCT si.sale_id) as times_sold,
  SUM(si.quantity) as total_units_sold,
  SUM(si.total_amount) as total_revenue,
  SUM(si.total_profit) as total_profit,
  ROUND(AVG(si.total_profit / NULLIF(si.total_amount, 0)) * 100, 2) as avg_margin,
  pv.stock_quantity as current_stock,
  CASE 
    WHEN pv.stock_quantity = 0 THEN 'Out of Stock'
    WHEN pv.stock_quantity < pv.low_stock_threshold THEN 'Low Stock'
    ELSE 'In Stock'
  END as stock_status
FROM products p
JOIN product_variants pv ON p.id = pv.product_id
LEFT JOIN sale_items si ON pv.id = si.variant_id
  AND si.created_at >= :start_date
WHERE p.dealer_id = :dealer_id
GROUP BY p.id, p.name, pv.id, pv.attributes, pv.stock_quantity
ORDER BY total_revenue DESC NULLS LAST;

Output:
â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Product           â”‚ Variant â”‚ Sold â”‚ Revenue â”‚ Profit â”‚ Margin â”‚ Stock â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Castrol POWER1    â”‚ 1L      â”‚  45  â”‚ 38,250  â”‚ 5,850  â”‚ 15.3%  â”‚ 55    â”‚
â”‚ Mobil Super       â”‚ 1L      â”‚  32  â”‚ 24,960  â”‚ 4,160  â”‚ 16.7%  â”‚ 48    â”‚
â”‚ Castrol POWER1    â”‚ 4L      â”‚  12  â”‚ 38,400  â”‚ 4,800  â”‚ 12.5%  â”‚ 8     â”‚ âš ï¸
â”‚ Shell Advance     â”‚ 1L      â”‚  28  â”‚ 22,400  â”‚ 3,920  â”‚ 17.5%  â”‚ 42    â”‚
â”‚ Castrol POWER1    â”‚ 800ml   â”‚  25  â”‚ 17,000  â”‚ 2,500  â”‚ 14.7%  â”‚ 25    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ Low Stock Alert
4. Vendor Performance Report
SQL

SELECT 
  v.name as vendor,
  v.code,
  COUNT(DISTINCT po.id) as total_orders,
  SUM(po.grand_total) as total_purchase_value,
  SUM(CASE WHEN po.payment_status = 'paid' THEN po.grand_total ELSE 0 END) as paid_amount,
  SUM(po.due_amount) as outstanding_amount,
  ROUND(AVG(po.received_date - po.order_date), 1) as avg_delivery_days,
  ROUND(AVG(v.average_rating), 1) as rating
FROM vendors v
LEFT JOIN purchase_orders po ON v.id = po.vendor_id
  AND po.order_date >= :start_date
WHERE v.dealer_id = :dealer_id
  AND v.status = 'active'
GROUP BY v.id, v.name, v.code, v.average_rating
ORDER BY total_purchase_value DESC;

Output:
â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vendor           â”‚ Orders â”‚ Total Value â”‚ Outstanding â”‚ Rating  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ABC Distributors â”‚   12   â”‚ 1,450,000   â”‚   145,000   â”‚ 4.5 â­  â”‚
â”‚ XYZ Trading      â”‚    8   â”‚   980,000   â”‚    50,000   â”‚ 4.2 â­  â”‚
â”‚ Local Supplier   â”‚    5   â”‚   420,000   â”‚         0   â”‚ 4.8 â­  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ¨ Advanced UI/UX Design
Dashboard Layout
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEALER DASHBOARD                              [Date: Today] â–¼  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Today Sales â”‚ â”‚ Today Profitâ”‚ â”‚ Items Sold  â”‚ â”‚ Customers â”‚â”‚
â”‚ â”‚   45,250    â”‚ â”‚   8,450     â”‚ â”‚     127     â”‚ â”‚    23     â”‚â”‚
â”‚ â”‚   â†‘ 12%     â”‚ â”‚   â†‘ 8%      â”‚ â”‚   â†‘ 15%     â”‚ â”‚  â†‘ 5%     â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  Sales Chart (Last 7 Days) â”‚ â”‚  Top Selling Products    â”‚   â”‚
â”‚ â”‚                            â”‚ â”‚                          â”‚   â”‚
â”‚ â”‚  [Line/Bar Chart]          â”‚ â”‚  1. Castrol 1L - 45 pcs  â”‚   â”‚
â”‚ â”‚                            â”‚ â”‚  2. Mobil 1L - 32 pcs    â”‚   â”‚
â”‚ â”‚                            â”‚ â”‚  3. Shell 1L - 28 pcs    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ALERTS & NOTIFICATIONS                               [View]â”‚â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ âš ï¸  5 products are low on stock                            â”‚â”‚â”‚
â”‚ â”‚ âš ï¸  2 products expiring within 30 days                     â”‚â”‚â”‚
â”‚ â”‚ âš ï¸  Outstanding payment to ABC Dist: 145,000 BDT          â”‚â”‚â”‚
â”‚ â”‚ â„¹ï¸  New order #12345 received                              â”‚â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Recent Sales             â”‚ â”‚ Pending Purchase Orders      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ SALE-001  Rahim  5,975   â”‚ â”‚ PO-025   ABC Dist   Pending  â”‚ â”‚
â”‚ â”‚ SALE-002  Karim  1,560   â”‚ â”‚ PO-026   XYZ Trade Confirmed â”‚ â”‚
â”‚ â”‚ SALE-003  Walk-in 2,490  â”‚ â”‚                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
POS (Point of Sale) Interface
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POINT OF SALE                          [Staff: Ali] [Sign Out] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PRODUCT SEARCH          â”‚  â”‚ SHOPPING CART                  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                         â”‚  â”‚ #  Item         Qty  Price     â”‚ â”‚
â”‚ â”‚ [ğŸ” Scan/Search______]  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                         â”‚  â”‚ 1  Castrol 1L    5   850   âœ•   â”‚ â”‚
â”‚ â”‚ â”Œâ”€ Quick Categories â”€â”€â” â”‚  â”‚ 2  Castrol 800ml 3   680   âœ•   â”‚ â”‚
â”‚ â”‚ â”‚ [Engine Oil]        â”‚ â”‚  â”‚                                â”‚ â”‚
â”‚ â”‚ â”‚ [Filters]           â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â”‚ [Batteries]         â”‚ â”‚  â”‚ Items: 2                       â”‚ â”‚
â”‚ â”‚ â”‚ [Spark Plugs]       â”‚ â”‚  â”‚ Qty: 8                         â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                                â”‚ â”‚
â”‚ â”‚                         â”‚  â”‚ Subtotal:      6,290           â”‚ â”‚
â”‚ â”‚ [Recent Products]       â”‚  â”‚ Discount (5%):  -315           â”‚ â”‚
â”‚ â”‚ â€¢ Castrol 1L            â”‚  â”‚ Tax:               0           â”‚ â”‚
â”‚ â”‚ â€¢ Mobil 1L              â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚ â”‚
â”‚ â”‚ â€¢ Shell 1L              â”‚  â”‚ TOTAL:         5,975           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚ â”‚
â”‚                              â”‚ Profit: 1,335 (22.3%)          â”‚ â”‚
â”‚                              â”‚                                â”‚ â”‚
â”‚                              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                              â”‚ â”‚ Customer (Optional)        â”‚ â”‚ â”‚
â”‚                              â”‚ â”‚ Name: [Rahim___]           â”‚ â”‚ â”‚
â”‚                              â”‚ â”‚ Phone: [01711____]         â”‚ â”‚ â”‚
â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                              â”‚                                â”‚ â”‚
â”‚                              â”‚ Payment Method:                â”‚ â”‚
â”‚                              â”‚ [Cash] [Card] [bKash] [Credit] â”‚ â”‚
â”‚                              â”‚                                â”‚ â”‚
â”‚                              â”‚ Amount Received: [6000___]     â”‚ â”‚
â”‚                              â”‚ Change: 25                     â”‚ â”‚
â”‚                              â”‚                                â”‚ â”‚
â”‚                              â”‚ [COMPLETE SALE]    [Clear]     â”‚ â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Keyboard Shortcuts:
F1 - New Sale
F2 - Search Product
F3 - Add Customer
F4 - Apply Discount
F5 - Cash Payment
F9 - Hold Sale
F12 - Complete Sale
ğŸ›¡ï¸ Business Rules & Validations
Purchase Order Validations
JavaScript

// Before creating PO
VALIDATE:
  âœ“ Vendor must be active
  âœ“ At least 1 item required
  âœ“ Quantities must be > 0
  âœ“ Unit cost must be > 0
  âœ“ Expected delivery date >= order date

// Before receiving goods
VALIDATE:
  âœ“ PO must be in 'confirmed' status
  âœ“ Received quantity <= ordered quantity
  âœ“ Damaged + Accepted = Received

// Stock update
RULE:
  Only add "accepted_quantity" to stock
  Log damaged items separately
  Create alert if damage % > threshold (e.g., 5%)
Sales Validations
JavaScript

// Before adding item to cart
VALIDATE:
  âœ“ Product must be active
  âœ“ Variant must be active
  âœ“ Stock must be available
  âœ“ Sale quantity <= available stock
  âœ“ Selling price should not be < cost price (warning, not error)

// Batch selection (FIFO)
RULE:
  Always pick oldest batch first (by received_date)
  If batch expires soon, show warning
  If batch expired, block sale

// Before completing sale
VALIDATE:
  âœ“ Cart must have items
  âœ“ Payment amount >= grand total (for cash)
  âœ“ Customer info required for credit sales
  âœ“ All batches still have stock (prevent race condition)

// Stock deduction (TRANSACTION)
BEGIN TRANSACTION;
  1. Lock product_variants row (FOR UPDATE)
  2. Check stock again
  3. Deduct stock
  4. Create sale records
  5. Log movements
COMMIT;

// If anything fails â†’ ROLLBACK
Stock Adjustment Rules
JavaScript

// Physical count adjustment
RULE:
  If difference > threshold (e.g., 10 units or 5%):
    Require manager approval
  Else:
    Auto-approve

  Always require reason
  Always log who performed

// Expiry management
AUTO-PROCESS:
  Daily job checks expiry dates
  If expired:
    - Move to 'expired' status
    - Create auto-adjustment
    - Don't show in sale
    - Alert dealer

// Damaged goods
PROCESS:
  - Create adjustment record
  - Deduct from batch
  - Update variant stock
  - Log movement
  - Option to return to vendor
ğŸ” Advanced Edge Cases & Solutions
Edge Case 1: Concurrent Sales (Same Product)
text

PROBLEM:
Two salespersons sell the same product simultaneously
Stock: 5 units
Person A sells: 3 units
Person B sells: 3 units
Total: 6 units (OVERSOLD!)

SOLUTION: Row-Level Locking
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

BEGIN TRANSACTION;

-- Lock the variant row
SELECT stock_quantity 
FROM product_variants 
WHERE id = :variant_id
FOR UPDATE; -- â† This locks the row

-- Check stock
IF stock_quantity < sale_quantity THEN
  ROLLBACK;
  RAISE ERROR 'Insufficient stock';
END IF;

-- Deduct
UPDATE product_variants
SET stock_quantity = stock_quantity - :sale_quantity
WHERE id = :variant_id;

-- Create sale records
INSERT INTO sales...
INSERT INTO sale_items...

COMMIT;

Result:
Person A's transaction commits first (3 sold, 2 remain)
Person B's transaction waits
When B's turn comes, stock = 2
Check fails: 2 < 3
Transaction rolls back
User sees: "Only 2 units available"
Edge Case 2: Partial Returns
text

SCENARIO:
Customer bought:
  - Castrol 1L Ã— 5 = 4,250 BDT
  - Castrol 800ml Ã— 3 = 2,040 BDT
Total: 6,290 BDT (After 5% discount: 5,975 BDT)

Customer returns:
  - Castrol 1L Ã— 2 (out of 5)

SOLUTION: Proportional Return
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Original Sale Item:
  Quantity: 5
  Unit Price: 850
  Discount on this item: 212.5 BDT (proportional)
  Final Unit Price: 807.5 BDT

Return Calculation:
  Return Qty: 2
  Return Amount: 2 Ã— 807.5 = 1,615 BDT
  
PROCESS:
1. Create return sale:
   Type: return
   Amount: -1,615 BDT (negative)
   Reference: Original SALE-2024-0001

2. Update original sale_item:
   returned_quantity: 0 â†’ 2
   net_quantity: 5 - 2 = 3

3. Add stock back:
   UPDATE product_variants
   SET stock_quantity = stock_quantity + 2

4. Add to batch:
   UPDATE inventory_batches
   SET current_quantity = current_quantity + 2,
       returned_quantity = returned_quantity + 2

5. Create movement:
   Type: return_from_customer
   Quantity: +2

6. Refund:
   Create payment_transaction:
   Type: customer_refund
   Amount: 1,615 BDT
Edge Case 3: Price Change After Purchase
text

SCENARIO:
Batch 1: Bought at 720 BDT (100 units)
Batch 2: Bought at 750 BDT (100 units) â† Price increased
Selling Price: 850 BDT (constant)

Customer buys 150 units

QUESTION: Which cost to use for profit?

SOLUTION: FIFO (First In First Out)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Sale breakdown:
  100 units from Batch 1 @ 720 BDT cost
  50 units from Batch 2 @ 750 BDT cost

Profit calculation:
  From Batch 1: 100 Ã— (850 - 720) = 13,000 BDT
  From Batch 2: 50 Ã— (850 - 750) = 5,000 BDT
  Total Profit: 18,000 BDT
  Average Profit/Unit: 120 BDT

IMPLEMENTATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT * FROM inventory_batches
WHERE variant_id = :variant_id
  AND current_quantity > 0
  AND status = 'active'
ORDER BY received_date ASC; -- FIFO

FOR each batch:
  IF remaining_sale_qty > 0:
    take_qty = MIN(batch.current_quantity, remaining_sale_qty)
    
    CREATE sale_item:
      batch_id: batch.id
      quantity: take_qty
      unit_cost: batch.unit_cost_price
      unit_selling_price: 850
      profit: (850 - batch.unit_cost_price) Ã— take_qty
    
    UPDATE batch:
      current_quantity -= take_qty
    
    remaining_sale_qty -= take_qty
Edge Case 4: Batch Expiry During Sale
text

SCENARIO:
Batch has expiry_date = today
Someone tries to sell it

SOLUTION: Real-time Validation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

BEFORE adding to cart:

SELECT 
  ib.*,
  CASE 
    WHEN ib.expiry_date < CURRENT_DATE THEN 'expired'
    WHEN ib.expiry_date = CURRENT_DATE THEN 'expires_today'
    WHEN ib.expiry_date < CURRENT_DATE + 7 THEN 'expires_soon'
    ELSE 'valid'
  END as expiry_status
FROM inventory_batches ib
WHERE ib.id = :batch_id;

IF expiry_status = 'expired':
  BLOCK sale
  Show: "This batch has expired. Cannot sell."
  Auto-create stock adjustment

ELSE IF expiry_status = 'expires_today':
  WARN: "This product expires today. Proceed?"
  Allow with confirmation

ELSE IF expiry_status = 'expires_soon':
  INFO: "Expires in X days"
  Allow sale
Edge Case 5: Multi-warehouse Transfer
text

SCENARIO:
Main Store has 100 units
Branch Store needs 50 units

SOLUTION: Transfer Process
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CREATE stock_transfer:
  from_location: Main Store
  to_location: Branch Store
  product: Castrol 1L
  batch: LOT-JAN24-001
  quantity: 50
  status: pending

PROCESS:
1. Deduct from Main Store:
   UPDATE inventory_batches
   SET current_quantity = 100 - 50 = 50
   WHERE location = 'Main Store'
   
   CREATE movement:
   Type: transfer_out
   Location: Main Store
   Qty: -50

2. Add to Branch Store:
   CREATE new batch OR update existing:
   INSERT INTO inventory_batches (
     batch_number: LOT-JAN24-001-BRANCH
     location: Branch Store
     current_quantity: 50
     ...
   )
   
   CREATE movement:
   Type: transfer_in
   Location: Branch Store
   Qty: +50

3. Update transfer status:
   status: pending â†’ completed
ğŸ“ˆ Performance Optimization
Database Indexes
SQL

-- Critical indexes for fast queries

-- Products
CREATE INDEX idx_products_dealer_category ON products(dealer_id, category_id);
CREATE INDEX idx_products_status ON products(dealer_id, status);
CREATE INDEX idx_products_name_search ON products USING gin(to_tsvector('english', name));

-- Variants
CREATE INDEX idx_variants_stock ON product_variants(stock_quantity) 
  WHERE stock_quantity < 10; -- Partial index for low stock

-- Sales
CREATE INDEX idx_sales_date_dealer ON sales(sale_date, dealer_id);
CREATE INDEX idx_sales_customer ON sales(dealer_id, customer_id);

-- Sale Items (covering index for profit reports)
CREATE INDEX idx_sale_items_profit ON sale_items(
  sale_id, product_id, variant_id, total_profit
);

-- Inventory Batches
CREATE INDEX idx_batches_expiry_alert ON inventory_batches(expiry_date, status)
  WHERE status = 'active' AND expiry_date IS NOT NULL;

-- Movements
CREATE INDEX idx_movements_date_type ON inventory_movements(
  dealer_id, movement_date, movement_type
);
Materialized Views for Reports
SQL

-- Daily sales summary (refresh every hour)
CREATE MATERIALIZED VIEW daily_sales_summary AS
SELECT 
  dealer_id,
  sale_date,
  COUNT(*) as total_invoices,
  SUM(grand_total) as total_sales,
  SUM(total_profit) as total_profit,
  SUM(CASE WHEN payment_method = 'cash' THEN grand_total ELSE 0 END) as cash_sales,
  SUM(CASE WHEN payment_method = 'card' THEN grand_total ELSE 0 END) as card_sales
FROM sales
WHERE status = 'completed'
GROUP BY dealer_id, sale_date;

CREATE UNIQUE INDEX ON daily_sales_summary(dealer_id, sale_date);

-- Refresh strategy
REFRESH MATERIALIZED VIEW CONCURRENTLY daily_sales_summary;

-- Use in queries
SELECT * FROM daily_sales_summary
WHERE dealer_id = :id 
  AND sale_date BETWEEN :start AND :end;
âœ… Complete Feature Checklist
text

PRODUCTS
âœ“ Multi-level categories
âœ“ Brand management
âœ“ Dynamic attributes per category
âœ“ Variant auto-generation
âœ“ Multiple images
âœ“ Barcode support
âœ“ SKU management
âœ“ Status workflow (draft â†’ pending â†’ active)
âœ“ Bulk import/export

INVENTORY
âœ“ Batch/lot tracking
âœ“ FIFO costing
âœ“ Multi-location support
âœ“ Expiry date tracking
âœ“ Low stock alerts
âœ“ Stock adjustments (with approval)
âœ“ Physical count
âœ“ Damaged goods handling
âœ“ Real-time stock updates
âœ“ Movement history

PURCHASE
âœ“ Vendor management
âœ“ Purchase orders
âœ“ GRN (Goods Receipt Note)
âœ“ Quality check
âœ“ Partial receiving
âœ“ Vendor ledger
âœ“ Payment tracking
âœ“ Purchase returns

SALES
âœ“ POS interface
âœ“ Barcode scanning
âœ“ Quick product search
âœ“ Customer management
âœ“ Multiple payment methods
âœ“ Discount management
âœ“ Credit sales
âœ“ Sale returns (full & partial)
âœ“ Invoice generation
âœ“ Receipt printing
âœ“ Customer ledger

REPORTS
âœ“ Daily sales report
âœ“ Sales summary (weekly/monthly)
âœ“ Profit & loss
âœ“ Stock valuation
âœ“ Product performance
âœ“ Vendor performance
âœ“ Salesperson performance
âœ“ Low stock report
âœ“ Expiry alert report
âœ“ Inventory movement report
âœ“ Payment collection report
âœ“ Outstanding payments

FINANCIALS
âœ“ Payment transactions
âœ“ Expense tracking
âœ“ Vendor payments
âœ“ Customer payments
âœ“ Cash flow
âœ“ Bank reconciliation

SECURITY
âœ“ Role-based access
âœ“ Row-level security (dealer isolation)
âœ“ Audit logs
âœ“ Transaction integrity
âœ“ Concurrent access control

ALERTS & NOTIFICATIONS
âœ“ Low stock alerts
âœ“ Expiry alerts
âœ“ Overdue payments
âœ“ New orders
âœ“ Daily sales summary
ğŸ¯ Summary
à¦à¦‡ planning à¦…à¦¨à§à¦¸à¦°à¦£ à¦•à¦°à¦²à§‡ à¦†à¦ªà¦¨à¦¿ à¦ªà¦¾à¦¬à§‡à¦¨:

Accuracy Guarantee:
âœ… Transaction-based stock updates
âœ… Row-level locking (concurrent sale prevention)
âœ… Batch tracking (FIFO costing)
âœ… Complete audit trail
âœ… Automatic validation
Business Value:
ğŸ’° Exact profit calculation per sale
ğŸ“Š Real-time inventory visibility
ğŸ“ˆ Comprehensive reports
ğŸ”” Proactive alerts
ğŸ’³ Complete financial tracking
Scalability:
ğŸ¢ Multi-dealer support
ğŸ“¦ Unlimited products
ğŸ”„ Unlimited transactions
ğŸ“ Multi-location ready
ğŸŒ Online integration ready
User Experience:
âš¡ Fast POS (barcode scan)
ğŸ¨ Intuitive UI
ğŸ“± Mobile responsive
ğŸ–¨ï¸ Print-ready invoices
ğŸ” Powerful search