Nazmul Hassan Shaown, [1/14/2026 3:31 AM]
┌─────────────────────────────────────────────────────────────────┐ │ │ │ PART 1: PROJECT OVERVIEW & TECH STACK │ │ PART 2: COMPLETE DATABASE SCHEMA (55 Tables) │ │ PART 3: ROLE & PERMISSION SYSTEM │ │ PART 4: bKASH PAYMENT INTEGRATION │ │ PART 5: PHASE-WISE DEVELOPMENT PLAN │ │ PART 6: SECURITY & SCALING ARCHITECTURE │ │ PART 7: API ENDPOINTS LIST │ │ PART 8: FOLDER STRUCTURE │ │ │ └─────────────────────────────────────────────────────────────────┘

Nazmul Hassan Shaown, [1/14/2026 3:32 AM]
┌─────────────────────────────────────────────────────────────────────────────────┐ │ DATABASE TABLE SUMMARY │ ├─────────────────────────────────────────────────────────────────────────────────┤ │ │ │ MODULE TABLES COUNT │ │ ═══════════════════════════════════════════════════════════════════════════ │ │ │ │ A. Authentication & Users 8 │ │ users, roles, permissions, role_permissions, │ │ user_sessions, audit_logs, otp_verifications, password_resets │ │ │ │ B. Dealer Management 6 │ │ dealers, dealer_users, dealer_documents, │ │ dealer_bank_accounts, dealer_settings, dealer_notifications │ │ │ │ C. Product Catalog 8 │ │ bike_models, categories, products, product_bike_models, │ │ product_images, product_variants, product_attributes, inventory │ │ │ │ D. Shopping 4 │ │ customer_addresses, carts, cart_items, wishlists │ │ │ │ E. Orders 4 │ │ orders, order_items, order_status_history, order_notes │ │ │ │ F. Payments & Finance 6 │ │ payments, refunds, commissions, dealer_payouts, │ │ payout_items, transactions │ │ │ │ G. Subscriptions 4 │ │ plans, plan_features, subscriptions, subscription_invoices │ │ │ │ H. Shipping 3 │ │ shipping_zones, shipping_methods, shipping_rates │ │ │ │ I. Marketing 4 │ │ coupons, coupon_usage, banners, promotions │ │ │ │ J. Reviews & Ratings 2 │ │ reviews, review_replies │ │ │ │ K. Support 3 │ │ support_tickets, ticket_messages, contact_messages │ │ │ │ L. CMS & Content 4 │ │ pages, faqs, email_templates, sms_templates │ │ │ │ M. Notifications 3 │ │ notifications, newsletter_subscribers, push_tokens │ │ │ │ N. System & Settings 3 │ │ settings, feature_flags, activity_logs │ │ │ │ ═══════════════════════════════════════════════════════════════════════════ │ │ │ │ TOTAL TABLES 62 │ │ │ └─────────────────────────────────────────────────────────────────────────────────┘

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
Module A

-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE A: AUTHENTICATION & USERS ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE A1: roles -- সিস্টেমে কী কী রোল আছে এবং তাদের ক্ষমতার লেভেল -- ============================================================================ CREATE TABLE roles ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Role Identity name VARCHAR(50) UNIQUE NOT NULL, display_name VARCHAR(100) NOT NULL, display_name_bn VARCHAR(100), description TEXT, -- Hierarchy (Lower number = Higher authority) -- Super Admin = 1, Admin = 2, ..., Customer = 99 level INTEGER NOT NULL DEFAULT 99, -- Role Type role_type VARCHAR(20) NOT NULL DEFAULT 'system' CHECK (role_type IN ('system', 'dealer', 'customer')), -- Status is_active BOOLEAN DEFAULT TRUE, is_system_role BOOLEAN DEFAULT FALSE, -- TRUE = Cannot delete -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Default Roles Insert INSERT INTO roles (name, display_name, display_name_bn, level, role_type, is_system_role) VALUES -- System Roles ('super_admin', 'Super Admin', 'সুপার অ্যাডমিন', 1, 'system', TRUE), ('admin', 'Admin', 'অ্যাডমিন', 2, 'system', TRUE), ('support', 'Support Staff', 'সাপোর্ট স্টাফ', 3, 'system', TRUE), ('accountant', 'Accountant', 'হিসাবরক্ষক', 4, 'system', TRUE), ('viewer', 'Viewer', 'ভিউয়ার', 5, 'system', TRUE), -- Dealer Roles ('dealer_owner', 'Dealer Owner', 'ডিলার মালিক', 10, 'dealer', TRUE), ('dealer_manager', 'Dealer Manager', 'ডিলার ম্যানেজার', 11, 'dealer', TRUE), ('dealer_staff', 'Dealer Staff', 'ডিলার স্টাফ', 12, 'dealer', TRUE), -- Customer Role ('customer', 'Customer', 'কাস্টমার', 99, 'customer', TRUE); -- Index CREATE INDEX idx_roles_level ON roles(level); CREATE INDEX idx_roles_type ON roles(role_type); -- ============================================================================ -- TABLE A2: users -- সব ধরনের ইউজার এখানে থাকবে -- ============================================================================ CREATE TABLE users ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Authentication email VARCHAR(255) UNIQUE NOT NULL, phone VARCHAR(20) UNIQUE, password_hash TEXT NOT NULL, -- Profile first_name VARCHAR(100) NOT NULL, last_name VARCHAR(100), full_name VARCHAR(200) GENERATED ALWAYS AS ( CASE WHEN last_name IS NOT NULL THEN first_name  ' '  last_name ELSE first_name END ) STORED, avatar_url TEXT, date_of_birth DATE, gender VARCHAR(10) CHECK (gender IN ('male', 'female', 'other')), -- Role & Access role_id UUID NOT NULL REFERENCES roles(id), -- Dealer Association (NULL for Admin/Customer) dealer_id UUID REFERENCES dealers(id) ON DELETE SET NULL, -- Status status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('active', 'inactive', 'suspended', 'pending', 'deleted')), -- Verification email_verified BOOLEAN DEFAULT FALSE, email_verified_at TIMESTAMPTZ, phone_verified BOOLEAN DEFAULT FALSE, phone_verified_at TIMESTAMPTZ, -- Security password_changed_at TIMESTAMPTZ DEFAULT NOW(), last_login_at TIMESTAMPTZ, last_login_ip INET, failed_login_count INTEGER DEFAULT 0, locked_until TIMESTAMPTZ, -- MFA (Multi-Factor Authentication) mfa_enabled BOOLEAN DEFAULT FALSE, mfa_secret TEXT, mfa_recovery_codes TEXT[], -- Preferences language VARCHAR(10) DEFAULT 'bn', timezone VARCHAR(50) DEFAULT 'Asia/Dhaka', -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), created_by UUID REFERENCES users(id), -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE ); -- Indexes CREATE INDEX idx_users_email ON users(email); CREATE INDEX idx_users_phone ON users(phone); CREATE INDEX idx_users_role ON users(role_id); CREATE INDEX idx_users_dealer ON users(dealer_id); CREATE INDEX idx_users_status ON users(status); CREATE INDEX idx_users_created ON users(created_at); -- Full Text Search Index CREATE INDEX idx_users_search ON users USING gin(to_tsvector('english', first_name  ' '

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
COALESCE(last_name, '')  ' '  email)); -- ============================================================================ -- TABLE A3: permissions -- সিস্টেমে কী কী কাজ করা যায় -- ============================================================================ CREATE TABLE permissions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Permission Identity name VARCHAR(100) UNIQUE NOT NULL, display_name VARCHAR(150) NOT NULL, display_name_bn VARCHAR(150), description TEXT, -- Grouping module VARCHAR(50) NOT NULL, -- Required Level (Lower level users automatically have this permission) required_level INTEGER NOT NULL DEFAULT 99, -- Status is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert All Permissions INSERT INTO permissions (name, display_name, module, required_level) VALUES -- ═══════════════════════════════════════════════════════════════ -- USER MANAGEMENT (Module: users) -- ═══════════════════════════════════════════════════════════════ ('users.view_all', 'View All Users', 'users', 2), ('users.view_own', 'View Own Profile', 'users', 99), ('users.create_admin', 'Create Admin Users', 'users', 1), ('users.create_support', 'Create Support Users', 'users', 2), ('users.edit', 'Edit Users', 'users', 2), ('users.delete', 'Delete Users', 'users', 1), ('users.suspend', 'Suspend Users', 'users', 2), ('users.force_logout', 'Force Logout Users', 'users', 1), ('users.reset_password', 'Reset User Password', 'users', 3), -- ═══════════════════════════════════════════════════════════════ -- DEALER MANAGEMENT (Module: dealers) -- ═══════════════════════════════════════════════════════════════ ('dealers.view_all', 'View All Dealers', 'dealers', 2), ('dealers.view_own', 'View Own Dealer Profile', 'dealers', 12), ('dealers.create', 'Create Dealer', 'dealers', 2), ('dealers.edit', 'Edit Dealer', 'dealers', 2), ('dealers.edit_own', 'Edit Own Dealer', 'dealers', 10), ('dealers.approve', 'Approve Dealer', 'dealers', 2), ('dealers.reject', 'Reject Dealer', 'dealers', 2), ('dealers.suspend', 'Suspend Dealer', 'dealers', 2), ('dealers.delete', 'Delete Dealer', 'dealers', 1), ('dealers.verify_documents', 'Verify Dealer Documents', 'dealers', 2), ('dealers.override_limits', 'Override Dealer Limits', 'dealers', 1), -- ═══════════════════════════════════════════════════════════════ -- DEALER TEAM MANAGEMENT (Module: dealer_team) -- ═══════════════════════════════════════════════════════════════ ('dealer_team.view', 'View Team Members', 'dealer_team', 12), ('dealer_team.add', 'Add Team Member', 'dealer_team', 11), ('dealer_team.edit', 'Edit Team Member', 'dealer_team', 11), ('dealer_team.remove', 'Remove Team Member', 'dealer_team', 10), ('dealer_team.set_permissions', 'Set Team Permissions', 'dealer_team', 10), -- ═══════════════════════════════════════════════════════════════ -- PRODUCT MANAGEMENT (Module: products) -- ═══════════════════════════════════════════════════════════════ ('products.view_all', 'View All Products', 'products', 2), ('products.view_own', 'View Own Products', 'products', 12), ('products.view_public', 'View Public Products', 'products', 99), ('products.create', 'Create Product', 'products', 12), ('products.edit', 'Edit Product', 'products', 12), ('products.delete', 'Delete Product', 'products', 11), ('products.approve', 'Approve Product', 'products', 2), ('products.reject', 'Reject Product', 'products', 2), ('products.block', 'Block Product', 'products', 2), ('products.feature', 'Feature Product', 'products', 2), ('products.bulk_import', 'Bulk Import Products', 'products', 10), ('products.bulk_export', 'Bulk Export Products', 'products', 10), -- ═══════════════════════════════════════════════════════════════ -- CATEGORY MANAGEMENT (Module: categories) -- ═══════════════════════════════════════════════════════════════ ('categories.view', 'View Categories', 'categories', 99), ('categories.create', 'Create Category', 'categories', 2), ('categories.edit', 'Edit Category', 'categories', 2), ('categories.delete', 'Delete Category', 'categories', 1), --

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
═══════════════════════════════════════════════════════════════ -- BIKE MODELS (Module: bike_models) -- ═══════════════════════════════════════════════════════════════ ('bike_models.view', 'View Bike Models', 'bike_models', 99), ('bike_models.manage', 'Manage Bike Models', 'bike_models', 2), -- ═══════════════════════════════════════════════════════════════ -- INVENTORY (Module: inventory) -- ═══════════════════════════════════════════════════════════════ ('inventory.view', 'View Inventory', 'inventory', 12), ('inventory.update', 'Update Stock', 'inventory', 12), ('inventory.adjust', 'Stock Adjustment', 'inventory', 11), ('inventory.history', 'View Stock History', 'inventory', 11), -- ═══════════════════════════════════════════════════════════════ -- ORDER MANAGEMENT (Module: orders) -- ═══════════════════════════════════════════════════════════════ ('orders.view_all', 'View All Orders', 'orders', 2), ('orders.view_own_dealer', 'View Own Dealer Orders', 'orders', 12), ('orders.view_own_customer', 'View Own Customer Orders', 'orders', 99), ('orders.create_admin', 'Create Order (Admin)', 'orders', 2), ('orders.place', 'Place Order', 'orders', 99), ('orders.confirm', 'Confirm Order', 'orders', 12), ('orders.process', 'Process Order', 'orders', 12), ('orders.ship', 'Ship Order', 'orders', 12), ('orders.deliver', 'Mark Delivered', 'orders', 11), ('orders.cancel', 'Cancel Order', 'orders', 11), ('orders.add_notes', 'Add Order Notes', 'orders', 12), ('orders.export', 'Export Orders', 'orders', 10), -- ═══════════════════════════════════════════════════════════════ -- PAYMENT & FINANCE (Module: payments) -- ═══════════════════════════════════════════════════════════════ ('payments.view_all', 'View All Payments', 'payments', 2), ('payments.view_own', 'View Own Payments', 'payments', 11), ('payments.process_refund', 'Process Refund', 'payments', 1), ('payments.approve_refund', 'Approve Refund', 'payments', 2), ('payments.request_refund', 'Request Refund', 'payments', 99), ('payments.settings', 'Payment Settings', 'payments', 1), -- ═══════════════════════════════════════════════════════════════ -- COMMISSION & PAYOUTS (Module: finance) -- ═══════════════════════════════════════════════════════════════ ('finance.view_all_commissions', 'View All Commissions', 'finance', 2), ('finance.view_own_commissions', 'View Own Commissions', 'finance', 11), ('finance.set_commission', 'Set Commission Rate', 'finance', 1), ('finance.view_all_payouts', 'View All Payouts', 'finance', 2), ('finance.view_own_payouts', 'View Own Payouts', 'finance', 11), ('finance.process_payout', 'Process Payout', 'finance', 1), ('finance.manage_bank', 'Manage Bank Account', 'finance', 10), -- ═══════════════════════════════════════════════════════════════ -- SUBSCRIPTION & PLANS (Module: subscriptions) -- ═══════════════════════════════════════════════════════════════ ('subscriptions.view_plans', 'View Plans', 'subscriptions', 10), ('subscriptions.manage_plans', 'Manage Plans', 'subscriptions', 1), ('subscriptions.view_all', 'View All Subscriptions', 'subscriptions', 2), ('subscriptions.view_own', 'View Own Subscription', 'subscriptions', 10), ('subscriptions.assign', 'Assign Subscription', 'subscriptions', 2), ('subscriptions.cancel', 'Cancel Subscription', 'subscriptions', 10), ('subscriptions.extend', 'Extend Subscription', 'subscriptions', 1), -- ═══════════════════════════════════════════════════════════════ -- COUPONS (Module: coupons) -- ═══════════════════════════════════════════════════════════════ ('coupons.view_all', 'View All Coupons', 'coupons', 2), ('coupons.view_own', 'View Own Coupons', 'coupons', 11), ('coupons.create_platform', 'Create Platform Coupon', 'coupons', 2), ('coupons.create_dealer', 'Create Dealer Coupon', 'coupons', 11), ('coupons.edit', 'Edit Coupon', 'coupons', 11), ('coupons.delete', 'Delete Coupon', 'coupons', 10), ('coupons.apply', 'Apply Coupon', 'coupons', 99), -- ═══════════════════════════════════════════════════════════════ -- REVIEWS (Module: reviews) -- ═══════════════════════════════════════════════════════════════

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
('reviews.view_all', 'View All Reviews', 'reviews', 2), ('reviews.view_public', 'View Public Reviews', 'reviews', 99), ('reviews.write', 'Write Review', 'reviews', 99), ('reviews.approve', 'Approve Review', 'reviews', 2), ('reviews.reject', 'Reject Review', 'reviews', 2), ('reviews.delete', 'Delete Review', 'reviews', 2), ('reviews.reply', 'Reply to Review', 'reviews', 11), -- ═══════════════════════════════════════════════════════════════ -- REPORTS (Module: reports) -- ═══════════════════════════════════════════════════════════════ ('reports.platform_dashboard', 'Platform Dashboard', 'reports', 2), ('reports.dealer_dashboard', 'Dealer Dashboard', 'reports', 12), ('reports.sales', 'Sales Report', 'reports', 11), ('reports.revenue', 'Revenue Report', 'reports', 11), ('reports.products', 'Product Report', 'reports', 11), ('reports.customers', 'Customer Report', 'reports', 2), ('reports.dealers', 'Dealer Report', 'reports', 2), ('reports.commission', 'Commission Report', 'reports', 10), ('reports.financial', 'Financial Report', 'reports', 1), ('reports.export_pdf', 'Export PDF', 'reports', 10), ('reports.export_excel', 'Export Excel', 'reports', 10), -- ═══════════════════════════════════════════════════════════════ -- SUPPORT (Module: support) -- ═══════════════════════════════════════════════════════════════ ('support.view_all_tickets', 'View All Tickets', 'support', 3), ('support.view_own_tickets', 'View Own Tickets', 'support', 99), ('support.create_ticket', 'Create Ticket', 'support', 99), ('support.reply_ticket', 'Reply to Ticket', 'support', 3), ('support.assign_ticket', 'Assign Ticket', 'support', 3), ('support.close_ticket', 'Close Ticket', 'support', 3), ('support.view_contact_messages', 'View Contact Messages', 'support', 3), -- ═══════════════════════════════════════════════════════════════ -- CMS & CONTENT (Module: cms) -- ═══════════════════════════════════════════════════════════════ ('cms.view_pages', 'View Pages', 'cms', 99), ('cms.manage_pages', 'Manage Pages', 'cms', 2), ('cms.manage_banners', 'Manage Banners', 'cms', 2), ('cms.manage_faqs', 'Manage FAQs', 'cms', 3), ('cms.manage_templates', 'Manage Email/SMS Templates', 'cms', 2), -- ═══════════════════════════════════════════════════════════════ -- SHIPPING (Module: shipping) -- ═══════════════════════════════════════════════════════════════ ('shipping.view_zones', 'View Shipping Zones', 'shipping', 10), ('shipping.manage_zones', 'Manage Shipping Zones', 'shipping', 2), ('shipping.view_methods', 'View Shipping Methods', 'shipping', 99), ('shipping.manage_methods', 'Manage Shipping Methods', 'shipping', 2), -- ═══════════════════════════════════════════════════════════════ -- NOTIFICATIONS (Module: notifications) -- ═══════════════════════════════════════════════════════════════ ('notifications.send_bulk', 'Send Bulk Notification', 'notifications', 2), ('notifications.manage_newsletter', 'Manage Newsletter', 'notifications', 2), -- ═══════════════════════════════════════════════════════════════ -- SYSTEM SETTINGS (Module: settings) -- ═══════════════════════════════════════════════════════════════ ('settings.view', 'View Settings', 'settings', 2), ('settings.edit_general', 'Edit General Settings', 'settings', 1), ('settings.edit_payment', 'Edit Payment Settings', 'settings', 1), ('settings.edit_locale', 'Edit Locale Settings', 'settings', 1), ('settings.manage_features', 'Manage Feature Flags', 'settings', 1), ('settings.maintenance_mode', 'Toggle Maintenance Mode', 'settings', 1), ('settings.edit_branding', 'Edit Branding', 'settings', 1), -- ═══════════════════════════════════════════════════════════════ -- AUDIT & SECURITY (Module: audit) -- ═══════════════════════════════════════════════════════════════ ('audit.view_logs', 'View Audit Logs', 'audit', 1), ('audit.export_logs', 'Export Audit Logs', 'audit', 1), ('audit.view_security_logs', 'View Security Logs', 'audit', 1), ('audit.manage_ip_allowlist', 'Manage IP Allowlist', 'audit', 1), ('audit.view_sessions', 'View Active Sessions', 'audit', 2), --

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
═══════════════════════════════════════════════════════════════ -- EMERGENCY ACTIONS (Module: emergency) -- ═══════════════════════════════════════════════════════════════ ('emergency.freeze_dealer', 'Freeze Dealer', 'emergency', 1), ('emergency.freeze_payments', 'Freeze Payments', 'emergency', 1), ('emergency.backup_database', 'Backup Database', 'emergency', 1), ('emergency.restore_database', 'Restore Database', 'emergency', 1), ('emergency.incident_report', 'Generate Incident Report', 'emergency', 2); -- Index CREATE INDEX idx_permissions_module ON permissions(module); CREATE INDEX idx_permissions_level ON permissions(required_level); -- ============================================================================ -- TABLE A4: role_permissions -- কোন রোলের কী কী পারমিশন আছে (Explicit assignment) -- ============================================================================ CREATE TABLE role_permissions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE, permission_id UUID NOT NULL REFERENCES permissions(id) ON DELETE CASCADE, -- Grant Type granted_by UUID REFERENCES users(id), granted_at TIMESTAMPTZ DEFAULT NOW(), -- Constraints UNIQUE(role_id, permission_id) ); -- Index CREATE INDEX idx_role_permissions_role ON role_permissions(role_id); CREATE INDEX idx_role_permissions_permission ON role_permissions(permission_id); -- ============================================================================ -- TABLE A5: user_sessions -- Active login sessions -- ============================================================================ CREATE TABLE user_sessions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- Token token_hash TEXT NOT NULL, refresh_token_hash TEXT, -- Device Info device_type VARCHAR(50), -- desktop, mobile, tablet device_name VARCHAR(255), browser VARCHAR(100), os VARCHAR(100), -- Location ip_address INET, country VARCHAR(100), city VARCHAR(100), -- User Agent user_agent TEXT, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, last_activity_at TIMESTAMPTZ DEFAULT NOW(), -- Status is_active BOOLEAN DEFAULT TRUE, revoked_at TIMESTAMPTZ, revoked_reason VARCHAR(255) ); -- Indexes CREATE INDEX idx_sessions_user ON user_sessions(user_id); CREATE INDEX idx_sessions_token ON user_sessions(token_hash); CREATE INDEX idx_sessions_active ON user_sessions(is_active, expires_at); -- ============================================================================ -- TABLE A6: audit_logs -- All important actions (IMMUTABLE - Cannot be edited or deleted) -- ============================================================================ CREATE TABLE audit_logs ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Who performed the action user_id UUID REFERENCES users(id), user_email VARCHAR(255), user_name VARCHAR(200), user_role VARCHAR(50), -- Dealer context (if applicable) dealer_id UUID REFERENCES dealers(id), dealer_name VARCHAR(255), -- What action was performed action VARCHAR(100) NOT NULL, action_type VARCHAR(20) NOT NULL CHECK (action_type IN ('create', 'read', 'update', 'delete', 'login', 'logout', 'export', 'import', 'approve', 'reject', 'other')), -- On what resource module VARCHAR(50) NOT NULL, resource_type VARCHAR(50), resource_id UUID, resource_name VARCHAR(255), -- Change details old_values JSONB, new_values JSONB, changed_fields TEXT[], -- Description description TEXT, -- Request context ip_address INET, user_agent TEXT, request_id UUID, request_url TEXT, request_method VARCHAR(10), -- Geolocation country VARCHAR(100), city VARCHAR(100), -- Timestamp created_at TIMESTAMPTZ DEFAULT NOW(), -- Severity severity VARCHAR(20) DEFAULT 'info' CHECK (severity IN ('debug', 'info', 'warning', 'error', 'critical')) ); -- Indexes CREATE INDEX idx_audit_user ON audit_logs(user_id); CREATE INDEX idx_audit_dealer ON audit_logs(dealer_id); CREATE INDEX idx_audit_action ON audit_logs(action); CREATE INDEX idx_audit_action_type ON audit_logs(action_type); CREATE INDEX idx_audit_module

Nazmul Hassan Shaown, [1/14/2026 3:33 AM]
ON audit_logs(module); CREATE INDEX idx_audit_resource ON audit_logs(resource_type, resource_id); CREATE INDEX idx_audit_created ON audit_logs(created_at DESC); CREATE INDEX idx_audit_severity ON audit_logs(severity); -- IMPORTANT: Prevent DELETE on audit_logs -- This will be enforced via RLS policies and triggers -- ============================================================================ -- TABLE A7: otp_verifications -- OTP for phone/email verification -- ============================================================================ CREATE TABLE otp_verifications ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Target identifier VARCHAR(255) NOT NULL, -- email or phone identifier_type VARCHAR(20) NOT NULL CHECK (identifier_type IN ('email', 'phone')), -- Purpose purpose VARCHAR(50) NOT NULL CHECK (purpose IN ( 'registration', 'login', 'password_reset', 'phone_verify', 'email_verify', 'order_confirm', 'withdrawal' )), -- OTP otp_code VARCHAR(10) NOT NULL, otp_hash TEXT NOT NULL, -- Attempts attempts INTEGER DEFAULT 0, max_attempts INTEGER DEFAULT 5, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, verified_at TIMESTAMPTZ, -- Status is_used BOOLEAN DEFAULT FALSE, -- Security ip_address INET, user_agent TEXT ); -- Indexes CREATE INDEX idx_otp_identifier ON otp_verifications(identifier, identifier_type); CREATE INDEX idx_otp_expires ON otp_verifications(expires_at); CREATE INDEX idx_otp_purpose ON otp_verifications(purpose); -- ============================================================================ -- TABLE A8: password_resets -- Password reset tokens -- ============================================================================ CREATE TABLE password_resets ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, email VARCHAR(255) NOT NULL, -- Token token_hash TEXT NOT NULL, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, used_at TIMESTAMPTZ, -- Status is_used BOOLEAN DEFAULT FALSE, -- Security ip_address INET, user_agent TEXT ); -- Indexes CREATE INDEX idx_password_reset_user ON password_resets(user_id); CREATE INDEX idx_password_reset_email ON password_resets(email); CREATE INDEX idx_password_reset_token ON password_resets(token_hash); CREATE INDEX idx_password_reset_expires ON password_resets(expires_at);

Nazmul Hassan Shaown, [1/14/2026 3:34 AM]
Dealer manager module B

-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE B: DEALER MANAGEMENT ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE B1: dealers -- মূল ডিলার/দোকান তথ্য -- ============================================================================ CREATE TABLE dealers ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- ═══════════════════════════════════════════════════════════════ -- BASIC INFO -- ═══════════════════════════════════════════════════════════════ business_name VARCHAR(255) NOT NULL, business_name_bn VARCHAR(255), -- বাংলায় নাম slug VARCHAR(255) UNIQUE NOT NULL, tagline VARCHAR(255), -- Contact email VARCHAR(255) NOT NULL, phone VARCHAR(20) NOT NULL, alt_phone VARCHAR(20), whatsapp VARCHAR(20), -- ═══════════════════════════════════════════════════════════════ -- LEGAL & BUSINESS -- ═══════════════════════════════════════════════════════════════ business_type VARCHAR(50) DEFAULT 'sole_proprietorship' CHECK (business_type IN ( 'sole_proprietorship', 'partnership', 'limited_company', 'other' )), trade_license_no VARCHAR(100), tin_number VARCHAR(50), bin_number VARCHAR(50), establishment_year INTEGER, -- ═══════════════════════════════════════════════════════════════ -- BRANDING -- ═══════════════════════════════════════════════════════════════ logo_url TEXT, banner_url TEXT, favicon_url TEXT, description TEXT, description_bn TEXT, -- Social Links website VARCHAR(255), facebook VARCHAR(255), instagram VARCHAR(255), youtube VARCHAR(255), -- ═══════════════════════════════════════════════════════════════ -- ADDRESS -- ═══════════════════════════════════════════════════════════════ address_line1 VARCHAR(255), address_line2 VARCHAR(255), area VARCHAR(100), city VARCHAR(100), district VARCHAR(100), division VARCHAR(100), postal_code VARCHAR(20), country VARCHAR(100) DEFAULT 'Bangladesh', -- Coordinates latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- ═══════════════════════════════════════════════════════════════ -- OWNERSHIP -- ═══════════════════════════════════════════════════════════════ owner_user_id UUID NOT NULL REFERENCES users(id), owner_name VARCHAR(255), owner_phone VARCHAR(20), owner_email VARCHAR(255), owner_nid VARCHAR(20), -- ═══════════════════════════════════════════════════════════════ -- STATUS & APPROVAL -- ═══════════════════════════════════════════════════════════════ status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'active', 'suspended', 'rejected', 'closed')), -- Application applied_at TIMESTAMPTZ DEFAULT NOW(), -- Approval approved_at TIMESTAMPTZ, approved_by UUID REFERENCES users(id), -- Rejection rejected_at TIMESTAMPTZ, rejected_by UUID REFERENCES users(id), rejection_reason TEXT, -- Suspension suspended_at TIMESTAMPTZ, suspended_by UUID REFERENCES users(id), suspended_reason TEXT, suspended_until TIMESTAMPTZ, -- Closure closed_at TIMESTAMPTZ, closure_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- SUBSCRIPTION -- ═══════════════════════════════════════════════════════════════ current_plan_id UUID REFERENCES plans(id), subscription_status VARCHAR(20) DEFAULT 'none' CHECK (subscription_status IN ('none', 'trial', 'active', 'expired', 'cancelled')), trial_ends_at DATE, subscription_ends_at DATE, -- ═══════════════════════════════════════════════════════════════ -- COMMISSION (Platform takes this percentage) -- ═══════════════════════════════════════════════════════════════ commission_type VARCHAR(20) DEFAULT 'percentage' CHECK (commission_type IN ('percentage', 'fixed', 'hybrid')), commission_rate DECIMAL(5,2) DEFAULT 10.00, -- 10% default fixed_commission DECIMAL(10,2) DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- LIMITS (Based on plan, can be overridden) -- ═══════════════════════════════════════════════════════════════ max_products INTEGER DEFAULT 50, max_users INTEGER DEFAULT 3, max_images_per_product INTEGER

Nazmul Hassan Shaown, [1/14/2026 3:34 AM]
DEFAULT 5, -- Overrides limits_overridden BOOLEAN DEFAULT FALSE, limits_override_by UUID REFERENCES users(id), limits_override_at TIMESTAMPTZ, limits_override_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- STATS (Denormalized for performance) -- ═══════════════════════════════════════════════════════════════ total_products INTEGER DEFAULT 0, total_orders INTEGER DEFAULT 0, total_revenue DECIMAL(15,2) DEFAULT 0, total_customers INTEGER DEFAULT 0, average_rating DECIMAL(3,2) DEFAULT 0, total_reviews INTEGER DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SETTINGS -- ═══════════════════════════════════════════════════════════════ auto_approve_orders BOOLEAN DEFAULT FALSE, notification_email VARCHAR(255), notification_phone VARCHAR(20), min_order_amount DECIMAL(10,2) DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SEO -- ═══════════════════════════════════════════════════════════════ meta_title VARCHAR(255), meta_description TEXT, meta_keywords TEXT[], -- ═══════════════════════════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE ); -- Indexes CREATE INDEX idx_dealers_slug ON dealers(slug); CREATE INDEX idx_dealers_status ON dealers(status); CREATE INDEX idx_dealers_owner ON dealers(owner_user_id); CREATE INDEX idx_dealers_plan ON dealers(current_plan_id); CREATE INDEX idx_dealers_subscription_status ON dealers(subscription_status); CREATE INDEX idx_dealers_district ON dealers(district); CREATE INDEX idx_dealers_created ON dealers(created_at); -- Full Text Search CREATE INDEX idx_dealers_search ON dealers USING gin(to_tsvector('english', business_name  ' '  COALESCE(description, ''))); -- ============================================================================ -- TABLE B2: dealer_users -- ডিলারের টিম মেম্বার -- ============================================================================ CREATE TABLE dealer_users ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- Role within dealer (uses same role table but filtered) dealer_role VARCHAR(20) NOT NULL DEFAULT 'staff' CHECK (dealer_role IN ('owner', 'manager', 'staff')), -- Granular Permissions (for staff customization) can_manage_products BOOLEAN DEFAULT TRUE, can_manage_orders BOOLEAN DEFAULT TRUE, can_view_reports BOOLEAN DEFAULT FALSE, can_manage_inventory BOOLEAN DEFAULT TRUE, can_manage_coupons BOOLEAN DEFAULT FALSE, can_manage_staff BOOLEAN DEFAULT FALSE, can_view_finance BOOLEAN DEFAULT FALSE, can_reply_reviews BOOLEAN DEFAULT FALSE, -- Status is_active BOOLEAN DEFAULT TRUE, -- Invitation invited_at TIMESTAMPTZ DEFAULT NOW(), invited_by UUID REFERENCES users(id), accepted_at TIMESTAMPTZ, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(dealer_id, user_id) ); -- Indexes CREATE INDEX idx_dealer_users_dealer ON dealer_users(dealer_id); CREATE INDEX idx_dealer_users_user ON dealer_users(user_id); CREATE INDEX idx_dealer_users_role ON dealer_users(dealer_role); -- ============================================================================ -- TABLE B3: dealer_documents -- ট্রেড লাইসেন্স, NID, etc. -- ============================================================================ CREATE TABLE dealer_documents ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Document Info document_type VARCHAR(50) NOT NULL CHECK (document_type IN ( 'trade_license', 'tin_certificate', 'bin_certificate', 'nid_front', 'nid_back', 'passport', 'bank_statement', 'utility_bill', 'store_photo', 'authorization_letter', 'other' )), document_name VARCHAR(255) NOT NULL, document_number VARCHAR(100), -- File file_url TEXT NOT NULL, file_name

Nazmul Hassan Shaown, [1/14/2026 3:34 AM]
VARCHAR(255), file_size INTEGER, -- bytes mime_type VARCHAR(100), -- Validity issue_date DATE, expiry_date DATE, -- Verification status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'verified', 'rejected', 'expired')), verified_at TIMESTAMPTZ, verified_by UUID REFERENCES users(id), rejection_reason TEXT, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), uploaded_by UUID REFERENCES users(id) ); -- Indexes CREATE INDEX idx_dealer_docs_dealer ON dealer_documents(dealer_id); CREATE INDEX idx_dealer_docs_type ON dealer_documents(document_type); CREATE INDEX idx_dealer_docs_status ON dealer_documents(status); -- ============================================================================ -- TABLE B4: dealer_bank_accounts -- পেমেন্ট সেটেলমেন্টের জন্য -- ============================================================================ CREATE TABLE dealer_bank_accounts ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Account Type account_type VARCHAR(20) NOT NULL DEFAULT 'bank' CHECK (account_type IN ('bank', 'bkash', 'nagad', 'rocket', 'upay')), -- Bank Details bank_name VARCHAR(100), branch_name VARCHAR(100), branch_code VARCHAR(50), routing_number VARCHAR(50), swift_code VARCHAR(20), -- Account Details account_name VARCHAR(255) NOT NULL, account_number VARCHAR(50) NOT NULL, account_type_detail VARCHAR(50), -- savings, current -- Mobile Banking mobile_number VARCHAR(20), -- Verification is_verified BOOLEAN DEFAULT FALSE, verified_at TIMESTAMPTZ, verified_by UUID REFERENCES users(id), verification_doc_url TEXT, -- Status is_primary BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_dealer_bank_dealer ON dealer_bank_accounts(dealer_id); CREATE INDEX idx_dealer_bank_type ON dealer_bank_accounts(account_type); CREATE INDEX idx_dealer_bank_primary ON dealer_bank_accounts(dealer_id, is_primary) WHERE is_primary = TRUE; -- ============================================================================ -- TABLE B5: dealer_settings -- ডিলার-specific সেটিংস -- ============================================================================ CREATE TABLE dealer_settings ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Key-Value key VARCHAR(100) NOT NULL, value TEXT, value_type VARCHAR(20) DEFAULT 'string' CHECK (value_type IN ('string', 'number', 'boolean', 'json')), -- Metadata updated_at TIMESTAMPTZ DEFAULT NOW(), updated_by UUID REFERENCES users(id), UNIQUE(dealer_id, key) ); -- Index CREATE INDEX idx_dealer_settings_dealer ON dealer_settings(dealer_id); -- ============================================================================ -- TABLE B6: dealer_notifications -- ডিলারদের নোটিফিকেশন preferences -- ============================================================================ CREATE TABLE dealer_notifications ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Email Notifications email_new_order BOOLEAN DEFAULT TRUE, email_order_cancelled BOOLEAN DEFAULT TRUE, email_payment_received BOOLEAN DEFAULT TRUE, email_low_stock BOOLEAN DEFAULT TRUE, email_review_received BOOLEAN DEFAULT TRUE, email_payout BOOLEAN DEFAULT TRUE, email_subscription BOOLEAN DEFAULT TRUE, email_announcements BOOLEAN DEFAULT TRUE, -- SMS Notifications sms_new_order BOOLEAN DEFAULT TRUE, sms_order_cancelled BOOLEAN DEFAULT FALSE, sms_payment_received BOOLEAN DEFAULT TRUE, sms_low_stock BOOLEAN DEFAULT FALSE, sms_payout BOOLEAN DEFAULT TRUE, -- Push Notifications push_enabled BOOLEAN DEFAULT TRUE, -- Metadata updated_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(dealer_id) ); -- Index CREATE INDEX idx_dealer_notifications_dealer ON dealer_notifications(dealer_id);

Nazmul Hassan Shaown, [1/14/2026 3:35 AM]
Products catalog Module C

-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE C: PRODUCT CATALOG (SUZUKI SPECIFIC) ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE C1: bike_models -- সুজুকি বাইক মডেলগুলো -- ============================================================================ CREATE TABLE bike_models ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Model Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, -- Model Details model_code VARCHAR(50), year_start INTEGER, -- Production start year year_end INTEGER, -- Production end year (NULL = current) -- Engine engine_cc INTEGER, engine_type VARCHAR(50), -- single cylinder, twin cylinder -- Category bike_type VARCHAR(50) DEFAULT 'motorcycle' CHECK (bike_type IN ( 'motorcycle', 'scooter', 'sports', 'cruiser', 'commuter', 'adventure', 'naked' )), -- Media image_url TEXT, thumbnail_url TEXT, gallery TEXT[], -- Multiple images -- Specifications (JSON for flexibility) specifications JSONB, /* { "power": "13.6 PS @ 8000 rpm", "torque": "13.8 Nm @ 6000 rpm", "fuel_tank": "12 liters", "mileage": "45 kmpl", "weight": "139 kg" } */ -- Description description TEXT, description_bn TEXT, -- Display display_order INTEGER DEFAULT 0, is_popular BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- Stats product_count INTEGER DEFAULT 0, -- SEO meta_title VARCHAR(255), meta_description TEXT, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Suzuki Models (Bangladesh Market) INSERT INTO bike_models (name, name_bn, slug, engine_cc, bike_type, is_popular) VALUES -- Sports ('Gixxer SF', 'গিক্সার এসএফ', 'gixxer-sf', 155, 'sports', TRUE), ('Gixxer SF 250', 'গিক্সার এসএফ ২৫০', 'gixxer-sf-250', 249, 'sports', TRUE), ('GSX-R150', 'জিএসএক্স-আর১৫০', 'gsx-r150', 150, 'sports', FALSE), ('GSX-S150', 'জিএসএক্স-এস১৫০', 'gsx-s150', 150, 'naked', FALSE), ('Hayabusa', 'হায়াবুসা', 'hayabusa', 1340, 'sports', TRUE), ('GSX-R1000', 'জিএসএক্স-আর১০০০', 'gsx-r1000', 999, 'sports', FALSE), -- Commuter ('Gixxer 150', 'গিক্সার ১৫০', 'gixxer-150', 155, 'motorcycle', TRUE), ('Gixxer 250', 'গিক্সার ২৫০', 'gixxer-250', 249, 'naked', TRUE), ('Intruder 150', 'ইনট্রুডার ১৫০', 'intruder-150', 155, 'cruiser', FALSE), -- Scooter ('Access 125', 'এক্সেস ১২৫', 'access-125', 125, 'scooter', TRUE), ('Burgman Street', 'বার্গম্যান স্ট্রিট', 'burgman-street', 125, 'scooter', TRUE), ('Avenis 125', 'এভেনিস ১২৫', 'avenis-125', 125, 'scooter', FALSE), -- Adventure ('V-Strom SX', 'ভি-স্ট্রম এসএক্স', 'vstrom-sx', 250, 'adventure', FALSE), -- Others (for universal parts) ('Universal', 'ইউনিভার্সাল', 'universal', NULL, 'motorcycle', FALSE); -- Indexes CREATE INDEX idx_bike_models_type ON bike_models(bike_type); CREATE INDEX idx_bike_models_slug ON bike_models(slug); CREATE INDEX idx_bike_models_popular ON bike_models(is_popular) WHERE is_popular = TRUE; -- ============================================================================ -- TABLE C2: categories -- প্রোডাক্ট ক্যাটাগরি (Hierarchical) -- ============================================================================ CREATE TABLE categories ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Category Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, description TEXT, description_bn TEXT, -- Hierarchy parent_id UUID REFERENCES categories(id) ON DELETE SET NULL, level INTEGER DEFAULT 0, -- 0 = root, 1 = sub, 2 = sub-sub path TEXT, -- '/electronics/mobile-holders/' for easy querying -- Media icon VARCHAR(100), -- Icon name (lucide icon) icon_url TEXT, image_url TEXT, banner_url TEXT, -- Display display_order INTEGER DEFAULT 0, is_featured BOOLEAN DEFAULT FALSE, show_in_menu BOOLEAN DEFAULT TRUE, show_in_home BOOLEAN DEFAULT FALSE, -- Status is_active BOOLEAN DEFAULT TRUE, -- Stats product_count INTEGER DEFAULT 0, -- SEO meta_title VARCHAR(255), meta_description TEXT, meta_keywords

Nazmul Hassan Shaown, [1/14/2026 3:35 AM]
TEXT[], -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Main Categories INSERT INTO categories (name, name_bn, slug, icon, level, is_featured) VALUES ('Engine Oil', 'ইঞ্জিন অয়েল', 'engine-oil', 'droplet', 0, TRUE), ('Bike Accessories', 'বাইক এক্সেসরিজ', 'bike-accessories', 'settings', 0, TRUE), ('Spare Parts', 'স্পেয়ার পার্টস', 'spare-parts', 'wrench', 0, TRUE), ('Riding Gear', 'রাইডিং গিয়ার', 'riding-gear', 'shield', 0, TRUE), ('Tyres & Wheels', 'টায়ার ও হুইল', 'tyres-wheels', 'circle', 0, TRUE), ('Battery', 'ব্যাটারি', 'battery', 'battery', 0, TRUE), ('Lights & Electricals', 'লাইট ও ইলেক্ট্রিক্যাল', 'lights-electricals', 'zap', 0, FALSE), ('Body Parts', 'বডি পার্টস', 'body-parts', 'layers', 0, FALSE), ('Tools & Maintenance', 'টুলস ও মেইনটেন্যান্স', 'tools-maintenance', 'tool', 0, FALSE), ('Performance Parts', 'পারফরম্যান্স পার্টস', 'performance-parts', 'gauge', 0, FALSE); -- Insert Sub Categories (Engine Oil) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('4T Engine Oil', '4T ইঞ্জিন অয়েল', '4t-engine-oil', 'engine-oil'), ('2T Engine Oil', '2T ইঞ্জিন অয়েল', '2t-engine-oil', 'engine-oil'), ('Gear Oil', 'গিয়ার অয়েল', 'gear-oil', 'engine-oil'), ('Fork Oil', 'ফর্ক অয়েল', 'fork-oil', 'engine-oil'), ('Brake Fluid', 'ব্রেক ফ্লুইড', 'brake-fluid', 'engine-oil'), ('Coolant', 'কুল্যান্ট', 'coolant', 'engine-oil') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Bike Accessories) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Mobile Holders', 'মোবাইল হোল্ডার', 'mobile-holders', 'bike-accessories'), ('Mirrors', 'মিরর', 'mirrors', 'bike-accessories'), ('Seat Covers', 'সিট কভার', 'seat-covers', 'bike-accessories'), ('Tank Pads', 'ট্যাঙ্ক প্যাড', 'tank-pads', 'bike-accessories'), ('Handle Grips', 'হ্যান্ডেল গ্রিপ', 'handle-grips', 'bike-accessories'), ('Crash Guards', 'ক্র্যাশ গার্ড', 'crash-guards', 'bike-accessories'), ('Luggage', 'লাগেজ/ব্যাগ', 'luggage', 'bike-accessories'), ('Windshield', 'উইন্ডশিল্ড', 'windshield', 'bike-accessories'), ('Bike Covers', 'বাইক কভার', 'bike-covers', 'bike-accessories') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Spare Parts) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Brake Pads', 'ব্রেক প্যাড', 'brake-pads', 'spare-parts'), ('Brake Discs', 'ব্রেক ডিস্ক', 'brake-discs', 'spare-parts'), ('Chain & Sprocket', 'চেইন ও স্প্রকেট', 'chain-sprocket', 'spare-parts'), ('Air Filters', 'এয়ার ফিল্টার', 'air-filters', 'spare-parts'), ('Oil Filters', 'অয়েল ফিল্টার', 'oil-filters', 'spare-parts'), ('Fuel Filters', 'ফুয়েল ফিল্টার', 'fuel-filters', 'spare-parts'), ('Clutch Parts', 'ক্লাচ পার্টস', 'clutch-parts', 'spare-parts'), ('Carburetor Parts', 'কার্বুরেটর পার্টস', 'carburetor-parts', 'spare-parts'), ('Engine Parts', 'ইঞ্জিন পার্টস', 'engine-parts', 'spare-parts'), ('Suspension Parts', 'সাসপেনশন পার্টস', 'suspension-parts', 'spare-parts'), ('Bearings', 'বিয়ারিং', 'bearings', 'spare-parts'), ('Cables', 'কেবল', 'cables', 'spare-parts'), ('Gaskets & Seals', 'গ্যাসকেট ও সিল', 'gaskets-seals', 'spare-parts') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Riding Gear) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Helmets', 'হেলমেট', 'helmets', 'riding-gear'), ('Jackets', 'জ্যাকেট', 'jackets', 'riding-gear'), ('Gloves', 'গ্লাভস', 'gloves', 'riding-gear'), ('Riding Boots', 'রাইডিং বুট', 'riding-boots', 'riding-gear'), ('Knee Guards', 'নী গার্ড', 'knee-guards', 'riding-gear'), ('Elbow Guards', 'এলবো গার্ড', 'elbow-guards', 'riding-gear'), ('Rain Gear',

Nazmul Hassan Shaown, [1/14/2026 3:35 AM]
'রেইন গিয়ার', 'rain-gear', 'riding-gear'), ('Balaclavas', 'বালাক্লাভা', 'balaclavas', 'riding-gear') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Indexes CREATE INDEX idx_categories_parent ON categories(parent_id); CREATE INDEX idx_categories_slug ON categories(slug); CREATE INDEX idx_categories_level ON categories(level); CREATE INDEX idx_categories_active ON categories(is_active); -- ============================================================================ -- TABLE C3: products -- মূল প্রোডাক্ট টেবিল -- ============================================================================ CREATE TABLE products ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- ═══════════════════════════════════════════════════════════════ -- OWNERSHIP -- ═══════════════════════════════════════════════════════════════ dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════════════════════════ -- BASIC INFO -- ═══════════════════════════════════════════════════════════════ name VARCHAR(255) NOT NULL, name_bn VARCHAR(255), slug VARCHAR(255) NOT NULL, -- Identifiers sku VARCHAR(100), barcode VARCHAR(100), part_number VARCHAR(100), -- OEM part number -- ═══════════════════════════════════════════════════════════════ -- CATEGORIZATION -- ═══════════════════════════════════════════════════════════════ category_id UUID NOT NULL REFERENCES categories(id), sub_category_id UUID REFERENCES categories(id), brand VARCHAR(100) DEFAULT 'Suzuki', -- ═══════════════════════════════════════════════════════════════ -- DESCRIPTION -- ═══════════════════════════════════════════════════════════════ short_description TEXT, short_description_bn TEXT, description TEXT, description_bn TEXT, -- Specifications (JSON) specifications JSONB, /* { "material": "Steel", "weight": "500g", "color": "Black", "warranty": "6 months" } */ -- Highlights (for quick view) highlights TEXT[], -- ═══════════════════════════════════════════════════════════════ -- PRICING -- ═══════════════════════════════════════════════════════════════ base_price DECIMAL(10,2) NOT NULL, sale_price DECIMAL(10,2), cost_price DECIMAL(10,2), -- Dealer's purchase price (internal) -- Discount discount_type VARCHAR(20) CHECK (discount_type IN ('percentage', 'fixed')), discount_value DECIMAL(10,2), discount_starts_at TIMESTAMPTZ, discount_ends_at TIMESTAMPTZ, -- Tax tax_class VARCHAR(50) DEFAULT 'standard', tax_rate DECIMAL(5,2) DEFAULT 0, is_tax_inclusive BOOLEAN DEFAULT TRUE, -- ═══════════════════════════════════════════════════════════════ -- INVENTORY -- ═══════════════════════════════════════════════════════════════ track_inventory BOOLEAN DEFAULT TRUE, stock_quantity INTEGER DEFAULT 0, low_stock_threshold INTEGER DEFAULT 5, stock_status VARCHAR(20) DEFAULT 'in_stock' CHECK (stock_status IN ('in_stock', 'out_of_stock', 'backorder', 'preorder', 'discontinued')), allow_backorder BOOLEAN DEFAULT FALSE, backorder_limit INTEGER, -- ═══════════════════════════════════════════════════════════════ -- SHIPPING -- ═══════════════════════════════════════════════════════════════ weight DECIMAL(10,3), -- kg length DECIMAL(10,2), -- cm width DECIMAL(10,2), -- cm height DECIMAL(10,2), -- cm shipping_class VARCHAR(50) DEFAULT 'standard', is_free_shipping BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- MEDIA -- ═══════════════════════════════════════════════════════════════ thumbnail_url TEXT, -- ═══════════════════════════════════════════════════════════════ -- STATUS & APPROVAL -- ═══════════════════════════════════════════════════════════════ status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'pending', 'active', 'rejected', 'blocked', 'archived')), visibility VARCHAR(20) DEFAULT 'visible' CHECK (visibility IN ('visible', 'hidden', 'catalog_only', 'search_only')), -- Submission submitted_at TIMESTAMPTZ, -- Approval approved_at TIMESTAMPTZ, approved_by UUID REFERENCES users(id), -- Rejection rejected_at TIMESTAMPTZ, rejected_by UUID REFERENCES users(id),

Nazmul Hassan Shaown, [1/14/2026 3:35 AM]
rejection_reason TEXT, -- Blocking blocked_at TIMESTAMPTZ, blocked_by UUID REFERENCES users(id), blocked_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- FEATURES -- ═══════════════════════════════════════════════════════════════ is_featured BOOLEAN DEFAULT FALSE, is_new_arrival BOOLEAN DEFAULT TRUE, is_best_seller BOOLEAN DEFAULT FALSE, is_on_sale BOOLEAN DEFAULT FALSE, -- Flags is_genuine BOOLEAN DEFAULT TRUE, -- Genuine Suzuki part is_aftermarket BOOLEAN DEFAULT FALSE, requires_fitting BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- STATS (Denormalized) -- ═══════════════════════════════════════════════════════════════ total_sold INTEGER DEFAULT 0, total_views INTEGER DEFAULT 0, average_rating DECIMAL(3,2) DEFAULT 0, review_count INTEGER DEFAULT 0, wishlist_count INTEGER DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SEO -- ═══════════════════════════════════════════════════════════════ meta_title VARCHAR(255), meta_description TEXT, meta_keywords TEXT[], -- ═══════════════════════════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), published_at TIMESTAMPTZ, -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- CONSTRAINTS -- ═══════════════════════════════════════════════════════════════ UNIQUE(dealer_id, slug), UNIQUE(dealer_id, sku) ); -- Indexes CREATE INDEX idx_products_dealer ON products(dealer_id); CREATE INDEX idx_products_category ON products(category_id); CREATE INDEX idx_products_sub_category ON products(sub_category_id); CREATE INDEX idx_products_status ON products(status); CREATE INDEX idx_products_visibility ON products(visibility); CREATE INDEX idx_products_stock_status ON products(stock_status); CREATE INDEX idx_products_slug ON products(slug); CREATE INDEX idx_products_sku ON products(sku); CREATE INDEX idx_products_price ON products(sale_price, base_price); CREATE INDEX idx_products_featured ON products(is_featured) WHERE is_featured = TRUE; CREATE INDEX idx_products_new ON products(is_new_arrival, created_at DESC) WHERE is_new_arrival = TRUE; CREATE INDEX idx_products_bestseller ON products(is_best_seller, total_sold DESC) WHERE is_best_seller = TRUE; CREATE INDEX idx_products_created ON products(created_at DESC); CREATE INDEX idx_products_rating ON products(average_rating DESC); -- Full Text Search CREATE INDEX idx_products_search ON products USING gin(to_tsvector('english', name  ' '  COALESCE(description, '')  ' '  COALESCE(sku, '')  ' '  COALESCE(part_number, ''))); -- ============================================================================ -- TABLE C4: product_bike_models -- প্রোডাক্ট কোন বাইকে ফিট হবে (Many-to-Many) -- ============================================================================ CREATE TABLE product_bike_models ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, bike_model_id UUID NOT NULL REFERENCES bike_models(id) ON DELETE CASCADE, -- Year compatibility (optional override) year_from INTEGER, year_to INTEGER, -- Fitment notes fitment_notes TEXT, is_direct_fit BOOLEAN DEFAULT TRUE, modification_required BOOLEAN DEFAULT FALSE, -- Display display_order INTEGER DEFAULT 0, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(product_id, bike_model_id) ); -- Indexes CREATE INDEX idx_product_models_product ON product_bike_models(product_id); CREATE INDEX idx_product_models_bike ON product_bike_models(bike_model_id); -- ============================================================================ -- TABLE C5: product_images -- প্রোডাক্ট ইমেজ গ্যালারি -- ============================================================================ CREATE TABLE product_images ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
CASCADE, -- Image Info image_url TEXT NOT NULL, thumbnail_url TEXT, -- Alt Text (for SEO & accessibility) alt_text VARCHAR(255), alt_text_bn VARCHAR(255), -- Ordering display_order INTEGER DEFAULT 0, is_primary BOOLEAN DEFAULT FALSE, -- Variant association (optional) variant_id UUID REFERENCES product_variants(id) ON DELETE SET NULL, -- File Info file_name VARCHAR(255), file_size INTEGER, width INTEGER, height INTEGER, mime_type VARCHAR(100), -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_product_images_product ON product_images(product_id); CREATE INDEX idx_product_images_primary ON product_images(product_id, is_primary) WHERE is_primary = TRUE; CREATE INDEX idx_product_images_order ON product_images(product_id, display_order); -- ============================================================================ -- TABLE C6: product_variants -- প্রোডাক্ট ভেরিয়েন্ট (Size, Color variations) -- ============================================================================ CREATE TABLE product_variants ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Variant Info name VARCHAR(255) NOT NULL, sku VARCHAR(100), barcode VARCHAR(100), -- Attributes attributes JSONB NOT NULL, /* { "color": "Red", "size": "L", "material": "Leather" } */ -- Pricing price_adjustment DECIMAL(10,2) DEFAULT 0, -- +/- from base price final_price DECIMAL(10,2), -- Calculated: base_price + price_adjustment -- Stock stock_quantity INTEGER DEFAULT 0, low_stock_threshold INTEGER DEFAULT 5, -- Media image_url TEXT, -- Status is_active BOOLEAN DEFAULT TRUE, -- Display display_order INTEGER DEFAULT 0, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_product_variants_product ON product_variants(product_id); CREATE INDEX idx_product_variants_sku ON product_variants(sku); CREATE INDEX idx_product_variants_active ON product_variants(product_id, is_active) WHERE is_active = TRUE; -- ============================================================================ -- TABLE C7: product_attributes -- Attribute definitions (for variant options) -- ============================================================================ CREATE TABLE product_attributes ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Attribute Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, -- Type type VARCHAR(20) DEFAULT 'select' CHECK (type IN ('select', 'color', 'size', 'text')), -- Options (for select type) options JSONB, /* [ {"value": "red", "label": "Red", "color_code": "#FF0000"}, {"value": "blue", "label": "Blue", "color_code": "#0000FF"} ] */ -- Display display_order INTEGER DEFAULT 0, is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Default Attributes INSERT INTO product_attributes (name, name_bn, slug, type, options) VALUES ('Color', 'রঙ', 'color', 'color', '[ {"value": "black", "label": "Black", "label_bn": "কালো", "color_code": "#000000"}, {"value": "red", "label": "Red", "label_bn": "লাল", "color_code": "#FF0000"}, {"value": "blue", "label": "Blue", "label_bn": "নীল", "color_code": "#0000FF"}, {"value": "silver", "label": "Silver", "label_bn": "রূপালি", "color_code": "#C0C0C0"}, {"value": "white", "label": "White", "label_bn": "সাদা", "color_code": "#FFFFFF"} ]'), ('Size', 'সাইজ', 'size', 'size', '[ {"value": "xs", "label": "XS"}, {"value": "s", "label": "S"}, {"value": "m", "label": "M"}, {"value": "l", "label": "L"}, {"value": "xl", "label": "XL"}, {"value": "xxl", "label": "XXL"} ]'), ('Viscosity', 'ভিসকোসিটি', 'viscosity', 'select', '[ {"value": "10w30", "label": "10W-30"}, {"value": "10w40", "label": "10W-40"}, {"value": "15w40", "label": "15W-40"}, {"value": "20w40", "label": "20W-40"}, {"value": "20w50", "label": "20W-50"} ]'), ('Volume', 'পরিমাণ', 'volume', 'select', '[ {"value": "500ml", "label": "500ml"}, {"value": "1l", "label": "1 Liter"}, {"value": "2l", "label": "2 Liter"}, {"value": "4l", "label": "4 Liter"} ]'); --

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
============================================================================ -- TABLE C8: inventory -- স্টক মুভমেন্ট ট্র্যাকিং -- ============================================================================ CREATE TABLE inventory ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- References product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, variant_id UUID REFERENCES product_variants(id) ON DELETE CASCADE, dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Movement Type movement_type VARCHAR(30) NOT NULL CHECK (movement_type IN ( 'purchase', -- Stock in from supplier 'sale', -- Sold to customer 'return_in', -- Customer returned 'return_out', -- Returned to supplier 'adjustment', -- Manual adjustment 'transfer_in', -- Transfer from another location 'transfer_out', -- Transfer to another location 'damage', -- Damaged goods 'expired', -- Expired products 'gift', -- Given as gift/sample 'initial' -- Initial stock entry )), -- Quantity (Positive for add, Negative for subtract) quantity INTEGER NOT NULL, -- Stock Levels previous_stock INTEGER NOT NULL, new_stock INTEGER NOT NULL, -- Unit Cost (for accounting) unit_cost DECIMAL(10,2), total_cost DECIMAL(12,2), -- Reference reference_type VARCHAR(50), -- order, adjustment, purchase_order reference_id UUID, reference_number VARCHAR(100), -- Notes notes TEXT, -- Location (for future multi-warehouse) warehouse_id UUID, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), created_by UUID REFERENCES users(id) ); -- Indexes CREATE INDEX idx_inventory_product ON inventory(product_id); CREATE INDEX idx_inventory_variant ON inventory(variant_id); CREATE INDEX idx_inventory_dealer ON inventory(dealer_id); CREATE INDEX idx_inventory_type ON inventory(movement_type); CREATE INDEX idx_inventory_reference ON inventory(reference_type, reference_id); CREATE INDEX idx_inventory_created ON inventory(created_at DESC);

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
Module D shopping 

-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE D: SHOPPING ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE D1: customer_addresses -- কাস্টমার এড্রেস বুক -- ============================================================================ CREATE TABLE customer_addresses ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- Address Type address_type VARCHAR(20) DEFAULT 'shipping' CHECK (address_type IN ('shipping', 'billing', 'both')), -- Label label VARCHAR(50) DEFAULT 'Home', -- Home, Office, etc. -- Contact recipient_name VARCHAR(255) NOT NULL, phone VARCHAR(20) NOT NULL, alt_phone VARCHAR(20), email VARCHAR(255), -- Address address_line1 VARCHAR(255) NOT NULL, address_line2 VARCHAR(255), landmark VARCHAR(255), -- Location area VARCHAR(100), city VARCHAR(100) NOT NULL, district VARCHAR(100) NOT NULL, division VARCHAR(100), postal_code VARCHAR(20), country VARCHAR(100) DEFAULT 'Bangladesh', -- Coordinates latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- Flags is_default BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- Delivery Notes delivery_instructions TEXT, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_customer_addr_user ON customer_addresses(user_id); CREATE INDEX idx_customer_addr_default ON customer_addresses(user_id, is_default) WHERE is_default = TRUE; -- ============================================================================ -- TABLE D2: carts -- শপিং কার্ট -- ============================================================================ CREATE TABLE

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE C: PRODUCT CATALOG (SUZUKI SPECIFIC) ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE C1: bike_models -- সুজুকি বাইক মডেলগুলো -- ============================================================================ CREATE TABLE bike_models ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Model Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, -- Model Details model_code VARCHAR(50), year_start INTEGER, -- Production start year year_end INTEGER, -- Production end year (NULL = current) -- Engine engine_cc INTEGER, engine_type VARCHAR(50), -- single cylinder, twin cylinder -- Category bike_type VARCHAR(50) DEFAULT 'motorcycle' CHECK (bike_type IN ( 'motorcycle', 'scooter', 'sports', 'cruiser', 'commuter', 'adventure', 'naked' )), -- Media image_url TEXT, thumbnail_url TEXT, gallery TEXT[], -- Multiple images -- Specifications (JSON for flexibility) specifications JSONB, /* { "power": "13.6 PS @ 8000 rpm", "torque": "13.8 Nm @ 6000 rpm", "fuel_tank": "12 liters", "mileage": "45 kmpl", "weight": "139 kg" } */ -- Description description TEXT, description_bn TEXT, -- Display display_order INTEGER DEFAULT 0, is_popular BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- Stats product_count INTEGER DEFAULT 0, -- SEO meta_title VARCHAR(255), meta_description TEXT, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Suzuki Models (Bangladesh Market) INSERT INTO bike_models (name, name_bn, slug, engine_cc, bike_type, is_popular) VALUES -- Sports ('Gixxer SF', 'গিক্সার এসএফ', 'gixxer-sf', 155, 'sports', TRUE), ('Gixxer SF 250', 'গিক্সার এসএফ ২৫০', 'gixxer-sf-250', 249, 'sports', TRUE), ('GSX-R150', 'জিএসএক্স-আর১৫০', 'gsx-r150', 150, 'sports', FALSE), ('GSX-S150', 'জিএসএক্স-এস১৫০', 'gsx-s150', 150, 'naked', FALSE), ('Hayabusa', 'হায়াবুসা', 'hayabusa', 1340, 'sports', TRUE), ('GSX-R1000', 'জিএসএক্স-আর১০০০', 'gsx-r1000', 999, 'sports', FALSE), -- Commuter ('Gixxer 150', 'গিক্সার ১৫০', 'gixxer-150', 155, 'motorcycle', TRUE), ('Gixxer 250', 'গিক্সার ২৫০', 'gixxer-250', 249, 'naked', TRUE), ('Intruder 150', 'ইনট্রুডার ১৫০', 'intruder-150', 155, 'cruiser', FALSE), -- Scooter ('Access 125', 'এক্সেস ১২৫', 'access-125', 125, 'scooter', TRUE), ('Burgman Street', 'বার্গম্যান স্ট্রিট', 'burgman-street', 125, 'scooter', TRUE), ('Avenis 125', 'এভেনিস ১২৫', 'avenis-125', 125, 'scooter', FALSE), -- Adventure ('V-Strom SX', 'ভি-স্ট্রম এসএক্স', 'vstrom-sx', 250, 'adventure', FALSE), -- Others (for universal parts) ('Universal', 'ইউনিভার্সাল', 'universal', NULL, 'motorcycle', FALSE); -- Indexes CREATE INDEX idx_bike_models_type ON bike_models(bike_type); CREATE INDEX idx_bike_models_slug ON bike_models(slug); CREATE INDEX idx_bike_models_popular ON bike_models(is_popular) WHERE is_popular = TRUE; -- ============================================================================ -- TABLE C2: categories -- প্রোডাক্ট ক্যাটাগরি (Hierarchical) -- ============================================================================ CREATE TABLE categories ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Category Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, description TEXT, description_bn TEXT, -- Hierarchy parent_id UUID REFERENCES categories(id) ON DELETE SET NULL, level INTEGER DEFAULT 0, -- 0 = root, 1 = sub, 2 = sub-sub path TEXT, -- '/electronics/mobile-holders/' for easy querying -- Media icon VARCHAR(100), -- Icon name (lucide icon) icon_url TEXT, image_url TEXT, banner_url TEXT, -- Display display_order INTEGER DEFAULT 0, is_featured BOOLEAN DEFAULT FALSE, show_in_menu BOOLEAN DEFAULT TRUE, show_in_home BOOLEAN DEFAULT FALSE, -- Status is_active BOOLEAN DEFAULT TRUE, -- Stats product_count INTEGER DEFAULT 0, -- SEO meta_title VARCHAR(255), meta_description TEXT, meta_keywords TEXT[], -- Metadata created_at

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Main Categories INSERT INTO categories (name, name_bn, slug, icon, level, is_featured) VALUES ('Engine Oil', 'ইঞ্জিন অয়েল', 'engine-oil', 'droplet', 0, TRUE), ('Bike Accessories', 'বাইক এক্সেসরিজ', 'bike-accessories', 'settings', 0, TRUE), ('Spare Parts', 'স্পেয়ার পার্টস', 'spare-parts', 'wrench', 0, TRUE), ('Riding Gear', 'রাইডিং গিয়ার', 'riding-gear', 'shield', 0, TRUE), ('Tyres & Wheels', 'টায়ার ও হুইল', 'tyres-wheels', 'circle', 0, TRUE), ('Battery', 'ব্যাটারি', 'battery', 'battery', 0, TRUE), ('Lights & Electricals', 'লাইট ও ইলেক্ট্রিক্যাল', 'lights-electricals', 'zap', 0, FALSE), ('Body Parts', 'বডি পার্টস', 'body-parts', 'layers', 0, FALSE), ('Tools & Maintenance', 'টুলস ও মেইনটেন্যান্স', 'tools-maintenance', 'tool', 0, FALSE), ('Performance Parts', 'পারফরম্যান্স পার্টস', 'performance-parts', 'gauge', 0, FALSE); -- Insert Sub Categories (Engine Oil) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('4T Engine Oil', '4T ইঞ্জিন অয়েল', '4t-engine-oil', 'engine-oil'), ('2T Engine Oil', '2T ইঞ্জিন অয়েল', '2t-engine-oil', 'engine-oil'), ('Gear Oil', 'গিয়ার অয়েল', 'gear-oil', 'engine-oil'), ('Fork Oil', 'ফর্ক অয়েল', 'fork-oil', 'engine-oil'), ('Brake Fluid', 'ব্রেক ফ্লুইড', 'brake-fluid', 'engine-oil'), ('Coolant', 'কুল্যান্ট', 'coolant', 'engine-oil') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Bike Accessories) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Mobile Holders', 'মোবাইল হোল্ডার', 'mobile-holders', 'bike-accessories'), ('Mirrors', 'মিরর', 'mirrors', 'bike-accessories'), ('Seat Covers', 'সিট কভার', 'seat-covers', 'bike-accessories'), ('Tank Pads', 'ট্যাঙ্ক প্যাড', 'tank-pads', 'bike-accessories'), ('Handle Grips', 'হ্যান্ডেল গ্রিপ', 'handle-grips', 'bike-accessories'), ('Crash Guards', 'ক্র্যাশ গার্ড', 'crash-guards', 'bike-accessories'), ('Luggage', 'লাগেজ/ব্যাগ', 'luggage', 'bike-accessories'), ('Windshield', 'উইন্ডশিল্ড', 'windshield', 'bike-accessories'), ('Bike Covers', 'বাইক কভার', 'bike-covers', 'bike-accessories') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Spare Parts) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Brake Pads', 'ব্রেক প্যাড', 'brake-pads', 'spare-parts'), ('Brake Discs', 'ব্রেক ডিস্ক', 'brake-discs', 'spare-parts'), ('Chain & Sprocket', 'চেইন ও স্প্রকেট', 'chain-sprocket', 'spare-parts'), ('Air Filters', 'এয়ার ফিল্টার', 'air-filters', 'spare-parts'), ('Oil Filters', 'অয়েল ফিল্টার', 'oil-filters', 'spare-parts'), ('Fuel Filters', 'ফুয়েল ফিল্টার', 'fuel-filters', 'spare-parts'), ('Clutch Parts', 'ক্লাচ পার্টস', 'clutch-parts', 'spare-parts'), ('Carburetor Parts', 'কার্বুরেটর পার্টস', 'carburetor-parts', 'spare-parts'), ('Engine Parts', 'ইঞ্জিন পার্টস', 'engine-parts', 'spare-parts'), ('Suspension Parts', 'সাসপেনশন পার্টস', 'suspension-parts', 'spare-parts'), ('Bearings', 'বিয়ারিং', 'bearings', 'spare-parts'), ('Cables', 'কেবল', 'cables', 'spare-parts'), ('Gaskets & Seals', 'গ্যাসকেট ও সিল', 'gaskets-seals', 'spare-parts') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Insert Sub Categories (Riding Gear) INSERT INTO categories (name, name_bn, slug, parent_id, level) SELECT sub.name, sub.name_bn, sub.slug, c.id as parent_id, 1 as level FROM (VALUES ('Helmets', 'হেলমেট', 'helmets', 'riding-gear'), ('Jackets', 'জ্যাকেট', 'jackets', 'riding-gear'), ('Gloves', 'গ্লাভস', 'gloves', 'riding-gear'), ('Riding Boots', 'রাইডিং বুট', 'riding-boots', 'riding-gear'), ('Knee Guards', 'নী গার্ড', 'knee-guards', 'riding-gear'), ('Elbow Guards', 'এলবো গার্ড', 'elbow-guards', 'riding-gear'), ('Rain Gear', 'রেইন গিয়ার', 'rain-gear',

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
'riding-gear'), ('Balaclavas', 'বালাক্লাভা', 'balaclavas', 'riding-gear') ) AS sub(name, name_bn, slug, parent_slug) JOIN categories c ON c.slug = sub.parent_slug; -- Indexes CREATE INDEX idx_categories_parent ON categories(parent_id); CREATE INDEX idx_categories_slug ON categories(slug); CREATE INDEX idx_categories_level ON categories(level); CREATE INDEX idx_categories_active ON categories(is_active); -- ============================================================================ -- TABLE C3: products -- মূল প্রোডাক্ট টেবিল -- ============================================================================ CREATE TABLE products ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- ═══════════════════════════════════════════════════════════════ -- OWNERSHIP -- ═══════════════════════════════════════════════════════════════ dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════════════════════════ -- BASIC INFO -- ═══════════════════════════════════════════════════════════════ name VARCHAR(255) NOT NULL, name_bn VARCHAR(255), slug VARCHAR(255) NOT NULL, -- Identifiers sku VARCHAR(100), barcode VARCHAR(100), part_number VARCHAR(100), -- OEM part number -- ═══════════════════════════════════════════════════════════════ -- CATEGORIZATION -- ═══════════════════════════════════════════════════════════════ category_id UUID NOT NULL REFERENCES categories(id), sub_category_id UUID REFERENCES categories(id), brand VARCHAR(100) DEFAULT 'Suzuki', -- ═══════════════════════════════════════════════════════════════ -- DESCRIPTION -- ═══════════════════════════════════════════════════════════════ short_description TEXT, short_description_bn TEXT, description TEXT, description_bn TEXT, -- Specifications (JSON) specifications JSONB, /* { "material": "Steel", "weight": "500g", "color": "Black", "warranty": "6 months" } */ -- Highlights (for quick view) highlights TEXT[], -- ═══════════════════════════════════════════════════════════════ -- PRICING -- ═══════════════════════════════════════════════════════════════ base_price DECIMAL(10,2) NOT NULL, sale_price DECIMAL(10,2), cost_price DECIMAL(10,2), -- Dealer's purchase price (internal) -- Discount discount_type VARCHAR(20) CHECK (discount_type IN ('percentage', 'fixed')), discount_value DECIMAL(10,2), discount_starts_at TIMESTAMPTZ, discount_ends_at TIMESTAMPTZ, -- Tax tax_class VARCHAR(50) DEFAULT 'standard', tax_rate DECIMAL(5,2) DEFAULT 0, is_tax_inclusive BOOLEAN DEFAULT TRUE, -- ═══════════════════════════════════════════════════════════════ -- INVENTORY -- ═══════════════════════════════════════════════════════════════ track_inventory BOOLEAN DEFAULT TRUE, stock_quantity INTEGER DEFAULT 0, low_stock_threshold INTEGER DEFAULT 5, stock_status VARCHAR(20) DEFAULT 'in_stock' CHECK (stock_status IN ('in_stock', 'out_of_stock', 'backorder', 'preorder', 'discontinued')), allow_backorder BOOLEAN DEFAULT FALSE, backorder_limit INTEGER, -- ═══════════════════════════════════════════════════════════════ -- SHIPPING -- ═══════════════════════════════════════════════════════════════ weight DECIMAL(10,3), -- kg length DECIMAL(10,2), -- cm width DECIMAL(10,2), -- cm height DECIMAL(10,2), -- cm shipping_class VARCHAR(50) DEFAULT 'standard', is_free_shipping BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- MEDIA -- ═══════════════════════════════════════════════════════════════ thumbnail_url TEXT, -- ═══════════════════════════════════════════════════════════════ -- STATUS & APPROVAL -- ═══════════════════════════════════════════════════════════════ status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'pending', 'active', 'rejected', 'blocked', 'archived')), visibility VARCHAR(20) DEFAULT 'visible' CHECK (visibility IN ('visible', 'hidden', 'catalog_only', 'search_only')), -- Submission submitted_at TIMESTAMPTZ, -- Approval approved_at TIMESTAMPTZ, approved_by UUID REFERENCES users(id), -- Rejection rejected_at TIMESTAMPTZ, rejected_by UUID REFERENCES users(id), rejection_reason TEXT, --

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
Blocking blocked_at TIMESTAMPTZ, blocked_by UUID REFERENCES users(id), blocked_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- FEATURES -- ═══════════════════════════════════════════════════════════════ is_featured BOOLEAN DEFAULT FALSE, is_new_arrival BOOLEAN DEFAULT TRUE, is_best_seller BOOLEAN DEFAULT FALSE, is_on_sale BOOLEAN DEFAULT FALSE, -- Flags is_genuine BOOLEAN DEFAULT TRUE, -- Genuine Suzuki part is_aftermarket BOOLEAN DEFAULT FALSE, requires_fitting BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- STATS (Denormalized) -- ═══════════════════════════════════════════════════════════════ total_sold INTEGER DEFAULT 0, total_views INTEGER DEFAULT 0, average_rating DECIMAL(3,2) DEFAULT 0, review_count INTEGER DEFAULT 0, wishlist_count INTEGER DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SEO -- ═══════════════════════════════════════════════════════════════ meta_title VARCHAR(255), meta_description TEXT, meta_keywords TEXT[], -- ═══════════════════════════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), published_at TIMESTAMPTZ, -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════════════════════════ -- CONSTRAINTS -- ═══════════════════════════════════════════════════════════════ UNIQUE(dealer_id, slug), UNIQUE(dealer_id, sku) ); -- Indexes CREATE INDEX idx_products_dealer ON products(dealer_id); CREATE INDEX idx_products_category ON products(category_id); CREATE INDEX idx_products_sub_category ON products(sub_category_id); CREATE INDEX idx_products_status ON products(status); CREATE INDEX idx_products_visibility ON products(visibility); CREATE INDEX idx_products_stock_status ON products(stock_status); CREATE INDEX idx_products_slug ON products(slug); CREATE INDEX idx_products_sku ON products(sku); CREATE INDEX idx_products_price ON products(sale_price, base_price); CREATE INDEX idx_products_featured ON products(is_featured) WHERE is_featured = TRUE; CREATE INDEX idx_products_new ON products(is_new_arrival, created_at DESC) WHERE is_new_arrival = TRUE; CREATE INDEX idx_products_bestseller ON products(is_best_seller, total_sold DESC) WHERE is_best_seller = TRUE; CREATE INDEX idx_products_created ON products(created_at DESC); CREATE INDEX idx_products_rating ON products(average_rating DESC); -- Full Text Search CREATE INDEX idx_products_search ON products USING gin(to_tsvector('english', name  ' '  COALESCE(description, '')  ' '  COALESCE(sku, '')  ' '  COALESCE(part_number, ''))); -- ============================================================================ -- TABLE C4: product_bike_models -- প্রোডাক্ট কোন বাইকে ফিট হবে (Many-to-Many) -- ============================================================================ CREATE TABLE product_bike_models ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, bike_model_id UUID NOT NULL REFERENCES bike_models(id) ON DELETE CASCADE, -- Year compatibility (optional override) year_from INTEGER, year_to INTEGER, -- Fitment notes fitment_notes TEXT, is_direct_fit BOOLEAN DEFAULT TRUE, modification_required BOOLEAN DEFAULT FALSE, -- Display display_order INTEGER DEFAULT 0, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(product_id, bike_model_id) ); -- Indexes CREATE INDEX idx_product_models_product ON product_bike_models(product_id); CREATE INDEX idx_product_models_bike ON product_bike_models(bike_model_id); -- ============================================================================ -- TABLE C5: product_images -- প্রোডাক্ট ইমেজ গ্যালারি -- ============================================================================ CREATE TABLE product_images ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Image Info

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
image_url TEXT NOT NULL, thumbnail_url TEXT, -- Alt Text (for SEO & accessibility) alt_text VARCHAR(255), alt_text_bn VARCHAR(255), -- Ordering display_order INTEGER DEFAULT 0, is_primary BOOLEAN DEFAULT FALSE, -- Variant association (optional) variant_id UUID REFERENCES product_variants(id) ON DELETE SET NULL, -- File Info file_name VARCHAR(255), file_size INTEGER, width INTEGER, height INTEGER, mime_type VARCHAR(100), -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_product_images_product ON product_images(product_id); CREATE INDEX idx_product_images_primary ON product_images(product_id, is_primary) WHERE is_primary = TRUE; CREATE INDEX idx_product_images_order ON product_images(product_id, display_order); -- ============================================================================ -- TABLE C6: product_variants -- প্রোডাক্ট ভেরিয়েন্ট (Size, Color variations) -- ============================================================================ CREATE TABLE product_variants ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Variant Info name VARCHAR(255) NOT NULL, sku VARCHAR(100), barcode VARCHAR(100), -- Attributes attributes JSONB NOT NULL, /* { "color": "Red", "size": "L", "material": "Leather" } */ -- Pricing price_adjustment DECIMAL(10,2) DEFAULT 0, -- +/- from base price final_price DECIMAL(10,2), -- Calculated: base_price + price_adjustment -- Stock stock_quantity INTEGER DEFAULT 0, low_stock_threshold INTEGER DEFAULT 5, -- Media image_url TEXT, -- Status is_active BOOLEAN DEFAULT TRUE, -- Display display_order INTEGER DEFAULT 0, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_product_variants_product ON product_variants(product_id); CREATE INDEX idx_product_variants_sku ON product_variants(sku); CREATE INDEX idx_product_variants_active ON product_variants(product_id, is_active) WHERE is_active = TRUE; -- ============================================================================ -- TABLE C7: product_attributes -- Attribute definitions (for variant options) -- ============================================================================ CREATE TABLE product_attributes ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Attribute Info name VARCHAR(100) NOT NULL, name_bn VARCHAR(100), slug VARCHAR(100) UNIQUE NOT NULL, -- Type type VARCHAR(20) DEFAULT 'select' CHECK (type IN ('select', 'color', 'size', 'text')), -- Options (for select type) options JSONB, /* [ {"value": "red", "label": "Red", "color_code": "#FF0000"}, {"value": "blue", "label": "Blue", "color_code": "#0000FF"} ] */ -- Display display_order INTEGER DEFAULT 0, is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert Default Attributes INSERT INTO product_attributes (name, name_bn, slug, type, options) VALUES ('Color', 'রঙ', 'color', 'color', '[ {"value": "black", "label": "Black", "label_bn": "কালো", "color_code": "#000000"}, {"value": "red", "label": "Red", "label_bn": "লাল", "color_code": "#FF0000"}, {"value": "blue", "label": "Blue", "label_bn": "নীল", "color_code": "#0000FF"}, {"value": "silver", "label": "Silver", "label_bn": "রূপালি", "color_code": "#C0C0C0"}, {"value": "white", "label": "White", "label_bn": "সাদা", "color_code": "#FFFFFF"} ]'), ('Size', 'সাইজ', 'size', 'size', '[ {"value": "xs", "label": "XS"}, {"value": "s", "label": "S"}, {"value": "m", "label": "M"}, {"value": "l", "label": "L"}, {"value": "xl", "label": "XL"}, {"value": "xxl", "label": "XXL"} ]'), ('Viscosity', 'ভিসকোসিটি', 'viscosity', 'select', '[ {"value": "10w30", "label": "10W-30"}, {"value": "10w40", "label": "10W-40"}, {"value": "15w40", "label": "15W-40"}, {"value": "20w40", "label": "20W-40"}, {"value": "20w50", "label": "20W-50"} ]'), ('Volume', 'পরিমাণ', 'volume', 'select', '[ {"value": "500ml", "label": "500ml"}, {"value": "1l", "label": "1 Liter"}, {"value": "2l", "label": "2 Liter"}, {"value": "4l", "label": "4 Liter"} ]'); --

Nazmul Hassan Shaown, [1/14/2026 3:37 AM]
============================================================================ -- TABLE C8: inventory -- স্টক মুভমেন্ট ট্র্যাকিং -- ============================================================================ CREATE TABLE inventory ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- References product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, variant_id UUID REFERENCES product_variants(id) ON DELETE CASCADE, dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Movement Type movement_type VARCHAR(30) NOT NULL CHECK (movement_type IN ( 'purchase', -- Stock in from supplier 'sale', -- Sold to customer 'return_in', -- Customer returned 'return_out', -- Returned to supplier 'adjustment', -- Manual adjustment 'transfer_in', -- Transfer from another location 'transfer_out', -- Transfer to another location 'damage', -- Damaged goods 'expired', -- Expired products 'gift', -- Given as gift/sample 'initial' -- Initial stock entry )), -- Quantity (Positive for add, Negative for subtract) quantity INTEGER NOT NULL, -- Stock Levels previous_stock INTEGER NOT NULL, new_stock INTEGER NOT NULL, -- Unit Cost (for accounting) unit_cost DECIMAL(10,2), total_cost DECIMAL(12,2), -- Reference reference_type VARCHAR(50), -- order, adjustment, purchase_order reference_id UUID, reference_number VARCHAR(100), -- Notes notes TEXT, -- Location (for future multi-warehouse) warehouse_id UUID, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), created_by UUID REFERENCES users(id) ); -- Indexes CREATE INDEX idx_inventory_product ON inventory(product_id); CREATE INDEX idx_inventory_variant ON inventory(variant_id); CREATE INDEX idx_inventory_dealer ON inventory(dealer_id); CREATE INDEX idx_inventory_type ON inventory(movement_type); CREATE INDEX idx_inventory_reference ON inventory(reference_type, reference_id); CREATE INDEX idx_inventory_created ON inventory(created_at DESC);

Nazmul Hassan Shaown, [1/14/2026 3:39 AM]
-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE B: DEALER MANAGEMENT ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE B1: dealers -- মূল ডিলার/দোকান তথ্য -- ============================================================================ CREATE TABLE dealers ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- ═══════════════════════════════════════════════════════════════ -- BASIC INFO -- ═══════════════════════════════════════════════════════════════ business_name VARCHAR(255) NOT NULL, business_name_bn VARCHAR(255), -- বাংলায় নাম slug VARCHAR(255) UNIQUE NOT NULL, tagline VARCHAR(255), -- Contact email VARCHAR(255) NOT NULL, phone VARCHAR(20) NOT NULL, alt_phone VARCHAR(20), whatsapp VARCHAR(20), -- ═══════════════════════════════════════════════════════════════ -- LEGAL & BUSINESS -- ═══════════════════════════════════════════════════════════════ business_type VARCHAR(50) DEFAULT 'sole_proprietorship' CHECK (business_type IN ( 'sole_proprietorship', 'partnership', 'limited_company', 'other' )), trade_license_no VARCHAR(100), tin_number VARCHAR(50), bin_number VARCHAR(50), establishment_year INTEGER, -- ═══════════════════════════════════════════════════════════════ -- BRANDING -- ═══════════════════════════════════════════════════════════════ logo_url TEXT, banner_url TEXT, favicon_url TEXT, description TEXT, description_bn TEXT, -- Social Links website VARCHAR(255), facebook VARCHAR(255), instagram VARCHAR(255), youtube VARCHAR(255), -- ═══════════════════════════════════════════════════════════════ -- ADDRESS -- ═══════════════════════════════════════════════════════════════ address_line1 VARCHAR(255), address_line2 VARCHAR(255), area VARCHAR(100), city VARCHAR(100), district VARCHAR(100), division VARCHAR(100), postal_code VARCHAR(20), country VARCHAR(100) DEFAULT 'Bangladesh', -- Coordinates latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- ═══════════════════════════════════════════════════════════════ -- OWNERSHIP -- ═══════════════════════════════════════════════════════════════ owner_user_id UUID NOT NULL REFERENCES users(id), owner_name VARCHAR(255), owner_phone VARCHAR(20), owner_email VARCHAR(255), owner_nid VARCHAR(20), -- ═══════════════════════════════════════════════════════════════ -- STATUS & APPROVAL -- ═══════════════════════════════════════════════════════════════ status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'active', 'suspended', 'rejected', 'closed')), -- Application applied_at TIMESTAMPTZ DEFAULT NOW(), -- Approval approved_at TIMESTAMPTZ, approved_by UUID REFERENCES users(id), -- Rejection rejected_at TIMESTAMPTZ, rejected_by UUID REFERENCES users(id), rejection_reason TEXT, -- Suspension suspended_at TIMESTAMPTZ, suspended_by UUID REFERENCES users(id), suspended_reason TEXT, suspended_until TIMESTAMPTZ, -- Closure closed_at TIMESTAMPTZ, closure_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- SUBSCRIPTION -- ═══════════════════════════════════════════════════════════════ current_plan_id UUID REFERENCES plans(id), subscription_status VARCHAR(20) DEFAULT 'none' CHECK (subscription_status IN ('none', 'trial', 'active', 'expired', 'cancelled')), trial_ends_at DATE, subscription_ends_at DATE, -- ═══════════════════════════════════════════════════════════════ -- COMMISSION (Platform takes this percentage) -- ═══════════════════════════════════════════════════════════════ commission_type VARCHAR(20) DEFAULT 'percentage' CHECK (commission_type IN ('percentage', 'fixed', 'hybrid')), commission_rate DECIMAL(5,2) DEFAULT 10.00, -- 10% default fixed_commission DECIMAL(10,2) DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- LIMITS (Based on plan, can be overridden) -- ═══════════════════════════════════════════════════════════════ max_products INTEGER DEFAULT 50, max_users INTEGER DEFAULT 3, max_images_per_product INTEGER DEFAULT 5, -- Overrides

Nazmul Hassan Shaown, [1/14/2026 3:39 AM]
limits_overridden BOOLEAN DEFAULT FALSE, limits_override_by UUID REFERENCES users(id), limits_override_at TIMESTAMPTZ, limits_override_reason TEXT, -- ═══════════════════════════════════════════════════════════════ -- STATS (Denormalized for performance) -- ═══════════════════════════════════════════════════════════════ total_products INTEGER DEFAULT 0, total_orders INTEGER DEFAULT 0, total_revenue DECIMAL(15,2) DEFAULT 0, total_customers INTEGER DEFAULT 0, average_rating DECIMAL(3,2) DEFAULT 0, total_reviews INTEGER DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SETTINGS -- ═══════════════════════════════════════════════════════════════ auto_approve_orders BOOLEAN DEFAULT FALSE, notification_email VARCHAR(255), notification_phone VARCHAR(20), min_order_amount DECIMAL(10,2) DEFAULT 0, -- ═══════════════════════════════════════════════════════════════ -- SEO -- ═══════════════════════════════════════════════════════════════ meta_title VARCHAR(255), meta_description TEXT, meta_keywords TEXT[], -- ═══════════════════════════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE ); -- Indexes CREATE INDEX idx_dealers_slug ON dealers(slug); CREATE INDEX idx_dealers_status ON dealers(status); CREATE INDEX idx_dealers_owner ON dealers(owner_user_id); CREATE INDEX idx_dealers_plan ON dealers(current_plan_id); CREATE INDEX idx_dealers_subscription_status ON dealers(subscription_status); CREATE INDEX idx_dealers_district ON dealers(district); CREATE INDEX idx_dealers_created ON dealers(created_at); -- Full Text Search CREATE INDEX idx_dealers_search ON dealers USING gin(to_tsvector('english', business_name  ' '  COALESCE(description, ''))); -- ============================================================================ -- TABLE B2: dealer_users -- ডিলারের টিম মেম্বার -- ============================================================================ CREATE TABLE dealer_users ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- Role within dealer (uses same role table but filtered) dealer_role VARCHAR(20) NOT NULL DEFAULT 'staff' CHECK (dealer_role IN ('owner', 'manager', 'staff')), -- Granular Permissions (for staff customization) can_manage_products BOOLEAN DEFAULT TRUE, can_manage_orders BOOLEAN DEFAULT TRUE, can_view_reports BOOLEAN DEFAULT FALSE, can_manage_inventory BOOLEAN DEFAULT TRUE, can_manage_coupons BOOLEAN DEFAULT FALSE, can_manage_staff BOOLEAN DEFAULT FALSE, can_view_finance BOOLEAN DEFAULT FALSE, can_reply_reviews BOOLEAN DEFAULT FALSE, -- Status is_active BOOLEAN DEFAULT TRUE, -- Invitation invited_at TIMESTAMPTZ DEFAULT NOW(), invited_by UUID REFERENCES users(id), accepted_at TIMESTAMPTZ, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(dealer_id, user_id) ); -- Indexes CREATE INDEX idx_dealer_users_dealer ON dealer_users(dealer_id); CREATE INDEX idx_dealer_users_user ON dealer_users(user_id); CREATE INDEX idx_dealer_users_role ON dealer_users(dealer_role); -- ============================================================================ -- TABLE B3: dealer_documents -- ট্রেড লাইসেন্স, NID, etc. -- ============================================================================ CREATE TABLE dealer_documents ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Document Info document_type VARCHAR(50) NOT NULL CHECK (document_type IN ( 'trade_license', 'tin_certificate', 'bin_certificate', 'nid_front', 'nid_back', 'passport', 'bank_statement', 'utility_bill', 'store_photo', 'authorization_letter', 'other' )), document_name VARCHAR(255) NOT NULL, document_number VARCHAR(100), -- File file_url TEXT NOT NULL, file_name VARCHAR(255), file_size INTEGER,

Nazmul Hassan Shaown, [1/14/2026 3:39 AM]
-- bytes mime_type VARCHAR(100), -- Validity issue_date DATE, expiry_date DATE, -- Verification status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'verified', 'rejected', 'expired')), verified_at TIMESTAMPTZ, verified_by UUID REFERENCES users(id), rejection_reason TEXT, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), uploaded_by UUID REFERENCES users(id) ); -- Indexes CREATE INDEX idx_dealer_docs_dealer ON dealer_documents(dealer_id); CREATE INDEX idx_dealer_docs_type ON dealer_documents(document_type); CREATE INDEX idx_dealer_docs_status ON dealer_documents(status); -- ============================================================================ -- TABLE B4: dealer_bank_accounts -- পেমেন্ট সেটেলমেন্টের জন্য -- ============================================================================ CREATE TABLE dealer_bank_accounts ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Account Type account_type VARCHAR(20) NOT NULL DEFAULT 'bank' CHECK (account_type IN ('bank', 'bkash', 'nagad', 'rocket', 'upay')), -- Bank Details bank_name VARCHAR(100), branch_name VARCHAR(100), branch_code VARCHAR(50), routing_number VARCHAR(50), swift_code VARCHAR(20), -- Account Details account_name VARCHAR(255) NOT NULL, account_number VARCHAR(50) NOT NULL, account_type_detail VARCHAR(50), -- savings, current -- Mobile Banking mobile_number VARCHAR(20), -- Verification is_verified BOOLEAN DEFAULT FALSE, verified_at TIMESTAMPTZ, verified_by UUID REFERENCES users(id), verification_doc_url TEXT, -- Status is_primary BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes CREATE INDEX idx_dealer_bank_dealer ON dealer_bank_accounts(dealer_id); CREATE INDEX idx_dealer_bank_type ON dealer_bank_accounts(account_type); CREATE INDEX idx_dealer_bank_primary ON dealer_bank_accounts(dealer_id, is_primary) WHERE is_primary = TRUE; -- ============================================================================ -- TABLE B5: dealer_settings -- ডিলার-specific সেটিংস -- ============================================================================ CREATE TABLE dealer_settings ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Key-Value key VARCHAR(100) NOT NULL, value TEXT, value_type VARCHAR(20) DEFAULT 'string' CHECK (value_type IN ('string', 'number', 'boolean', 'json')), -- Metadata updated_at TIMESTAMPTZ DEFAULT NOW(), updated_by UUID REFERENCES users(id), UNIQUE(dealer_id, key) ); -- Index CREATE INDEX idx_dealer_settings_dealer ON dealer_settings(dealer_id); -- ============================================================================ -- TABLE B6: dealer_notifications -- ডিলারদের নোটিফিকেশন preferences -- ============================================================================ CREATE TABLE dealer_notifications ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), dealer_id UUID NOT NULL REFERENCES dealers(id) ON DELETE CASCADE, -- Email Notifications email_new_order BOOLEAN DEFAULT TRUE, email_order_cancelled BOOLEAN DEFAULT TRUE, email_payment_received BOOLEAN DEFAULT TRUE, email_low_stock BOOLEAN DEFAULT TRUE, email_review_received BOOLEAN DEFAULT TRUE, email_payout BOOLEAN DEFAULT TRUE, email_subscription BOOLEAN DEFAULT TRUE, email_announcements BOOLEAN DEFAULT TRUE, -- SMS Notifications sms_new_order BOOLEAN DEFAULT TRUE, sms_order_cancelled BOOLEAN DEFAULT FALSE, sms_payment_received BOOLEAN DEFAULT TRUE, sms_low_stock BOOLEAN DEFAULT FALSE, sms_payout BOOLEAN DEFAULT TRUE, -- Push Notifications push_enabled BOOLEAN DEFAULT TRUE, -- Metadata updated_at TIMESTAMPTZ DEFAULT NOW(), UNIQUE(dealer_id) ); -- Index CREATE INDEX idx_dealer_notifications_dealer ON dealer_notifications(dealer_id);

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
-- ╔══════════════════════════════════════════════════════════════════════════════╗ -- ║ MODULE A: AUTHENTICATION & USERS ║ -- ╚══════════════════════════════════════════════════════════════════════════════╝ -- ============================================================================ -- TABLE A1: roles -- সিস্টেমে কী কী রোল আছে এবং তাদের ক্ষমতার লেভেল -- ============================================================================ CREATE TABLE roles ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Role Identity name VARCHAR(50) UNIQUE NOT NULL, display_name VARCHAR(100) NOT NULL, display_name_bn VARCHAR(100), description TEXT, -- Hierarchy (Lower number = Higher authority) -- Super Admin = 1, Admin = 2, ..., Customer = 99 level INTEGER NOT NULL DEFAULT 99, -- Role Type role_type VARCHAR(20) NOT NULL DEFAULT 'system' CHECK (role_type IN ('system', 'dealer', 'customer')), -- Status is_active BOOLEAN DEFAULT TRUE, is_system_role BOOLEAN DEFAULT FALSE, -- TRUE = Cannot delete -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- Default Roles Insert INSERT INTO roles (name, display_name, display_name_bn, level, role_type, is_system_role) VALUES -- System Roles ('super_admin', 'Super Admin', 'সুপার অ্যাডমিন', 1, 'system', TRUE), ('admin', 'Admin', 'অ্যাডমিন', 2, 'system', TRUE), ('support', 'Support Staff', 'সাপোর্ট স্টাফ', 3, 'system', TRUE), ('accountant', 'Accountant', 'হিসাবরক্ষক', 4, 'system', TRUE), ('viewer', 'Viewer', 'ভিউয়ার', 5, 'system', TRUE), -- Dealer Roles ('dealer_owner', 'Dealer Owner', 'ডিলার মালিক', 10, 'dealer', TRUE), ('dealer_manager', 'Dealer Manager', 'ডিলার ম্যানেজার', 11, 'dealer', TRUE), ('dealer_staff', 'Dealer Staff', 'ডিলার স্টাফ', 12, 'dealer', TRUE), -- Customer Role ('customer', 'Customer', 'কাস্টমার', 99, 'customer', TRUE); -- Index CREATE INDEX idx_roles_level ON roles(level); CREATE INDEX idx_roles_type ON roles(role_type); -- ============================================================================ -- TABLE A2: users -- সব ধরনের ইউজার এখানে থাকবে -- ============================================================================ CREATE TABLE users ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Authentication email VARCHAR(255) UNIQUE NOT NULL, phone VARCHAR(20) UNIQUE, password_hash TEXT NOT NULL, -- Profile first_name VARCHAR(100) NOT NULL, last_name VARCHAR(100), full_name VARCHAR(200) GENERATED ALWAYS AS ( CASE WHEN last_name IS NOT NULL THEN first_name  ' '  last_name ELSE first_name END ) STORED, avatar_url TEXT, date_of_birth DATE, gender VARCHAR(10) CHECK (gender IN ('male', 'female', 'other')), -- Role & Access role_id UUID NOT NULL REFERENCES roles(id), -- Dealer Association (NULL for Admin/Customer) dealer_id UUID REFERENCES dealers(id) ON DELETE SET NULL, -- Status status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('active', 'inactive', 'suspended', 'pending', 'deleted')), -- Verification email_verified BOOLEAN DEFAULT FALSE, email_verified_at TIMESTAMPTZ, phone_verified BOOLEAN DEFAULT FALSE, phone_verified_at TIMESTAMPTZ, -- Security password_changed_at TIMESTAMPTZ DEFAULT NOW(), last_login_at TIMESTAMPTZ, last_login_ip INET, failed_login_count INTEGER DEFAULT 0, locked_until TIMESTAMPTZ, -- MFA (Multi-Factor Authentication) mfa_enabled BOOLEAN DEFAULT FALSE, mfa_secret TEXT, mfa_recovery_codes TEXT[], -- Preferences language VARCHAR(10) DEFAULT 'bn', timezone VARCHAR(50) DEFAULT 'Asia/Dhaka', -- Metadata created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), created_by UUID REFERENCES users(id), -- Soft Delete deleted_at TIMESTAMPTZ, is_deleted BOOLEAN DEFAULT FALSE ); -- Indexes CREATE INDEX idx_users_email ON users(email); CREATE INDEX idx_users_phone ON users(phone); CREATE INDEX idx_users_role ON users(role_id); CREATE INDEX idx_users_dealer ON users(dealer_id); CREATE INDEX idx_users_status ON users(status); CREATE INDEX idx_users_created ON users(created_at); -- Full Text Search Index CREATE INDEX idx_users_search ON users USING gin(to_tsvector('english', first_name  ' '

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
COALESCE(last_name, '')  ' '  email)); -- ============================================================================ -- TABLE A3: permissions -- সিস্টেমে কী কী কাজ করা যায় -- ============================================================================ CREATE TABLE permissions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Permission Identity name VARCHAR(100) UNIQUE NOT NULL, display_name VARCHAR(150) NOT NULL, display_name_bn VARCHAR(150), description TEXT, -- Grouping module VARCHAR(50) NOT NULL, -- Required Level (Lower level users automatically have this permission) required_level INTEGER NOT NULL DEFAULT 99, -- Status is_active BOOLEAN DEFAULT TRUE, -- Metadata created_at TIMESTAMPTZ DEFAULT NOW() ); -- Insert All Permissions INSERT INTO permissions (name, display_name, module, required_level) VALUES -- ═══════════════════════════════════════════════════════════════ -- USER MANAGEMENT (Module: users) -- ═══════════════════════════════════════════════════════════════ ('users.view_all', 'View All Users', 'users', 2), ('users.view_own', 'View Own Profile', 'users', 99), ('users.create_admin', 'Create Admin Users', 'users', 1), ('users.create_support', 'Create Support Users', 'users', 2), ('users.edit', 'Edit Users', 'users', 2), ('users.delete', 'Delete Users', 'users', 1), ('users.suspend', 'Suspend Users', 'users', 2), ('users.force_logout', 'Force Logout Users', 'users', 1), ('users.reset_password', 'Reset User Password', 'users', 3), -- ═══════════════════════════════════════════════════════════════ -- DEALER MANAGEMENT (Module: dealers) -- ═══════════════════════════════════════════════════════════════ ('dealers.view_all', 'View All Dealers', 'dealers', 2), ('dealers.view_own', 'View Own Dealer Profile', 'dealers', 12), ('dealers.create', 'Create Dealer', 'dealers', 2), ('dealers.edit', 'Edit Dealer', 'dealers', 2), ('dealers.edit_own', 'Edit Own Dealer', 'dealers', 10), ('dealers.approve', 'Approve Dealer', 'dealers', 2), ('dealers.reject', 'Reject Dealer', 'dealers', 2), ('dealers.suspend', 'Suspend Dealer', 'dealers', 2), ('dealers.delete', 'Delete Dealer', 'dealers', 1), ('dealers.verify_documents', 'Verify Dealer Documents', 'dealers', 2), ('dealers.override_limits', 'Override Dealer Limits', 'dealers', 1), -- ═══════════════════════════════════════════════════════════════ -- DEALER TEAM MANAGEMENT (Module: dealer_team) -- ═══════════════════════════════════════════════════════════════ ('dealer_team.view', 'View Team Members', 'dealer_team', 12), ('dealer_team.add', 'Add Team Member', 'dealer_team', 11), ('dealer_team.edit', 'Edit Team Member', 'dealer_team', 11), ('dealer_team.remove', 'Remove Team Member', 'dealer_team', 10), ('dealer_team.set_permissions', 'Set Team Permissions', 'dealer_team', 10), -- ═══════════════════════════════════════════════════════════════ -- PRODUCT MANAGEMENT (Module: products) -- ═══════════════════════════════════════════════════════════════ ('products.view_all', 'View All Products', 'products', 2), ('products.view_own', 'View Own Products', 'products', 12), ('products.view_public', 'View Public Products', 'products', 99), ('products.create', 'Create Product', 'products', 12), ('products.edit', 'Edit Product', 'products', 12), ('products.delete', 'Delete Product', 'products', 11), ('products.approve', 'Approve Product', 'products', 2), ('products.reject', 'Reject Product', 'products', 2), ('products.block', 'Block Product', 'products', 2), ('products.feature', 'Feature Product', 'products', 2), ('products.bulk_import', 'Bulk Import Products', 'products', 10), ('products.bulk_export', 'Bulk Export Products', 'products', 10), -- ═══════════════════════════════════════════════════════════════ -- CATEGORY MANAGEMENT (Module: categories) -- ═══════════════════════════════════════════════════════════════ ('categories.view', 'View Categories', 'categories', 99), ('categories.create', 'Create Category', 'categories', 2), ('categories.edit', 'Edit Category', 'categories', 2), ('categories.delete', 'Delete Category', 'categories', 1), --

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
═══════════════════════════════════════════════════════════════ -- BIKE MODELS (Module: bike_models) -- ═══════════════════════════════════════════════════════════════ ('bike_models.view', 'View Bike Models', 'bike_models', 99), ('bike_models.manage', 'Manage Bike Models', 'bike_models', 2), -- ═══════════════════════════════════════════════════════════════ -- INVENTORY (Module: inventory) -- ═══════════════════════════════════════════════════════════════ ('inventory.view', 'View Inventory', 'inventory', 12), ('inventory.update', 'Update Stock', 'inventory', 12), ('inventory.adjust', 'Stock Adjustment', 'inventory', 11), ('inventory.history', 'View Stock History', 'inventory', 11), -- ═══════════════════════════════════════════════════════════════ -- ORDER MANAGEMENT (Module: orders) -- ═══════════════════════════════════════════════════════════════ ('orders.view_all', 'View All Orders', 'orders', 2), ('orders.view_own_dealer', 'View Own Dealer Orders', 'orders', 12), ('orders.view_own_customer', 'View Own Customer Orders', 'orders', 99), ('orders.create_admin', 'Create Order (Admin)', 'orders', 2), ('orders.place', 'Place Order', 'orders', 99), ('orders.confirm', 'Confirm Order', 'orders', 12), ('orders.process', 'Process Order', 'orders', 12), ('orders.ship', 'Ship Order', 'orders', 12), ('orders.deliver', 'Mark Delivered', 'orders', 11), ('orders.cancel', 'Cancel Order', 'orders', 11), ('orders.add_notes', 'Add Order Notes', 'orders', 12), ('orders.export', 'Export Orders', 'orders', 10), -- ═══════════════════════════════════════════════════════════════ -- PAYMENT & FINANCE (Module: payments) -- ═══════════════════════════════════════════════════════════════ ('payments.view_all', 'View All Payments', 'payments', 2), ('payments.view_own', 'View Own Payments', 'payments', 11), ('payments.process_refund', 'Process Refund', 'payments', 1), ('payments.approve_refund', 'Approve Refund', 'payments', 2), ('payments.request_refund', 'Request Refund', 'payments', 99), ('payments.settings', 'Payment Settings', 'payments', 1), -- ═══════════════════════════════════════════════════════════════ -- COMMISSION & PAYOUTS (Module: finance) -- ═══════════════════════════════════════════════════════════════ ('finance.view_all_commissions', 'View All Commissions', 'finance', 2), ('finance.view_own_commissions', 'View Own Commissions', 'finance', 11), ('finance.set_commission', 'Set Commission Rate', 'finance', 1), ('finance.view_all_payouts', 'View All Payouts', 'finance', 2), ('finance.view_own_payouts', 'View Own Payouts', 'finance', 11), ('finance.process_payout', 'Process Payout', 'finance', 1), ('finance.manage_bank', 'Manage Bank Account', 'finance', 10), -- ═══════════════════════════════════════════════════════════════ -- SUBSCRIPTION & PLANS (Module: subscriptions) -- ═══════════════════════════════════════════════════════════════ ('subscriptions.view_plans', 'View Plans', 'subscriptions', 10), ('subscriptions.manage_plans', 'Manage Plans', 'subscriptions', 1), ('subscriptions.view_all', 'View All Subscriptions', 'subscriptions', 2), ('subscriptions.view_own', 'View Own Subscription', 'subscriptions', 10), ('subscriptions.assign', 'Assign Subscription', 'subscriptions', 2), ('subscriptions.cancel', 'Cancel Subscription', 'subscriptions', 10), ('subscriptions.extend', 'Extend Subscription', 'subscriptions', 1), -- ═══════════════════════════════════════════════════════════════ -- COUPONS (Module: coupons) -- ═══════════════════════════════════════════════════════════════ ('coupons.view_all', 'View All Coupons', 'coupons', 2), ('coupons.view_own', 'View Own Coupons', 'coupons', 11), ('coupons.create_platform', 'Create Platform Coupon', 'coupons', 2), ('coupons.create_dealer', 'Create Dealer Coupon', 'coupons', 11), ('coupons.edit', 'Edit Coupon', 'coupons', 11), ('coupons.delete', 'Delete Coupon', 'coupons', 10), ('coupons.apply', 'Apply Coupon', 'coupons', 99), -- ═══════════════════════════════════════════════════════════════ -- REVIEWS (Module: reviews) -- ═══════════════════════════════════════════════════════════════

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
('reviews.view_all', 'View All Reviews', 'reviews', 2), ('reviews.view_public', 'View Public Reviews', 'reviews', 99), ('reviews.write', 'Write Review', 'reviews', 99), ('reviews.approve', 'Approve Review', 'reviews', 2), ('reviews.reject', 'Reject Review', 'reviews', 2), ('reviews.delete', 'Delete Review', 'reviews', 2), ('reviews.reply', 'Reply to Review', 'reviews', 11), -- ═══════════════════════════════════════════════════════════════ -- REPORTS (Module: reports) -- ═══════════════════════════════════════════════════════════════ ('reports.platform_dashboard', 'Platform Dashboard', 'reports', 2), ('reports.dealer_dashboard', 'Dealer Dashboard', 'reports', 12), ('reports.sales', 'Sales Report', 'reports', 11), ('reports.revenue', 'Revenue Report', 'reports', 11), ('reports.products', 'Product Report', 'reports', 11), ('reports.customers', 'Customer Report', 'reports', 2), ('reports.dealers', 'Dealer Report', 'reports', 2), ('reports.commission', 'Commission Report', 'reports', 10), ('reports.financial', 'Financial Report', 'reports', 1), ('reports.export_pdf', 'Export PDF', 'reports', 10), ('reports.export_excel', 'Export Excel', 'reports', 10), -- ═══════════════════════════════════════════════════════════════ -- SUPPORT (Module: support) -- ═══════════════════════════════════════════════════════════════ ('support.view_all_tickets', 'View All Tickets', 'support', 3), ('support.view_own_tickets', 'View Own Tickets', 'support', 99), ('support.create_ticket', 'Create Ticket', 'support', 99), ('support.reply_ticket', 'Reply to Ticket', 'support', 3), ('support.assign_ticket', 'Assign Ticket', 'support', 3), ('support.close_ticket', 'Close Ticket', 'support', 3), ('support.view_contact_messages', 'View Contact Messages', 'support', 3), -- ═══════════════════════════════════════════════════════════════ -- CMS & CONTENT (Module: cms) -- ═══════════════════════════════════════════════════════════════ ('cms.view_pages', 'View Pages', 'cms', 99), ('cms.manage_pages', 'Manage Pages', 'cms', 2), ('cms.manage_banners', 'Manage Banners', 'cms', 2), ('cms.manage_faqs', 'Manage FAQs', 'cms', 3), ('cms.manage_templates', 'Manage Email/SMS Templates', 'cms', 2), -- ═══════════════════════════════════════════════════════════════ -- SHIPPING (Module: shipping) -- ═══════════════════════════════════════════════════════════════ ('shipping.view_zones', 'View Shipping Zones', 'shipping', 10), ('shipping.manage_zones', 'Manage Shipping Zones', 'shipping', 2), ('shipping.view_methods', 'View Shipping Methods', 'shipping', 99), ('shipping.manage_methods', 'Manage Shipping Methods', 'shipping', 2), -- ═══════════════════════════════════════════════════════════════ -- NOTIFICATIONS (Module: notifications) -- ═══════════════════════════════════════════════════════════════ ('notifications.send_bulk', 'Send Bulk Notification', 'notifications', 2), ('notifications.manage_newsletter', 'Manage Newsletter', 'notifications', 2), -- ═══════════════════════════════════════════════════════════════ -- SYSTEM SETTINGS (Module: settings) -- ═══════════════════════════════════════════════════════════════ ('settings.view', 'View Settings', 'settings', 2), ('settings.edit_general', 'Edit General Settings', 'settings', 1), ('settings.edit_payment', 'Edit Payment Settings', 'settings', 1), ('settings.edit_locale', 'Edit Locale Settings', 'settings', 1), ('settings.manage_features', 'Manage Feature Flags', 'settings', 1), ('settings.maintenance_mode', 'Toggle Maintenance Mode', 'settings', 1), ('settings.edit_branding', 'Edit Branding', 'settings', 1), -- ═══════════════════════════════════════════════════════════════ -- AUDIT & SECURITY (Module: audit) -- ═══════════════════════════════════════════════════════════════ ('audit.view_logs', 'View Audit Logs', 'audit', 1), ('audit.export_logs', 'Export Audit Logs', 'audit', 1), ('audit.view_security_logs', 'View Security Logs', 'audit', 1), ('audit.manage_ip_allowlist', 'Manage IP Allowlist', 'audit', 1), ('audit.view_sessions', 'View Active Sessions', 'audit', 2), --

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
═══════════════════════════════════════════════════════════════ -- EMERGENCY ACTIONS (Module: emergency) -- ═══════════════════════════════════════════════════════════════ ('emergency.freeze_dealer', 'Freeze Dealer', 'emergency', 1), ('emergency.freeze_payments', 'Freeze Payments', 'emergency', 1), ('emergency.backup_database', 'Backup Database', 'emergency', 1), ('emergency.restore_database', 'Restore Database', 'emergency', 1), ('emergency.incident_report', 'Generate Incident Report', 'emergency', 2); -- Index CREATE INDEX idx_permissions_module ON permissions(module); CREATE INDEX idx_permissions_level ON permissions(required_level); -- ============================================================================ -- TABLE A4: role_permissions -- কোন রোলের কী কী পারমিশন আছে (Explicit assignment) -- ============================================================================ CREATE TABLE role_permissions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE, permission_id UUID NOT NULL REFERENCES permissions(id) ON DELETE CASCADE, -- Grant Type granted_by UUID REFERENCES users(id), granted_at TIMESTAMPTZ DEFAULT NOW(), -- Constraints UNIQUE(role_id, permission_id) ); -- Index CREATE INDEX idx_role_permissions_role ON role_permissions(role_id); CREATE INDEX idx_role_permissions_permission ON role_permissions(permission_id); -- ============================================================================ -- TABLE A5: user_sessions -- Active login sessions -- ============================================================================ CREATE TABLE user_sessions ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- Token token_hash TEXT NOT NULL, refresh_token_hash TEXT, -- Device Info device_type VARCHAR(50), -- desktop, mobile, tablet device_name VARCHAR(255), browser VARCHAR(100), os VARCHAR(100), -- Location ip_address INET, country VARCHAR(100), city VARCHAR(100), -- User Agent user_agent TEXT, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, last_activity_at TIMESTAMPTZ DEFAULT NOW(), -- Status is_active BOOLEAN DEFAULT TRUE, revoked_at TIMESTAMPTZ, revoked_reason VARCHAR(255) ); -- Indexes CREATE INDEX idx_sessions_user ON user_sessions(user_id); CREATE INDEX idx_sessions_token ON user_sessions(token_hash); CREATE INDEX idx_sessions_active ON user_sessions(is_active, expires_at); -- ============================================================================ -- TABLE A6: audit_logs -- All important actions (IMMUTABLE - Cannot be edited or deleted) -- ============================================================================ CREATE TABLE audit_logs ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Who performed the action user_id UUID REFERENCES users(id), user_email VARCHAR(255), user_name VARCHAR(200), user_role VARCHAR(50), -- Dealer context (if applicable) dealer_id UUID REFERENCES dealers(id), dealer_name VARCHAR(255), -- What action was performed action VARCHAR(100) NOT NULL, action_type VARCHAR(20) NOT NULL CHECK (action_type IN ('create', 'read', 'update', 'delete', 'login', 'logout', 'export', 'import', 'approve', 'reject', 'other')), -- On what resource module VARCHAR(50) NOT NULL, resource_type VARCHAR(50), resource_id UUID, resource_name VARCHAR(255), -- Change details old_values JSONB, new_values JSONB, changed_fields TEXT[], -- Description description TEXT, -- Request context ip_address INET, user_agent TEXT, request_id UUID, request_url TEXT, request_method VARCHAR(10), -- Geolocation country VARCHAR(100), city VARCHAR(100), -- Timestamp created_at TIMESTAMPTZ DEFAULT NOW(), -- Severity severity VARCHAR(20) DEFAULT 'info' CHECK (severity IN ('debug', 'info', 'warning', 'error', 'critical')) ); -- Indexes CREATE INDEX idx_audit_user ON audit_logs(user_id); CREATE INDEX idx_audit_dealer ON audit_logs(dealer_id); CREATE INDEX idx_audit_action ON audit_logs(action); CREATE INDEX idx_audit_action_type ON audit_logs(action_type); CREATE INDEX idx_audit_module

Nazmul Hassan Shaown, [1/14/2026 3:40 AM]
ON audit_logs(module); CREATE INDEX idx_audit_resource ON audit_logs(resource_type, resource_id); CREATE INDEX idx_audit_created ON audit_logs(created_at DESC); CREATE INDEX idx_audit_severity ON audit_logs(severity); -- IMPORTANT: Prevent DELETE on audit_logs -- This will be enforced via RLS policies and triggers -- ============================================================================ -- TABLE A7: otp_verifications -- OTP for phone/email verification -- ============================================================================ CREATE TABLE otp_verifications ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Target identifier VARCHAR(255) NOT NULL, -- email or phone identifier_type VARCHAR(20) NOT NULL CHECK (identifier_type IN ('email', 'phone')), -- Purpose purpose VARCHAR(50) NOT NULL CHECK (purpose IN ( 'registration', 'login', 'password_reset', 'phone_verify', 'email_verify', 'order_confirm', 'withdrawal' )), -- OTP otp_code VARCHAR(10) NOT NULL, otp_hash TEXT NOT NULL, -- Attempts attempts INTEGER DEFAULT 0, max_attempts INTEGER DEFAULT 5, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, verified_at TIMESTAMPTZ, -- Status is_used BOOLEAN DEFAULT FALSE, -- Security ip_address INET, user_agent TEXT ); -- Indexes CREATE INDEX idx_otp_identifier ON otp_verifications(identifier, identifier_type); CREATE INDEX idx_otp_expires ON otp_verifications(expires_at); CREATE INDEX idx_otp_purpose ON otp_verifications(purpose); -- ============================================================================ -- TABLE A8: password_resets -- Password reset tokens -- ============================================================================ CREATE TABLE password_resets ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, email VARCHAR(255) NOT NULL, -- Token token_hash TEXT NOT NULL, -- Timing created_at TIMESTAMPTZ DEFAULT NOW(), expires_at TIMESTAMPTZ NOT NULL, used_at TIMESTAMPTZ, -- Status is_used BOOLEAN DEFAULT FALSE, -- Security ip_address INET, user_agent TEXT ); -- Indexes CREATE INDEX idx_password_reset_user ON password_resets(user_id); CREATE INDEX idx_password_reset_email ON password_resets(email); CREATE INDEX idx_password_reset_token ON password_resets(token_hash); CREATE INDEX idx_password_reset_expires ON password_resets(expires_at);

Nazmul Hassan Shaown, [1/14/2026 3:45 AM]
-- ============================================= -- TABLE: customer_addresses -- PURPOSE: কাস্টমারের সেভ করা ডেলিভারি এড্রেস -- RELATION: users (1) ──► (M) customer_addresses -- ============================================= CREATE TABLE customer_addresses ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- OWNER REFERENCE -- ═══════════════════════════════════════════ user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- ADDRESS TYPE & LABEL -- ═══════════════════════════════════════════ address_type VARCHAR(20) DEFAULT 'shipping' CHECK (address_type IN ('shipping', 'billing', 'both')), label VARCHAR(50) DEFAULT 'Home', -- Examples: Home, Office, Other -- ═══════════════════════════════════════════ -- RECIPIENT DETAILS -- ═══════════════════════════════════════════ recipient_name VARCHAR(255) NOT NULL, phone VARCHAR(20) NOT NULL, alt_phone VARCHAR(20), email VARCHAR(255), -- ═══════════════════════════════════════════ -- ADDRESS FIELDS (BANGLADESH SPECIFIC) -- ═══════════════════════════════════════════ address_line1 VARCHAR(255) NOT NULL, -- বাড়ি নং, রোড address_line2 VARCHAR(255), -- অতিরিক্ত তথ্য area VARCHAR(100), -- মহল্লা/এলাকা city VARCHAR(100) NOT NULL, -- শহর district VARCHAR(100) NOT NULL, -- জেলা division VARCHAR(100), -- বিভাগ postal_code VARCHAR(20), -- পোস্ট কোড country VARCHAR(100) DEFAULT 'Bangladesh', -- ═══════════════════════════════════════════ -- LOCATION (GPS - FOR FUTURE) -- ═══════════════════════════════════════════ latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- ═══════════════════════════════════════════ -- DELIVERY INSTRUCTIONS -- ═══════════════════════════════════════════ delivery_instructions TEXT, -- Example: "গেটের সামনে রাখবেন" -- ═══════════════════════════════════════════ -- DEFAULT & STATUS -- ═══════════════════════════════════════════ is_default BOOLEAN DEFAULT FALSE, is_active BOOLEAN DEFAULT TRUE, -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- ═══════════════════════════════════════════ -- INDEXES FOR PERFORMANCE -- ═══════════════════════════════════════════ CREATE INDEX idx_customer_addr_user ON customer_addresses(user_id); CREATE INDEX idx_customer_addr_default ON customer_addresses(user_id, is_default) WHERE is_default = TRUE; CREATE INDEX idx_customer_addr_district ON customer_addresses(district); -- ═══════════════════════════════════════════ -- TRIGGER: Auto-update updated_at -- ═══════════════════════════════════════════ CREATE TRIGGER update_customer_addresses_timestamp BEFORE UPDATE ON customer_addresses FOR EACH ROW EXECUTE FUNCTION update_updated_at_column(); -- ═══════════════════════════════════════════ -- TRIGGER: Ensure only one default address -- ═══════════════════════════════════════════ CREATE OR REPLACE FUNCTION ensure_single_default_address() RETURNS TRIGGER AS $$ BEGIN IF NEW.is_default = TRUE THEN UPDATE customer_addresses SET is_default = FALSE WHERE user_id = NEW.user_id AND id != NEW.id AND is_default = TRUE; END IF; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_single_default_address BEFORE INSERT OR UPDATE ON customer_addresses FOR EACH ROW EXECUTE FUNCTION ensure_single_default_address();

Nazmul Hassan Shaown, [1/14/2026 3:45 AM]
-- ============================================= -- TABLE: carts -- PURPOSE: কাস্টমারের শপিং কার্ট (একজনের একটাই অ্যাক্টিভ কার্ট) -- RELATION: users (1) ──► (1) carts (active) -- ============================================= CREATE TABLE carts ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- OWNER (Logged-in User OR Guest Session) -- ═══════════════════════════════════════════ user_id UUID REFERENCES users(id) ON DELETE CASCADE, session_id VARCHAR(255), -- Guest checkout এর জন্য (user_id NULL থাকবে) -- ═══════════════════════════════════════════ -- CART STATUS -- ═══════════════════════════════════════════ status VARCHAR(20) DEFAULT 'active' CHECK (status IN ( 'active', -- চলমান কার্ট 'merged', -- Guest → Logged in মার্জ হয়েছে 'converted', -- অর্ডারে পরিণত হয়েছে 'abandoned', -- ৩০ দিন পর এটা হবে 'expired' -- মেয়াদ শেষ )), -- ═══════════════════════════════════════════ -- COUPON / DISCOUNT -- ═══════════════════════════════════════════ coupon_id UUID REFERENCES coupons(id), coupon_code VARCHAR(50), discount_type VARCHAR(20), -- 'percentage' or 'fixed' discount_amount DECIMAL(10,2) DEFAULT 0, -- ═══════════════════════════════════════════ -- CALCULATED TOTALS -- ═══════════════════════════════════════════ item_count INTEGER DEFAULT 0, subtotal DECIMAL(12,2) DEFAULT 0, -- সব আইটেমের মোট tax_amount DECIMAL(10,2) DEFAULT 0, shipping_amount DECIMAL(10,2) DEFAULT 0, total DECIMAL(12,2) DEFAULT 0, -- subtotal + tax + shipping - discount -- ═══════════════════════════════════════════ -- CURRENCY -- ═══════════════════════════════════════════ currency VARCHAR(10) DEFAULT 'BDT', -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), converted_at TIMESTAMPTZ, -- যখন অর্ডার হয়েছে expires_at TIMESTAMPTZ DEFAULT (NOW() + INTERVAL '30 days'), -- ═══════════════════════════════════════════ -- TRACKING -- ═══════════════════════════════════════════ ip_address INET, user_agent TEXT, last_activity_at TIMESTAMPTZ DEFAULT NOW() ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_carts_user ON carts(user_id) WHERE user_id IS NOT NULL; CREATE INDEX idx_carts_session ON carts(session_id) WHERE session_id IS NOT NULL; CREATE INDEX idx_carts_status ON carts(status); CREATE INDEX idx_carts_active ON carts(user_id, status) WHERE status = 'active'; CREATE INDEX idx_carts_expires ON carts(expires_at) WHERE status = 'active'; -- ═══════════════════════════════════════════ -- CONSTRAINT: Either user_id OR session_id must exist -- ═══════════════════════════════════════════ ALTER TABLE carts ADD CONSTRAINT chk_cart_owner CHECK (user_id IS NOT NULL OR session_id IS NOT NULL);

Nazmul Hassan Shaown, [1/14/2026 3:46 AM]
-- ============================================= -- TABLE: cart_items -- PURPOSE: কার্টে কোন কোন প্রোডাক্ট আছে -- RELATION: carts (1) ──► (M) cart_items -- IMPORTANT: dealer_id রাখা হয়েছে মাল্টি-ভেন্ডর লজিকের জন্য -- ============================================= CREATE TABLE cart_items ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- PARENT CART -- ═══════════════════════════════════════════ cart_id UUID NOT NULL REFERENCES carts(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- PRODUCT REFERENCE -- ═══════════════════════════════════════════ product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, variant_id UUID REFERENCES product_variants(id) ON DELETE SET NULL, -- ═══════════════════════════════════════════ -- DEALER (MULTI-VENDOR CRITICAL) -- ═══════════════════════════════════════════ dealer_id UUID NOT NULL REFERENCES dealers(id), -- এই ফিল্ডটা খুবই গুরুত্বপূর্ণ -- এটা দিয়ে বুঝব কোন আইটেম কোন ডিলারের -- ═══════════════════════════════════════════ -- QUANTITY & PRICE (AT TIME OF ADDING) -- ═══════════════════════════════════════════ quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0), unit_price DECIMAL(10,2) NOT NULL, -- যখন কার্টে যোগ করা হয়েছে তখনকার দাম total_price DECIMAL(10,2) NOT NULL, -- unit_price × quantity -- ═══════════════════════════════════════════ -- PRODUCT SNAPSHOT (দাম বা নাম বদলালে ট্র্যাক করার জন্য) -- ═══════════════════════════════════════════ product_name VARCHAR(255) NOT NULL, product_thumbnail TEXT, variant_name VARCHAR(255), -- Example: "Red, XL" sku VARCHAR(100), -- ═══════════════════════════════════════════ -- AVAILABILITY CHECK -- ═══════════════════════════════════════════ is_available BOOLEAN DEFAULT TRUE, -- স্টক শেষ হলে FALSE availability_message VARCHAR(255), -- "Only 2 left in stock" -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), -- ═══════════════════════════════════════════ -- UNIQUE CONSTRAINT -- ═══════════════════════════════════════════ CONSTRAINT unique_cart_product_variant UNIQUE(cart_id, product_id, variant_id) ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_cart_items_cart ON cart_items(cart_id); CREATE INDEX idx_cart_items_product ON cart_items(product_id); CREATE INDEX idx_cart_items_dealer ON cart_items(dealer_id); CREATE INDEX idx_cart_items_cart_dealer ON cart_items(cart_id, dealer_id); -- ═══════════════════════════════════════════ -- TRIGGER: Update cart totals when items change -- ═══════════════════════════════════════════ CREATE OR REPLACE FUNCTION update_cart_totals() RETURNS TRIGGER AS $$ BEGIN UPDATE carts SET item_count = ( SELECT COALESCE(SUM(quantity), 0) FROM cart_items WHERE cart_id = COALESCE(NEW.cart_id, OLD.cart_id) ), subtotal = ( SELECT COALESCE(SUM(total_price), 0) FROM cart_items WHERE cart_id = COALESCE(NEW.cart_id, OLD.cart_id) ), updated_at = NOW() WHERE id = COALESCE(NEW.cart_id, OLD.cart_id); RETURN COALESCE(NEW, OLD); END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_update_cart_totals AFTER INSERT OR UPDATE OR DELETE ON cart_items FOR EACH ROW EXECUTE FUNCTION update_cart_totals();

Nazmul Hassan Shaown, [1/14/2026 3:46 AM]
-- ============================================= -- TABLE: wishlists -- PURPOSE: কাস্টমারের "Save for Later" প্রোডাক্ট -- RELATION: users (1) ──► (M) wishlists -- ============================================= CREATE TABLE wishlists ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- OWNER -- ═══════════════════════════════════════════ user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- PRODUCT -- ═══════════════════════════════════════════ product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, variant_id UUID REFERENCES product_variants(id) ON DELETE SET NULL, -- ═══════════════════════════════════════════ -- NOTIFICATION PREFERENCES -- ═══════════════════════════════════════════ notify_on_price_drop BOOLEAN DEFAULT FALSE, -- দাম কমলে নোটিফিকেশন পাবে notify_on_stock BOOLEAN DEFAULT FALSE, -- স্টকে এলে নোটিফিকেশন পাবে target_price DECIMAL(10,2), -- এই দামে নামলে নোটিফাই করো -- ═══════════════════════════════════════════ -- PRICE SNAPSHOT (যখন যোগ করেছে) -- ═══════════════════════════════════════════ price_when_added DECIMAL(10,2), -- ═══════════════════════════════════════════ -- NOTES -- ═══════════════════════════════════════════ notes TEXT, -- ব্যক্তিগত নোট -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), -- ═══════════════════════════════════════════ -- UNIQUE CONSTRAINT -- ═══════════════════════════════════════════ CONSTRAINT unique_wishlist_item UNIQUE(user_id, product_id, variant_id) ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_wishlists_user ON wishlists(user_id); CREATE INDEX idx_wishlists_product ON wishlists(product_id); CREATE INDEX idx_wishlists_price_alert ON wishlists(notify_on_price_drop) WHERE notify_on_price_drop = TRUE; CREATE INDEX idx_wishlists_stock_alert ON wishlists(notify_on_stock) WHERE notify_on_stock = TRUE;

Nazmul Hassan Shaown, [1/14/2026 3:46 AM]
┌─────────────────────────────────────────────────────────────────────────────────┐ │ ORDER LIFECYCLE │ ├─────────────────────────────────────────────────────────────────────────────────┤ │ │ │ CUSTOMER PLACES ORDER │ │ │ │ │ ▼ │ │ ┌─────────────┐ │ │ │ PENDING │ ◄── অর্ডার তৈরি হয়েছে, পেমেন্ট হয়নি │ │ └──────┬──────┘ │ │ │ │ │ ▼ (bKash Payment) │ │ ┌─────────────┐ │ │ │ PAID │ ◄── টাকা কাটা হয়েছে │ │ └──────┬──────┘ │ │ │ │ │ ▼ (Admin/Dealer confirms) │ │ ┌─────────────┐ │ │ │ CONFIRMED │ ◄── ডিলার কনফার্ম করেছে │ │ └──────┬──────┘ │ │ │ │ │ ▼ (Dealer starts packaging) │ │ ┌─────────────┐ │ │ │ PROCESSING │ ◄── প্যাকিং হচ্ছে │ │ └──────┬──────┘ │ │ │ │ │ ▼ (Handed to courier) │ │ ┌─────────────┐ │ │ │ SHIPPED │ ◄── কুরিয়ারে দেওয়া হয়েছে │ │ └──────┬──────┘ │ │ │ │ │ ▼ (Customer receives) │ │ ┌─────────────┐ │ │ │ DELIVERED │ ◄── ডেলিভারি সম্পন্ন ✅ │ │ └─────────────┘ │ │ │ │ ═══════════════════════════════════════════════════════════════════════════ │ │ ALTERNATIVE PATHS: │ │ │ │ PENDING ──► CANCELLED (পেমেন্ট না করলে বা কাস্টমার ক্যান্সেল করলে) │ │ PAID ──► REFUNDED (সমস্যা হলে পুরো টাকা ফেরত) │ │ DELIVERED ──► RETURNED (প্রোডাক্টে সমস্যা) │ │ │ └─────────────────────────────────────────────────────────────────────────────────┘

Nazmul Hassan Shaown, [1/14/2026 3:46 AM]
-- ============================================= -- TABLE: orders -- PURPOSE: কাস্টমারের অর্ডার (মূল টেবিল) -- RELATION: users (1) ──► (M) orders -- NOTE: এটা Customer এর perspective -- order_items এ Dealer perspective -- ============================================= CREATE TABLE orders ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- ORDER NUMBER (Human Readable) -- ═══════════════════════════════════════════ order_number VARCHAR(50) UNIQUE NOT NULL, -- Format: ORD-20240115-00001 -- Auto-generated by trigger -- ═══════════════════════════════════════════ -- CUSTOMER REFERENCE -- ═══════════════════════════════════════════ user_id UUID NOT NULL REFERENCES users(id), -- ═══════════════════════════════════════════ -- CUSTOMER SNAPSHOT (অর্ডারের সময়ের তথ্য) -- ═══════════════════════════════════════════ customer_name VARCHAR(255) NOT NULL, customer_email VARCHAR(255) NOT NULL, customer_phone VARCHAR(20) NOT NULL, -- ═══════════════════════════════════════════ -- SHIPPING ADDRESS (JSON - পুরো এড্রেস সেভ) -- ═══════════════════════════════════════════ shipping_address JSONB NOT NULL, /* { "recipient_name": "করিম সাহেব", "phone": "01712345678", "address_line1": "বাসা ১২, রোড ৫", "area": "ধানমন্ডি", "city": "ঢাকা", "district": "ঢাকা", "postal_code": "1205", "delivery_instructions": "গেটের সামনে রাখবেন" } */ billing_address JSONB, -- NULL হলে shipping_address same -- ═══════════════════════════════════════════ -- ORDER AMOUNTS -- ═══════════════════════════════════════════ subtotal DECIMAL(12,2) NOT NULL, -- সব প্রোডাক্টের মোট discount_amount DECIMAL(10,2) DEFAULT 0, coupon_code VARCHAR(50), coupon_id UUID REFERENCES coupons(id), tax_amount DECIMAL(10,2) DEFAULT 0, tax_rate DECIMAL(5,2) DEFAULT 0, shipping_amount DECIMAL(10,2) DEFAULT 0, shipping_method_id UUID REFERENCES shipping_methods(id), shipping_method_name VARCHAR(100), total_amount DECIMAL(12,2) NOT NULL, -- Final amount to pay -- ═══════════════════════════════════════════ -- CURRENCY -- ═══════════════════════════════════════════ currency VARCHAR(10) DEFAULT 'BDT', -- ═══════════════════════════════════════════ -- ITEM COUNT -- ═══════════════════════════════════════════ total_items INTEGER NOT NULL DEFAULT 0, total_quantity INTEGER NOT NULL DEFAULT 0, -- ═══════════════════════════════════════════ -- PAYMENT INFO -- ═══════════════════════════════════════════ payment_method VARCHAR(50) NOT NULL, -- 'bkash', 'nagad', 'cod', 'card' payment_status VARCHAR(20) DEFAULT 'pending' CHECK (payment_status IN ( 'pending', -- পেমেন্ট হয়নি 'processing', -- পেমেন্ট প্রসেস হচ্ছে 'paid', -- পেমেন্ট সম্পন্ন 'failed', -- পেমেন্ট ফেইল 'refunded', -- পুরো রিফান্ড 'partial_refund' -- আংশিক রিফান্ড )), paid_amount DECIMAL(12,2) DEFAULT 0, paid_at TIMESTAMPTZ, -- ═══════════════════════════════════════════ -- ORDER STATUS (Overall) -- ═══════════════════════════════════════════ status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ( 'pending', -- নতুন অর্ডার 'confirmed', -- কনফার্ম হয়েছে 'processing', -- প্রসেসিং 'partially_shipped',-- কিছু শিপ হয়েছে 'shipped', -- সব শিপ হয়েছে 'delivered', -- ডেলিভারি সম্পন্ন 'cancelled', -- ক্যান্সেল 'returned', -- রিটার্ন 'refunded' -- রিফান্ড )), -- ═══════════════════════════════════════════ -- STATUS DATES -- ═══════════════════════════════════════════ confirmed_at TIMESTAMPTZ, processing_at TIMESTAMPTZ, shipped_at TIMESTAMPTZ, delivered_at TIMESTAMPTZ, cancelled_at TIMESTAMPTZ, returned_at TIMESTAMPTZ, -- ═══════════════════════════════════════════ -- CANCELLATION / RETURN INFO -- ═══════════════════════════════════════════ cancellation_reason TEXT, cancelled_by UUID REFERENCES users(id), return_reason TEXT, return_requested_at TIMESTAMPTZ, -- ═══════════════════════════════════════════ -- NOTES -- ═══════════════════════════════════════════ customer_notes TEXT, -- কাস্টমার যা বলেছে internal_notes TEXT, -- ইন্টারনাল নোট (কাস্টমার দেখবে না) -- ═══════════════════════════════════════════

Nazmul Hassan Shaown, [1/14/2026 3:46 AM]
-- SOURCE & TRACKING -- ═══════════════════════════════════════════ order_source VARCHAR(50) DEFAULT 'web' CHECK (order_source IN ('web', 'mobile', 'phone', 'admin', 'api')), ip_address INET, user_agent TEXT, -- ═══════════════════════════════════════════ -- MULTI-VENDOR INFO -- ═══════════════════════════════════════════ dealer_count INTEGER DEFAULT 1, -- কয়টা ডিলারের প্রোডাক্ট আছে -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW(), -- ═══════════════════════════════════════════ -- SOFT DELETE -- ═══════════════════════════════════════════ is_deleted BOOLEAN DEFAULT FALSE, deleted_at TIMESTAMPTZ ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_orders_number ON orders(order_number); CREATE INDEX idx_orders_user ON orders(user_id); CREATE INDEX idx_orders_status ON orders(status); CREATE INDEX idx_orders_payment_status ON orders(payment_status); CREATE INDEX idx_orders_created ON orders(created_at DESC); CREATE INDEX idx_orders_user_status ON orders(user_id, status); CREATE INDEX idx_orders_date_range ON orders(created_at) WHERE is_deleted = FALSE; -- ═══════════════════════════════════════════ -- FUNCTION: Generate Order Number -- ═══════════════════════════════════════════ CREATE OR REPLACE FUNCTION generate_order_number() RETURNS TRIGGER AS $$ DECLARE today_count INTEGER; order_date TEXT; BEGIN order_date := TO_CHAR(NOW(), 'YYYYMMDD'); SELECT COUNT(*) + 1 INTO today_count FROM orders WHERE DATE(created_at) = CURRENT_DATE; NEW.order_number := 'ORD-'  order_date  '-' || LPAD(today_count::TEXT, 5, '0'); RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_generate_order_number BEFORE INSERT ON orders FOR EACH ROW EXECUTE FUNCTION generate_order_number();

Nazmul Hassan Shaown, [1/14/2026 3:47 AM]
-- ============================================= -- TABLE: order_items -- PURPOSE: প্রতিটা অর্ডারের আইটেম (ডিলার ভিত্তিক) -- RELATION: orders (1) ──► (M) order_items -- CRITICAL: এখানেই মাল্টি-ভেন্ডর লজিক কাজ করে -- ============================================= CREATE TABLE order_items ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- PARENT ORDER -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- DEALER (MULTI-VENDOR CORE) ⭐⭐⭐ -- ═══════════════════════════════════════════ dealer_id UUID NOT NULL REFERENCES dealers(id), -- এই ফিল্ডই ডিলার ড্যাশবোর্ডে ফিল্টার করতে ব্যবহৃত হবে -- ═══════════════════════════════════════════ -- PRODUCT REFERENCE -- ═══════════════════════════════════════════ product_id UUID NOT NULL REFERENCES products(id), variant_id UUID REFERENCES product_variants(id), -- ═══════════════════════════════════════════ -- PRODUCT SNAPSHOT (অর্ডারের সময়ের তথ্য) -- ═══════════════════════════════════════════ product_name VARCHAR(255) NOT NULL, product_sku VARCHAR(100), product_thumbnail TEXT, variant_name VARCHAR(255), -- ═══════════════════════════════════════════ -- QUANTITY & PRICING -- ═══════════════════════════════════════════ quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0), unit_price DECIMAL(10,2) NOT NULL, -- প্রতি পিসের দাম discount_amount DECIMAL(10,2) DEFAULT 0, -- এই আইটেমে ডিসকাউন্ট tax_amount DECIMAL(10,2) DEFAULT 0, tax_rate DECIMAL(5,2) DEFAULT 0, total_price DECIMAL(10,2) NOT NULL, -- (unit_price * quantity) - discount + tax -- ═══════════════════════════════════════════ -- COMMISSION (PLATFORM FEE) ⭐⭐⭐ -- ═══════════════════════════════════════════ commission_rate DECIMAL(5,2) NOT NULL DEFAULT 0, -- প্ল্যাটফর্ম কত % নেবে commission_amount DECIMAL(10,2) NOT NULL DEFAULT 0, -- প্ল্যাটফর্ম কত টাকা পাবে dealer_earning DECIMAL(10,2) NOT NULL DEFAULT 0, -- ডিলার কত টাকা পাবে (total - commission) -- ═══════════════════════════════════════════ -- ITEM STATUS (Per Item, Per Dealer) -- ═══════════════════════════════════════════ status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ( 'pending', -- নতুন 'confirmed', -- ডিলার কনফার্ম করেছে 'processing', -- প্যাকিং হচ্ছে 'ready_to_ship', -- শিপ করার জন্য রেডি 'shipped', -- কুরিয়ারে দিয়েছে 'in_transit', -- পথে আছে 'delivered', -- ডেলিভারি হয়েছে 'cancelled', -- ক্যান্সেল 'returned', -- রিটার্ন 'refunded' -- রিফান্ড )), -- ═══════════════════════════════════════════ -- STATUS DATES -- ═══════════════════════════════════════════ confirmed_at TIMESTAMPTZ, processing_at TIMESTAMPTZ, shipped_at TIMESTAMPTZ, delivered_at TIMESTAMPTZ, -- ═══════════════════════════════════════════ -- SHIPPING & TRACKING -- ═══════════════════════════════════════════ tracking_number VARCHAR(100), courier_name VARCHAR(100), courier_phone VARCHAR(20), estimated_delivery DATE, actual_delivery DATE, -- ═══════════════════════════════════════════ -- RETURN & REFUND -- ═══════════════════════════════════════════ return_requested BOOLEAN DEFAULT FALSE, return_requested_at TIMESTAMPTZ, return_reason TEXT, return_status VARCHAR(20) CHECK (return_status IN ( 'requested', -- রিকোয়েস্ট করেছে 'approved', -- অ্যাপ্রুভ হয়েছে 'rejected', -- রিজেক্ট 'picked_up', -- প্রোডাক্ট নেওয়া হয়েছে 'received', -- ডিলার পেয়েছে 'refunded' -- রিফান্ড হয়েছে )), refund_amount DECIMAL(10,2), refund_status VARCHAR(20), -- ═══════════════════════════════════════════ -- NOTES -- ═══════════════════════════════════════════ dealer_notes TEXT, -- ডিলারের নোট -- ═══════════════════════════════════════════ -- PAYOUT REFERENCE -- ═══════════════════════════════════════════ payout_id UUID REFERENCES dealer_payouts(id), payout_status VARCHAR(20) DEFAULT 'pending' CHECK (payout_status IN ('pending', 'processed', 'paid')), -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at

Nazmul Hassan Shaown, [1/14/2026 3:47 AM]
TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW() ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_order_items_order ON order_items(order_id); CREATE INDEX idx_order_items_dealer ON order_items(dealer_id); CREATE INDEX idx_order_items_product ON order_items(product_id); CREATE INDEX idx_order_items_status ON order_items(status); CREATE INDEX idx_order_items_dealer_status ON order_items(dealer_id, status); CREATE INDEX idx_order_items_payout ON order_items(payout_id) WHERE payout_id IS NOT NULL; CREATE INDEX idx_order_items_payout_pending ON order_items(dealer_id, payout_status) WHERE payout_status = 'pending' AND status = 'delivered'; -- ═══════════════════════════════════════════ -- TRIGGER: Calculate commission on insert/update -- ═══════════════════════════════════════════ CREATE OR REPLACE FUNCTION calculate_order_item_commission() RETURNS TRIGGER AS $$ DECLARE dealer_commission_rate DECIMAL(5,2); BEGIN -- Get dealer's commission rate SELECT COALESCE(commission_rate, 10) INTO dealer_commission_rate FROM dealers WHERE id = NEW.dealer_id; NEW.commission_rate := dealer_commission_rate; NEW.commission_amount := ROUND((NEW.total_price * dealer_commission_rate / 100), 2); NEW.dealer_earning := NEW.total_price - NEW.commission_amount; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_calculate_commission BEFORE INSERT OR UPDATE ON order_items FOR EACH ROW EXECUTE FUNCTION calculate_order_item_commission();

Nazmul Hassan Shaown, [1/14/2026 3:47 AM]
-- ============================================= -- TABLE: order_status_history -- PURPOSE: অর্ডারের প্রতিটা স্ট্যাটাস চেঞ্জ ট্র্যাক -- RELATION: orders/order_items (1) ──► (M) order_status_history -- ============================================= CREATE TABLE order_status_history ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- REFERENCE (Order or Order Item) -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, order_item_id UUID REFERENCES order_items(id) ON DELETE CASCADE, -- NULL হলে পুরো অর্ডারের স্ট্যাটাস -- NOT NULL হলে নির্দিষ্ট আইটেমের -- ═══════════════════════════════════════════ -- STATUS CHANGE -- ═══════════════════════════════════════════ status_type VARCHAR(20) DEFAULT 'order' CHECK (status_type IN ('order', 'payment', 'shipping', 'return')), previous_status VARCHAR(30), new_status VARCHAR(30) NOT NULL, -- ═══════════════════════════════════════════ -- WHO CHANGED -- ═══════════════════════════════════════════ changed_by UUID REFERENCES users(id), changed_by_role VARCHAR(50), -- 'admin', 'dealer', 'customer', 'system' changed_by_name VARCHAR(255), -- ═══════════════════════════════════════════ -- NOTES & REASON -- ═══════════════════════════════════════════ notes TEXT, reason TEXT, -- ক্যান্সেল বা রিটার্নের কারণ -- ═══════════════════════════════════════════ -- ADDITIONAL DATA -- ═══════════════════════════════════════════ metadata JSONB, /* For shipping: { "tracking_number": "CTG123456", "courier": "Pathao", "estimated_delivery": "2024-01-20" } */ -- ═══════════════════════════════════════════ -- IS VISIBLE TO CUSTOMER? -- ═══════════════════════════════════════════ is_customer_visible BOOLEAN DEFAULT TRUE, -- ═══════════════════════════════════════════ -- NOTIFICATION SENT? -- ═══════════════════════════════════════════ notification_sent BOOLEAN DEFAULT FALSE, notification_sent_at TIMESTAMPTZ, -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_at TIMESTAMPTZ DEFAULT NOW(), ip_address INET ); -- ═══════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════ CREATE INDEX idx_status_history_order ON order_status_history(order_id); CREATE INDEX idx_status_history_item ON order_status_history(order_item_id); CREATE INDEX idx_status_history_created ON order_status_history(created_at DESC); -- ═══════════════════════════════════════════ -- TRIGGER: Auto-create history on order status change -- ═══════════════════════════════════════════ CREATE OR REPLACE FUNCTION log_order_status_change() RETURNS TRIGGER AS $$ BEGIN IF OLD.status IS DISTINCT FROM NEW.status THEN INSERT INTO order_status_history ( order_id, status_type, previous_status, new_status, changed_by_role, notes ) VALUES ( NEW.id, 'order', OLD.status, NEW.status, 'system', 'Status auto-updated' ); END IF; IF OLD.payment_status IS DISTINCT FROM NEW.payment_status THEN INSERT INTO order_status_history ( order_id, status_type, previous_status, new_status, changed_by_role, notes ) VALUES ( NEW.id, 'payment', OLD.payment_status, NEW.payment_status, 'system', 'Payment status updated' ); END IF; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_log_order_status AFTER UPDATE ON orders FOR EACH ROW EXECUTE FUNCTION log_order_status_change();

Nazmul Hassan Shaown, [1/14/2026 3:57 AM]
-- ============================================= -- TABLE: order_notes -- PURPOSE: অর্ডার সম্পর্কে ইন্টারনাল নোট -- RELATION: orders (1) ──► (M) order_notes -- ============================================= CREATE TABLE order_notes ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- REFERENCE -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, order_item_id UUID REFERENCES order_items(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- NOTE TYPE -- ═══════════════════════════════════════════ note_type VARCHAR(30) DEFAULT 'general' CHECK (note_type IN ( 'general', -- সাধারণ নোট 'customer_request', -- কাস্টমারের অনুরোধ 'issue', -- সমস্যা 'resolution', -- সমাধান 'refund', -- রিফান্ড সংক্রান্ত 'shipping', -- শিপিং সংক্রান্ত 'payment', -- পেমেন্ট সংক্রান্ত 'escalation', -- এস্কেলেশন 'follow_up', -- ফলো-আপ 'cancellation' -- বাতিল সংক্রান্ত )), -- ═══════════════════════════════════════════ -- NOTE CONTENT -- ═══════════════════════════════════════════ subject VARCHAR(200), note_content TEXT NOT NULL, -- ═══════════════════════════════════════════ -- VISIBILITY & PRIORITY -- ═══════════════════════════════════════════ visibility VARCHAR(20) DEFAULT 'internal' CHECK (visibility IN ( 'internal', -- শুধু স্টাফ দেখতে পারবে 'customer_visible', -- কাস্টমারও দেখতে পারবে 'private' -- শুধু নোট লেখক দেখতে পারবে )), priority VARCHAR(15) DEFAULT 'normal' CHECK (priority IN ( 'low', 'normal', 'high', 'urgent' )), is_pinned BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════ -- ATTACHMENTS -- ═══════════════════════════════════════════ has_attachment BOOLEAN DEFAULT FALSE, attachments JSONB DEFAULT '[]', /* attachments: [ { "file_name": "screenshot.png", "file_url": "https://...", "file_type": "image/png", "file_size": 102400 } ] */ -- ═══════════════════════════════════════════ -- AUTHOR INFORMATION -- ═══════════════════════════════════════════ created_by UUID REFERENCES users(id), author_name VARCHAR(100), author_role VARCHAR(50), -- ═══════════════════════════════════════════ -- TIMESTAMPS -- ═══════════════════════════════════════════ created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP ); -- ═══════════════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════════════ CREATE INDEX idx_order_notes_order_id ON order_notes(order_id); CREATE INDEX idx_order_notes_order_item ON order_notes(order_item_id) WHERE order_item_id IS NOT NULL; CREATE INDEX idx_order_notes_type ON order_notes(note_type); CREATE INDEX idx_order_notes_visibility ON order_notes(visibility); CREATE INDEX idx_order_notes_pinned ON order_notes(order_id, is_pinned) WHERE is_pinned = TRUE; CREATE INDEX idx_order_notes_created_by ON order_notes(created_by); CREATE INDEX idx_order_notes_created_at ON order_notes(created_at DESC); -- ═══════════════════════════════════════════════════ -- TRIGGERS -- ═══════════════════════════════════════════════════ CREATE TRIGGER set_timestamp_order_notes BEFORE UPDATE ON order_notes FOR EACH ROW EXECUTE FUNCTION update_timestamp(); -- ═══════════════════════════════════════════════════ -- COMMENTS -- ═══════════════════════════════════════════════════ COMMENT ON TABLE order_notes IS 'অর্ডার সম্পর্কে ইন্টারনাল এবং এক্সটার্নাল নোটসমূহ'; COMMENT ON COLUMN order_notes.visibility IS 'নোটের দৃশ্যমানতা - কে দেখতে পারবে'; COMMENT ON COLUMN order_notes.is_pinned IS 'পিন করা নোট সবার উপরে দেখাবে';

Nazmul Hassan Shaown, [1/14/2026 3:57 AM]
-- ============================================= -- TABLE: order_refunds -- PURPOSE: রিফান্ড ম্যানেজমেন্ট -- RELATION: orders (1) ──► (M) order_refunds -- ============================================= CREATE TABLE order_refunds ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), refund_number VARCHAR(30) NOT NULL UNIQUE, -- ═══════════════════════════════════════════ -- REFERENCES -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE RESTRICT, order_item_id UUID REFERENCES order_items(id) ON DELETE RESTRICT, original_payment_id UUID REFERENCES order_payments(id), -- ═══════════════════════════════════════════ -- REFUND TYPE & REASON -- ═══════════════════════════════════════════ refund_type VARCHAR(25) NOT NULL CHECK (refund_type IN ( 'full', -- সম্পূর্ণ রিফান্ড 'partial', -- আংশিক রিফান্ড 'item_level', -- নির্দিষ্ট আইটেম রিফান্ড 'shipping_only', -- শুধু শিপিং রিফান্ড 'store_credit' -- স্টোর ক্রেডিট হিসেবে )), refund_reason VARCHAR(50) NOT NULL CHECK (refund_reason IN ( 'customer_request', -- কাস্টমারের অনুরোধ 'defective_product', -- ত্রুটিপূর্ণ পণ্য 'wrong_item_sent', -- ভুল পণ্য পাঠানো 'item_not_received', -- পণ্য না পাওয়া 'quality_issue', -- মানের সমস্যা 'size_mismatch', -- সাইজ মিলেনি 'color_mismatch', -- রং মিলেনি 'damaged_in_shipping', -- শিপিংয়ে ক্ষতিগ্রস্ত 'order_cancelled', -- অর্ডার বাতিল 'duplicate_order', -- ডুপ্লিকেট অর্ডার 'fraud_suspected', -- প্রতারণার সন্দেহ 'other' -- অন্যান্য )), reason_details TEXT, -- ═══════════════════════════════════════════ -- REFUND AMOUNTS -- ═══════════════════════════════════════════ currency VARCHAR(3) DEFAULT 'BDT', requested_amount DECIMAL(12,2) NOT NULL, approved_amount DECIMAL(12,2), item_amount DECIMAL(12,2) DEFAULT 0, shipping_amount DECIMAL(12,2) DEFAULT 0, tax_amount DECIMAL(12,2) DEFAULT 0, restocking_fee DECIMAL(12,2) DEFAULT 0, final_refund_amount DECIMAL(12,2) GENERATED ALWAYS AS ( COALESCE(approved_amount, 0) - COALESCE(restocking_fee, 0) ) STORED, -- ═══════════════════════════════════════════ -- REFUND STATUS -- ═══════════════════════════════════════════ status VARCHAR(25) DEFAULT 'requested' CHECK (status IN ( 'requested', -- রিফান্ড অনুরোধ করা হয়েছে 'under_review', -- পর্যালোচনাধীন 'approved', -- অনুমোদিত 'rejected', -- প্রত্যাখ্যাত 'processing', -- প্রসেসিং হচ্ছে 'completed', -- সম্পন্ন 'failed', -- ব্যর্থ 'cancelled' -- বাতিল )), rejection_reason TEXT, -- ═══════════════════════════════════════════ -- REFUND METHOD -- ═══════════════════════════════════════════ refund_method VARCHAR(30) CHECK (refund_method IN ( 'original_payment', -- মূল পেমেন্ট মেথডে 'bank_transfer', -- ব্যাংক ট্রান্সফার 'bkash', -- বিকাশ 'nagad', -- নগদ 'rocket', -- রকেট 'store_credit', -- স্টোর ক্রেডিট 'cash', -- ক্যাশ 'cheque' -- চেক )), refund_destination JSONB, /* refund_destination: { "type": "bkash", "account_number": "01XXXXXXXXX", "account_name": "Customer Name" } OR for bank: { "type": "bank", "bank_name": "Dutch Bangla Bank", "account_number": "XXXXXXXXXX", "account_name": "Customer Name", "branch": "Gulshan", "routing_number": "XXXXX" } */ -- ═══════════════════════════════════════════ -- TRANSACTION DETAILS -- ═══════════════════════════════════════════ transaction_id VARCHAR(100), gateway_reference VARCHAR(100), gateway_response JSONB, -- ═══════════════════════════════════════════ -- RETURN PRODUCT (if applicable) -- ═══════════════════════════════════════════ requires_return BOOLEAN DEFAULT FALSE, return_status VARCHAR(25) CHECK (return_status IN ( 'not_required', -- রিটার্ন লাগবে না 'pending', -- রিটার্ন পেন্ডিং 'shipped', -- রিটার্ন শিপ করা হয়েছে 'received', -- রিটার্ন পাওয়া গেছে 'inspecting', -- পরিদর্শন হচ্ছে 'accepted', -- গ্রহণ করা হয়েছে 'rejected' -- প্রত্যাখ্যাত )), return_tracking_number VARCHAR(100), return_received_at TIMESTAMP WITH TIME ZONE, return_condition VARCHAR(50), return_notes TEXT, -- ═══════════════════════════════════════════ -- ITEMS BEING REFUNDED --

Nazmul Hassan Shaown, [1/14/2026 3:57 AM]
═══════════════════════════════════════════ refund_items JSONB DEFAULT '[]', /* refund_items: [ { "order_item_id": "uuid", "product_name": "Product Name", "quantity": 2, "unit_price": 500.00, "total_refund": 1000.00 } ] */ -- ═══════════════════════════════════════════ -- EVIDENCE & DOCUMENTATION -- ═══════════════════════════════════════════ customer_evidence JSONB DEFAULT '[]', /* customer_evidence: [ { "type": "photo", "url": "https://...", "description": "ত্রুটিপূর্ণ পণ্যের ছবি" } ] */ internal_evidence JSONB DEFAULT '[]', -- ═══════════════════════════════════════════ -- PROCESSING TIMELINE -- ═══════════════════════════════════════════ requested_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, reviewed_at TIMESTAMP WITH TIME ZONE, approved_at TIMESTAMP WITH TIME ZONE, processed_at TIMESTAMP WITH TIME ZONE, completed_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- STAFF HANDLING -- ═══════════════════════════════════════════ requested_by UUID REFERENCES users(id), reviewed_by UUID REFERENCES users(id), approved_by UUID REFERENCES users(id), processed_by UUID REFERENCES users(id), -- ═══════════════════════════════════════════ -- STORE CREDIT (if applicable) -- ═══════════════════════════════════════════ store_credit_id UUID, store_credit_code VARCHAR(50), store_credit_expiry DATE, -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ internal_notes TEXT, metadata JSONB DEFAULT '{}', -- ═══════════════════════════════════════════ -- TIMESTAMPS -- ═══════════════════════════════════════════ created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP ); -- ═══════════════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════════════ CREATE INDEX idx_order_refunds_number ON order_refunds(refund_number); CREATE INDEX idx_order_refunds_order_id ON order_refunds(order_id); CREATE INDEX idx_order_refunds_order_item ON order_refunds(order_item_id) WHERE order_item_id IS NOT NULL; CREATE INDEX idx_order_refunds_status ON order_refunds(status); CREATE INDEX idx_order_refunds_type ON order_refunds(refund_type); CREATE INDEX idx_order_refunds_reason ON order_refunds(refund_reason); CREATE INDEX idx_order_refunds_method ON order_refunds(refund_method); CREATE INDEX idx_order_refunds_requested_at ON order_refunds(requested_at DESC); CREATE INDEX idx_order_refunds_pending ON order_refunds(status) WHERE status IN ('requested', 'under_review', 'approved', 'processing'); -- Composite index for reporting CREATE INDEX idx_order_refunds_report ON order_refunds(status, refund_type, requested_at); -- ═══════════════════════════════════════════════════ -- TRIGGERS -- ═══════════════════════════════════════════════════ CREATE TRIGGER set_timestamp_order_refunds BEFORE UPDATE ON order_refunds FOR EACH ROW EXECUTE FUNCTION update_timestamp(); -- ═══════════════════════════════════════════════════ -- REFUND NUMBER GENERATOR -- ═══════════════════════════════════════════════════ CREATE OR REPLACE FUNCTION generate_refund_number() RETURNS TRIGGER AS $$ BEGIN IF NEW.refund_number IS NULL THEN NEW.refund_number := 'REF-'  TO_CHAR(NOW(), 'YYYYMMDD')  '-' || LPAD(FLOOR(RANDOM() * 100000)::TEXT, 5, '0'); END IF; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_generate_refund_number BEFORE INSERT ON order_refunds FOR EACH ROW EXECUTE FUNCTION generate_refund_number(); -- ═══════════════════════════════════════════════════ -- COMMENTS -- ═══════════════════════════════════════════════════ COMMENT ON TABLE order_refunds IS 'অর্ডার রিফান্ড ম্যানেজমেন্ট - সম্পূর্ণ রিফান্ড প্রক্রিয়া ট্র্যাক করা'; COMMENT ON COLUMN order_refunds.restocking_fee IS 'রিস্টকিং ফি - পণ্য ফেরত নেওয়ার খরচ'; COMMENT ON COLUMN order_refunds.requires_return IS 'পণ্য ফেরত দিতে হবে কিনা';

Nazmul Hassan Shaown, [1/14/2026 3:57 AM]
-- ============================================= -- TABLE: order_tracking -- PURPOSE: অর্ডার শিপমেন্ট ট্র্যাকিং -- RELATION: orders (1) ──► (M) order_tracking -- ============================================= CREATE TABLE order_tracking ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), -- ═══════════════════════════════════════════ -- REFERENCES -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, shipment_id UUID REFERENCES order_shipments(id) ON DELETE CASCADE, -- ═══════════════════════════════════════════ -- TRACKING EVENT -- ═══════════════════════════════════════════ event_type VARCHAR(50) NOT NULL CHECK (event_type IN ( -- Order Events 'order_placed', -- অর্ডার প্লেস হয়েছে 'order_confirmed', -- অর্ডার কনফার্ম হয়েছে 'order_processing', -- অর্ডার প্রসেসিং 'order_on_hold', -- অর্ডার হোল্ডে -- Warehouse Events 'picking_started', -- পিকিং শুরু 'picking_completed', -- পিকিং সম্পন্ন 'packing_started', -- প্যাকিং শুরু 'packing_completed', -- প্যাকিং সম্পন্ন 'quality_check', -- কোয়ালিটি চেক 'ready_for_dispatch', -- ডিসপ্যাচের জন্য রেডি -- Shipping Events 'dispatched', -- ডিসপ্যাচ হয়েছে 'picked_up_by_courier', -- কুরিয়ার নিয়ে গেছে 'in_transit', -- ট্রানজিটে আছে 'arrived_at_hub', -- হাবে পৌঁছেছে 'departed_hub', -- হাব থেকে বের হয়েছে 'out_for_delivery', -- ডেলিভারির জন্য বের হয়েছে 'delivery_attempted', -- ডেলিভারি চেষ্টা করা হয়েছে 'delivered', -- ডেলিভার হয়েছে -- Return Events 'return_initiated', -- রিটার্ন শুরু 'return_picked_up', -- রিটার্ন পিক করা হয়েছে 'return_in_transit', -- রিটার্ন ট্রানজিটে 'return_received', -- রিটার্ন পাওয়া গেছে -- Issue Events 'delivery_failed', -- ডেলিভারি ব্যর্থ 'address_issue', -- ঠিকানায় সমস্যা 'customer_unavailable', -- কাস্টমার নেই 'refused_by_customer', -- কাস্টমার নিতে অস্বীকার 'damaged_in_transit', -- ট্রানজিটে ক্ষতিগ্রস্ত 'lost_in_transit', -- ট্রানজিটে হারিয়ে গেছে -- Other 'rescheduled', -- রিশিডিউল করা হয়েছে 'custom_event' -- কাস্টম ইভেন্ট )), event_title VARCHAR(200) NOT NULL, event_description TEXT, -- ═══════════════════════════════════════════ -- LOCATION INFORMATION -- ═══════════════════════════════════════════ location_type VARCHAR(30) CHECK (location_type IN ( 'warehouse', -- গুদাম 'hub', -- হাব 'sorting_center', -- সর্টিং সেন্টার 'delivery_point', -- ডেলিভারি পয়েন্ট 'customer_address', -- কাস্টমার ঠিকানা 'return_center', -- রিটার্ন সেন্টার 'in_vehicle' -- গাড়িতে )), location_name VARCHAR(200), location_address TEXT, city VARCHAR(100), area VARCHAR(100), -- GPS Coordinates latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- ═══════════════════════════════════════════ -- COURIER/AGENT INFORMATION -- ═══════════════════════════════════════════ courier_company VARCHAR(100), courier_tracking_number VARCHAR(100), agent_name VARCHAR(100), agent_phone VARCHAR(20), agent_id VARCHAR(50), vehicle_number VARCHAR(30), -- ═══════════════════════════════════════════ -- EVENT TIMING -- ═══════════════════════════════════════════ event_timestamp TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP, estimated_next_update TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- DELIVERY ATTEMPT DETAILS -- ═══════════════════════════════════════════ attempt_number INTEGER, failure_reason TEXT, next_attempt_date DATE, customer_feedback TEXT, -- ═══════════════════════════════════════════ -- PROOF OF DELIVERY -- ═══════════════════════════════════════════ pod_type VARCHAR(30) CHECK (pod_type IN ( 'signature', -- সিগনেচার 'photo', -- ফটো 'otp', -- OTP ভেরিফিকেশন 'id_verification', -- আইডি ভেরিফিকেশন 'none' -- কোনো POD নেই )), pod_data JSONB, /* pod_data: { "signature_image": "base64...", "delivery_photo": "https://...", "otp_verified": true, "receiver_name": "Name", "receiver_relation": "self/family", "id_number": "XXXXX" } */ -- ═══════════════════════════════════════════ -- SOURCE INFORMATION -- ═══════════════════════════════════════════ source VARCHAR(30) DEFAULT 'system' CHECK (source IN

Nazmul Hassan Shaown, [1/14/2026 3:57 AM]
( 'system', -- সিস্টেম জেনারেটেড 'courier_api', -- কুরিয়ার API থেকে 'manual', -- ম্যানুয়ালি এন্ট্রি 'webhook', -- ওয়েবহুক 'mobile_app' -- মোবাইল অ্যাপ )), source_reference VARCHAR(200), raw_data JSONB, -- ═══════════════════════════════════════════ -- VISIBILITY -- ═══════════════════════════════════════════ is_customer_visible BOOLEAN DEFAULT TRUE, customer_message TEXT, -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ created_by UUID REFERENCES users(id), metadata JSONB DEFAULT '{}', -- ═══════════════════════════════════════════ -- TIMESTAMPS -- ═══════════════════════════════════════════ created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP ); -- ═══════════════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════════════ CREATE INDEX idx_order_tracking_order_id ON order_tracking(order_id); CREATE INDEX idx_order_tracking_shipment ON order_tracking(shipment_id) WHERE shipment_id IS NOT NULL; CREATE INDEX idx_order_tracking_event_type ON order_tracking(event_type); CREATE INDEX idx_order_tracking_timestamp ON order_tracking(event_timestamp DESC); CREATE INDEX idx_order_tracking_courier ON order_tracking(courier_company, courier_tracking_number); CREATE INDEX idx_order_tracking_location ON order_tracking(city, area); CREATE INDEX idx_order_tracking_customer_visible ON order_tracking(order_id, is_customer_visible) WHERE is_customer_visible = TRUE; -- Composite for order timeline CREATE INDEX idx_order_tracking_timeline ON order_tracking(order_id, event_timestamp DESC); -- Spatial index for location CREATE INDEX idx_order_tracking_geo ON order_tracking(latitude, longitude) WHERE latitude IS NOT NULL AND longitude IS NOT NULL; -- ═══════════════════════════════════════════════════ -- COMMENTS -- ═══════════════════════════════════════════════════ COMMENT ON TABLE order_tracking IS 'অর্ডার ট্র্যাকিং ইভেন্টসমূহ - সম্পূর্ণ শিপমেন্ট জার্নি'; COMMENT ON COLUMN order_tracking.pod_data IS 'Proof of Delivery ডেটা'; COMMENT ON COLUMN order_tracking.is_customer_visible IS 'কাস্টমার এই আপডেট দেখতে পারবে কিনা';

Nazmul Hassan Shaown, [1/14/2026 3:58 AM]
-- ============================================= -- TABLE: order_cancellations -- PURPOSE: অর্ডার বাতিলের বিস্তারিত তথ্য -- RELATION: orders (1) ──► (1) order_cancellations -- ============================================= CREATE TABLE order_cancellations ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), cancellation_number VARCHAR(30) NOT NULL UNIQUE, -- ═══════════════════════════════════════════ -- REFERENCE -- ═══════════════════════════════════════════ order_id UUID NOT NULL UNIQUE REFERENCES orders(id) ON DELETE RESTRICT, -- ═══════════════════════════════════════════ -- CANCELLATION INITIATOR -- ═══════════════════════════════════════════ initiated_by VARCHAR(25) NOT NULL CHECK (initiated_by IN ( 'customer', -- কাস্টমার 'merchant', -- মার্চেন্ট/সেলার 'admin', -- অ্যাডমিন 'system', -- সিস্টেম 'payment_failed', -- পেমেন্ট ফেইল 'fraud_detection' -- প্রতারণা সনাক্ত )), initiated_by_user_id UUID REFERENCES users(id), initiated_by_name VARCHAR(100), -- ═══════════════════════════════════════════ -- CANCELLATION REASON -- ═══════════════════════════════════════════ reason_category VARCHAR(50) NOT NULL CHECK (reason_category IN ( -- Customer Reasons 'changed_mind', -- মন পরিবর্তন 'found_better_price', -- অন্যত্র কম দামে পেয়েছি 'wrong_order', -- ভুল অর্ডার করেছি 'duplicate_order', -- ডুপ্লিকেট অর্ডার 'delivery_too_long', -- ডেলিভারি অনেক দেরি 'payment_issue', -- পেমেন্ট সমস্যা -- Merchant Reasons 'out_of_stock', -- স্টক নেই 'price_error', -- দামে ভুল ছিল 'cannot_fulfill', -- পূরণ করতে পারছি না 'product_discontinued', -- পণ্য বন্ধ হয়ে গেছে -- System Reasons 'payment_failed', -- পেমেন্ট ব্যর্থ 'payment_timeout', -- পেমেন্ট টাইমআউট 'address_unserviceable', -- ঠিকানায় সার্ভিস নেই 'fraud_suspected', -- প্রতারণার সন্দেহ 'system_error', -- সিস্টেম ত্রুটি -- Other 'other' -- অন্যান্য )), reason_details TEXT, customer_feedback TEXT, -- ═══════════════════════════════════════════ -- CANCELLATION STATUS -- ═══════════════════════════════════════════ status VARCHAR(25) DEFAULT 'requested' CHECK (status IN ( 'requested', -- অনুরোধ করা হয়েছে 'pending_approval', -- অনুমোদন পেন্ডিং 'approved', -- অনুমোদিত 'rejected', -- প্রত্যাখ্যাত 'completed', -- সম্পন্ন 'reversed' -- বাতিল প্রত্যাহার )), rejection_reason TEXT, -- ═══════════════════════════════════════════ -- ORDER STATE AT CANCELLATION -- ═══════════════════════════════════════════ order_status_at_cancel VARCHAR(30), payment_status_at_cancel VARCHAR(30), shipping_status_at_cancel VARCHAR(30), -- ═══════════════════════════════════════════ -- FINANCIAL IMPACT -- ═══════════════════════════════════════════ order_total DECIMAL(12,2), amount_paid DECIMAL(12,2), amount_to_refund DECIMAL(12,2), cancellation_fee DECIMAL(12,2) DEFAULT 0, net_refund_amount DECIMAL(12,2) GENERATED ALWAYS AS ( COALESCE(amount_to_refund, 0) - COALESCE(cancellation_fee, 0) ) STORED, -- ═══════════════════════════════════════════ -- REFUND PROCESSING -- ═══════════════════════════════════════════ requires_refund BOOLEAN DEFAULT FALSE, refund_id UUID REFERENCES order_refunds(id), refund_status VARCHAR(25), refund_processed_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- INVENTORY RESTORATION -- ═══════════════════════════════════════════ requires_inventory_restore BOOLEAN DEFAULT TRUE, inventory_restored BOOLEAN DEFAULT FALSE, inventory_restored_at TIMESTAMP WITH TIME ZONE, inventory_restore_notes TEXT, -- ═══════════════════════════════════════════ -- ITEMS CANCELLED -- ═══════════════════════════════════════════ cancelled_items JSONB NOT NULL DEFAULT '[]', /* cancelled_items: [ { "order_item_id": "uuid", "product_id": "uuid", "product_name": "Product Name", "variant": "Size: L, Color: Red", "quantity": 2, "unit_price": 500.00, "total": 1000.00, "inventory_restored": true } ] */ -- ═══════════════════════════════════════════ -- SHIPMENT HANDLING -- ═══════════════════════════════════════════ has_shipment BOOLEAN DEFAULT FALSE, shipment_status VARCHAR(30), shipment_action

Nazmul Hassan Shaown, [1/14/2026 3:58 AM]
VARCHAR(30) CHECK (shipment_action IN ( 'not_applicable', -- প্রযোজ্য নয় 'stop_shipment', -- শিপমেন্ট বন্ধ করুন 'recall', -- ফেরত আনুন 'rto_initiated', -- RTO শুরু 'already_delivered' -- ইতিমধ্যে ডেলিভার )), rto_tracking_number VARCHAR(100), -- ═══════════════════════════════════════════ -- COMMUNICATION -- ═══════════════════════════════════════════ customer_notified BOOLEAN DEFAULT FALSE, customer_notified_at TIMESTAMP WITH TIME ZONE, notification_method VARCHAR(30), email_sent BOOLEAN DEFAULT FALSE, sms_sent BOOLEAN DEFAULT FALSE, -- ═══════════════════════════════════════════ -- APPROVAL WORKFLOW -- ═══════════════════════════════════════════ requires_approval BOOLEAN DEFAULT FALSE, approval_level_required VARCHAR(20), approved_by UUID REFERENCES users(id), approved_at TIMESTAMP WITH TIME ZONE, approval_notes TEXT, -- ═══════════════════════════════════════════ -- PROCESSING TIMELINE -- ═══════════════════════════════════════════ requested_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, processed_at TIMESTAMP WITH TIME ZONE, completed_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- STAFF HANDLING -- ═══════════════════════════════════════════ processed_by UUID REFERENCES users(id), processor_notes TEXT, -- ═══════════════════════════════════════════ -- ANALYTICS -- ═══════════════════════════════════════════ time_since_order INTERVAL, -- অর্ডার থেকে বাতিল পর্যন্ত সময় cancellation_source VARCHAR(30) CHECK (cancellation_source IN ( 'website', -- ওয়েবসাইট 'mobile_app', -- মোবাইল অ্যাপ 'phone_call', -- ফোন কল 'email', -- ইমেইল 'chat', -- চ্যাট 'automatic' -- অটোমেটিক )), -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ internal_notes TEXT, metadata JSONB DEFAULT '{}', -- ═══════════════════════════════════════════ -- TIMESTAMPS -- ═══════════════════════════════════════════ created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP ); -- ═══════════════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════════════ CREATE INDEX idx_order_cancellations_number ON order_cancellations(cancellation_number); CREATE INDEX idx_order_cancellations_order ON order_cancellations(order_id); CREATE INDEX idx_order_cancellations_status ON order_cancellations(status); CREATE INDEX idx_order_cancellations_initiated_by ON order_cancellations(initiated_by); CREATE INDEX idx_order_cancellations_reason ON order_cancellations(reason_category); CREATE INDEX idx_order_cancellations_requested_at ON order_cancellations(requested_at DESC); CREATE INDEX idx_order_cancellations_refund ON order_cancellations(refund_id) WHERE refund_id IS NOT NULL; -- For pending approvals CREATE INDEX idx_order_cancellations_pending ON order_cancellations(status, requires_approval) WHERE status = 'pending_approval'; -- For analytics CREATE INDEX idx_order_cancellations_analytics ON order_cancellations(reason_category, initiated_by, requested_at); -- ═══════════════════════════════════════════════════ -- TRIGGERS -- ═══════════════════════════════════════════════════ CREATE TRIGGER set_timestamp_order_cancellations BEFORE UPDATE ON order_cancellations FOR EACH ROW EXECUTE FUNCTION update_timestamp(); -- ═══════════════════════════════════════════════════ -- CANCELLATION NUMBER GENERATOR -- ═══════════════════════════════════════════════════ CREATE OR REPLACE FUNCTION generate_cancellation_number() RETURNS TRIGGER AS $$ BEGIN IF NEW.cancellation_number IS NULL THEN NEW.cancellation_number := 'CAN-'  TO_CHAR(NOW(), 'YYYYMMDD')  '-' || LPAD(FLOOR(RANDOM() * 100000)::TEXT, 5, '0'); END IF; -- Calculate time since order SELECT NOW() - o.created_at INTO NEW.time_since_order FROM orders o WHERE o.id = NEW.order_id; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_generate_cancellation_number BEFORE INSERT ON order_cancellations FOR EACH ROW EXECUTE FUNCTION generate_cancellation_number(); -- ═══════════════════════════════════════════════════ -- COMMENTS --

Nazmul Hassan Shaown, [1/14/2026 3:58 AM]
═══════════════════════════════════════════════════ COMMENT ON TABLE order_cancellations IS 'অর্ডার বাতিলের সম্পূর্ণ তথ্য ও প্রক্রিয়া'; COMMENT ON COLUMN order_cancellations.time_since_order IS 'অর্ডার প্লেস থেকে বাতিল পর্যন্ত সময়'; COMMENT ON COLUMN order_cancellations.rto_tracking_number IS 'Return to Origin ট্র্যাকিং নম্বর';

Nazmul Hassan Shaown, [1/14/2026 4:00 AM]
-- ============================================= -- TABLE: order_shipments -- PURPOSE: শিপমেন্ট/ডেলিভারি বিস্তারিত তথ্য -- RELATION: orders (1) ──► (M) order_shipments -- ============================================= CREATE TABLE order_shipments ( -- ═══════════════════════════════════════════ -- PRIMARY KEY -- ═══════════════════════════════════════════ id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), shipment_number VARCHAR(30) NOT NULL UNIQUE, -- ═══════════════════════════════════════════ -- REFERENCES -- ═══════════════════════════════════════════ order_id UUID NOT NULL REFERENCES orders(id) ON DELETE RESTRICT, warehouse_id UUID REFERENCES warehouses(id), -- ═══════════════════════════════════════════ -- SHIPMENT TYPE -- ═══════════════════════════════════════════ shipment_type VARCHAR(25) DEFAULT 'standard' CHECK (shipment_type IN ( 'standard', -- স্ট্যান্ডার্ড শিপমেন্ট 'express', -- এক্সপ্রেস 'same_day', -- সেম ডে 'next_day', -- নেক্সট ডে 'scheduled', -- নির্ধারিত সময়ে 'pickup', -- পিকআপ পয়েন্ট থেকে 'partial', -- আংশিক শিপমেন্ট 'replacement', -- রিপ্লেসমেন্ট 'return' -- রিটার্ন শিপমেন্ট )), -- ═══════════════════════════════════════════ -- SHIPMENT STATUS -- ═══════════════════════════════════════════ status VARCHAR(30) DEFAULT 'pending' CHECK (status IN ( 'pending', -- পেন্ডিং 'processing', -- প্রসেসিং 'picking', -- পিকিং হচ্ছে 'picked', -- পিক করা হয়েছে 'packing', -- প্যাকিং হচ্ছে 'packed', -- প্যাক করা হয়েছে 'ready_to_ship', -- শিপের জন্য রেডি 'handed_to_courier', -- কুরিয়ারে দেওয়া হয়েছে 'in_transit', -- ট্রানজিটে 'out_for_delivery', -- ডেলিভারির জন্য বের হয়েছে 'delivered', -- ডেলিভার হয়েছে 'failed_delivery', -- ডেলিভারি ব্যর্থ 'returned', -- ফেরত এসেছে 'cancelled', -- বাতিল 'lost' -- হারিয়ে গেছে )), status_updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, -- ═══════════════════════════════════════════ -- COURIER INFORMATION -- ═══════════════════════════════════════════ courier_id UUID REFERENCES couriers(id), courier_name VARCHAR(100), courier_service_type VARCHAR(50), tracking_number VARCHAR(100), tracking_url TEXT, awb_number VARCHAR(100), -- Air Waybill Number -- ═══════════════════════════════════════════ -- ITEMS IN SHIPMENT -- ═══════════════════════════════════════════ shipment_items JSONB NOT NULL DEFAULT '[]', /* shipment_items: [ { "order_item_id": "uuid", "product_id": "uuid", "product_name": "Product Name", "sku": "SKU123", "quantity": 2, "weight": 0.5, "weight_unit": "kg" } ] */ total_items INTEGER DEFAULT 0, -- ═══════════════════════════════════════════ -- PACKAGE DETAILS -- ═══════════════════════════════════════════ package_count INTEGER DEFAULT 1, packages JSONB DEFAULT '[]', /* packages: [ { "package_number": 1, "length": 30, "width": 20, "height": 15, "dimension_unit": "cm", "weight": 1.5, "weight_unit": "kg", "package_type": "box" } ] */ total_weight DECIMAL(10,3), weight_unit VARCHAR(10) DEFAULT 'kg', volumetric_weight DECIMAL(10,3), chargeable_weight DECIMAL(10,3), -- ═══════════════════════════════════════════ -- SHIPPING ADDRESS -- ═══════════════════════════════════════════ shipping_address_id UUID, recipient_name VARCHAR(100) NOT NULL, recipient_phone VARCHAR(20) NOT NULL, recipient_alt_phone VARCHAR(20), recipient_email VARCHAR(255), address_line1 VARCHAR(255) NOT NULL, address_line2 VARCHAR(255), area VARCHAR(100), city VARCHAR(100) NOT NULL, district VARCHAR(100), division VARCHAR(100), postal_code VARCHAR(20), country VARCHAR(100) DEFAULT 'Bangladesh', delivery_instructions TEXT, landmark VARCHAR(255), -- GPS Coordinates latitude DECIMAL(10, 8), longitude DECIMAL(11, 8), -- ═══════════════════════════════════════════ -- PICKUP ADDRESS (for returns) -- ═══════════════════════════════════════════ pickup_address JSONB, /* pickup_address: { "name": "Warehouse Name", "phone": "01XXXXXXXXX", "address_line1": "Address", "city": "Dhaka", "postal_code": "1205" } */ -- ═══════════════════════════════════════════ -- SHIPPING COST -- ═══════════════════════════════════════════ currency VARCHAR(3) DEFAULT 'BDT', base_shipping_cost DECIMAL(10,2) DEFAULT 0,

Nazmul Hassan Shaown, [1/14/2026 4:00 AM]
additional_charges DECIMAL(10,2) DEFAULT 0, cod_charges DECIMAL(10,2) DEFAULT 0, insurance_cost DECIMAL(10,2) DEFAULT 0, packaging_cost DECIMAL(10,2) DEFAULT 0, fuel_surcharge DECIMAL(10,2) DEFAULT 0, discount_amount DECIMAL(10,2) DEFAULT 0, total_shipping_cost DECIMAL(10,2) GENERATED ALWAYS AS ( COALESCE(base_shipping_cost, 0) + COALESCE(additional_charges, 0) + COALESCE(cod_charges, 0) + COALESCE(insurance_cost, 0) + COALESCE(packaging_cost, 0) + COALESCE(fuel_surcharge, 0) - COALESCE(discount_amount, 0) ) STORED, -- ═══════════════════════════════════════════ -- COD (Cash on Delivery) DETAILS -- ═══════════════════════════════════════════ is_cod BOOLEAN DEFAULT FALSE, cod_amount DECIMAL(12,2), cod_collected BOOLEAN DEFAULT FALSE, cod_collected_at TIMESTAMP WITH TIME ZONE, cod_remitted BOOLEAN DEFAULT FALSE, cod_remitted_at TIMESTAMP WITH TIME ZONE, cod_remittance_ref VARCHAR(100), -- ═══════════════════════════════════════════ -- INSURANCE -- ═══════════════════════════════════════════ is_insured BOOLEAN DEFAULT FALSE, insured_value DECIMAL(12,2), insurance_provider VARCHAR(100), insurance_policy_number VARCHAR(100), -- ═══════════════════════════════════════════ -- SCHEDULING -- ═══════════════════════════════════════════ preferred_delivery_date DATE, preferred_time_slot VARCHAR(50), /* Time slots: "morning", "afternoon", "evening", "10:00-14:00" */ estimated_delivery_date DATE, estimated_delivery_time TIME, -- ═══════════════════════════════════════════ -- ACTUAL TIMELINE -- ═══════════════════════════════════════════ picked_at TIMESTAMP WITH TIME ZONE, packed_at TIMESTAMP WITH TIME ZONE, shipped_at TIMESTAMP WITH TIME ZONE, first_attempt_at TIMESTAMP WITH TIME ZONE, delivered_at TIMESTAMP WITH TIME ZONE, returned_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- DELIVERY ATTEMPTS -- ═══════════════════════════════════════════ delivery_attempts INTEGER DEFAULT 0, max_delivery_attempts INTEGER DEFAULT 3, last_attempt_at TIMESTAMP WITH TIME ZONE, last_attempt_reason TEXT, next_attempt_date DATE, delivery_attempt_history JSONB DEFAULT '[]', /* delivery_attempt_history: [ { "attempt": 1, "date": "2024-01-15", "time": "14:30", "status": "failed", "reason": "Customer not available", "agent": "Agent Name", "notes": "Will try tomorrow" } ] */ -- ═══════════════════════════════════════════ -- PROOF OF DELIVERY -- ═══════════════════════════════════════════ pod_collected BOOLEAN DEFAULT FALSE, pod_type VARCHAR(30), pod_signature TEXT, -- Base64 signature pod_photo_url TEXT, pod_receiver_name VARCHAR(100), pod_receiver_relation VARCHAR(50), pod_receiver_id VARCHAR(50), pod_otp_verified BOOLEAN DEFAULT FALSE, pod_collected_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- DELIVERY RATING -- ═══════════════════════════════════════════ delivery_rating DECIMAL(2,1), delivery_feedback TEXT, rating_given_at TIMESTAMP WITH TIME ZONE, -- ═══════════════════════════════════════════ -- SPECIAL HANDLING -- ═══════════════════════════════════════════ is_fragile BOOLEAN DEFAULT FALSE, requires_signature BOOLEAN DEFAULT FALSE, is_hazardous BOOLEAN DEFAULT FALSE, temperature_controlled BOOLEAN DEFAULT FALSE, temperature_range VARCHAR(50), -- "2-8°C" special_instructions TEXT, handling_codes VARCHAR(100)[], -- ['FRAGILE', 'THIS_SIDE_UP'] -- ═══════════════════════════════════════════ -- LABEL & DOCUMENTS -- ═══════════════════════════════════════════ label_generated BOOLEAN DEFAULT FALSE, label_url TEXT, label_generated_at TIMESTAMP WITH TIME ZONE, manifest_id VARCHAR(100), invoice_url TEXT, -- ═══════════════════════════════════════════ -- RETURN TO ORIGIN (RTO) -- ═══════════════════════════════════════════ is_rto BOOLEAN DEFAULT FALSE, rto_reason TEXT, rto_initiated_at TIMESTAMP WITH TIME ZONE, rto_received_at TIMESTAMP WITH TIME ZONE, rto_condition VARCHAR(50), -- ═══════════════════════════════════════════ -- STAFF ASSIGNMENT -- ═══════════════════════════════════════════ picker_id UUID REFERENCES users(id), packer_id UUID REFERENCES users(id), delivery_agent_id UUID,

Nazmul Hassan Shaown, [1/14/2026 4:00 AM]
delivery_agent_name VARCHAR(100), delivery_agent_phone VARCHAR(20), -- ═══════════════════════════════════════════ -- INTEGRATION DATA -- ═══════════════════════════════════════════ courier_order_id VARCHAR(100), -- Courier's internal ID courier_response JSONB, webhook_events JSONB DEFAULT '[]', -- ═══════════════════════════════════════════ -- METADATA -- ═══════════════════════════════════════════ internal_notes TEXT, metadata JSONB DEFAULT '{}', -- ═══════════════════════════════════════════ -- TIMESTAMPS -- ═══════════════════════════════════════════ created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, created_by UUID REFERENCES users(id) ); -- ═══════════════════════════════════════════════════ -- INDEXES -- ═══════════════════════════════════════════════════ CREATE INDEX idx_shipments_number ON order_shipments(shipment_number); CREATE INDEX idx_shipments_order_id ON order_shipments(order_id); CREATE INDEX idx_shipments_status ON order_shipments(status); CREATE INDEX idx_shipments_courier ON order_shipments(courier_id); CREATE INDEX idx_shipments_tracking ON order_shipments(tracking_number); CREATE INDEX idx_shipments_awb ON order_shipments(awb_number) WHERE awb_number IS NOT NULL; CREATE INDEX idx_shipments_city ON order_shipments(city); CREATE INDEX idx_shipments_district ON order_shipments(district); CREATE INDEX idx_shipments_created_at ON order_shipments(created_at DESC); CREATE INDEX idx_shipments_shipped_at ON order_shipments(shipped_at DESC); CREATE INDEX idx_shipments_delivery_date ON order_shipments(estimated_delivery_date); CREATE INDEX idx_shipments_cod_pending ON order_shipments(is_cod, cod_collected) WHERE is_cod = TRUE AND cod_collected = FALSE; CREATE INDEX idx_shipments_pending ON order_shipments(status) WHERE status IN ('pending', 'processing', 'ready_to_ship'); CREATE INDEX idx_shipments_in_transit ON order_shipments(status, courier_id) WHERE status = 'in_transit'; -- Spatial index CREATE INDEX idx_shipments_geo ON order_shipments(latitude, longitude) WHERE latitude IS NOT NULL; -- ═══════════════════════════════════════════════════ -- TRIGGERS -- ═══════════════════════════════════════════════════ CREATE TRIGGER set_timestamp_order_shipments BEFORE UPDATE ON order_shipments FOR EACH ROW EXECUTE FUNCTION update_timestamp(); -- ═══════════════════════════════════════════════════ -- SHIPMENT NUMBER GENERATOR -- ═══════════════════════════════════════════════════ CREATE OR REPLACE FUNCTION generate_shipment_number() RETURNS TRIGGER AS $$ BEGIN IF NEW.shipment_number IS NULL THEN NEW.shipment_number := 'SHP-'  TO_CHAR(NOW(), 'YYYYMMDD')  '-' || LPAD(FLOOR(RANDOM() * 100000)::TEXT, 5, '0'); END IF; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_generate_shipment_number BEFORE INSERT ON order_shipments FOR EACH ROW EXECUTE FUNCTION generate_shipment_number(); -- ═══════════════════════════════════════════════════ -- COMMENTS -- ═══════════════════════════════════════════════════ COMMENT ON TABLE order_shipments IS 'অর্ডার শিপমেন্ট - ডেলিভারি সংক্রান্ত সকল তথ্য'; COMMENT ON COLUMN order_shipments.awb_number IS 'Air Waybill Number - কুরিয়ার ট্র্যাকিং নম্বর'; COMMENT ON COLUMN order_shipments.chargeable_weight IS 'চার্জযোগ্য ওজন (actual vs volumetric এর মধ্যে বেশিটি)'; COMMENT ON COLUMN order_shipments.is_rto IS 'Return to Origin - পণ্য ফেরত এসেছে কিনা';